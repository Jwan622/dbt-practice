[0m15:43:43.596685 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dd37f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aabfa60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f297340>]}


============================== 15:43:43.600831 | f56b9fe7-eb97-4a57-b6e5-cd98b5711eef ==============================
[0m15:43:43.600831 [info ] [MainThread]: Running with dbt=1.5.4
[0m15:43:43.601357 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '.', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m15:43:43.684120 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f56b9fe7-eb97-4a57-b6e5-cd98b5711eef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aabfa60>]}
[0m15:43:43.696641 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f56b9fe7-eb97-4a57-b6e5-cd98b5711eef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f627670>]}
[0m15:43:43.697310 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m15:43:43.747907 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m15:43:43.748526 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m15:43:43.748843 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'f56b9fe7-eb97-4a57-b6e5-cd98b5711eef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f63abe0>]}
[0m15:43:44.190849 [debug] [MainThread]: 1699: static parser successfully parsed analytics/valid_and_bookable_routes.sql
[0m15:43:44.201025 [debug] [MainThread]: 1699: static parser successfully parsed analytics/redemption_bookings_number_by_day.sql
[0m15:43:44.203375 [debug] [MainThread]: 1699: static parser successfully parsed analytics/ticket_sales_counts.sql
[0m15:43:44.232946 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f56b9fe7-eb97-4a57-b6e5-cd98b5711eef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f8e7e50>]}
[0m15:43:44.237762 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f56b9fe7-eb97-4a57-b6e5-cd98b5711eef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f63a8b0>]}
[0m15:43:44.238108 [info ] [MainThread]: Found 3 models, 0 tests, 0 snapshots, 0 analyses, 307 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m15:43:44.238398 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f56b9fe7-eb97-4a57-b6e5-cd98b5711eef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f7f7fd0>]}
[0m15:43:44.239490 [info ] [MainThread]: 
[0m15:43:44.240030 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:43:44.240818 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bookings'
[0m15:43:44.248448 [debug] [ThreadPool]: Using postgres connection "list_bookings"
[0m15:43:44.248707 [debug] [ThreadPool]: On list_bookings: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings"} */

    select distinct nspname from pg_namespace
  
[0m15:43:44.248941 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:43:44.590918 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.0 seconds
[0m15:43:44.594000 [debug] [ThreadPool]: On list_bookings: Close
[0m15:43:44.596820 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bookings, now list_bookings_dbt)
[0m15:43:44.602400 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m15:43:44.602689 [debug] [ThreadPool]: On list_bookings_dbt: BEGIN
[0m15:43:44.602889 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:43:44.631331 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m15:43:44.632164 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m15:43:44.632996 [debug] [ThreadPool]: On list_bookings_dbt: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings_dbt"} */
select
      'bookings' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'bookings' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
[0m15:43:44.656391 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m15:43:44.659297 [debug] [ThreadPool]: On list_bookings_dbt: ROLLBACK
[0m15:43:44.660486 [debug] [ThreadPool]: On list_bookings_dbt: Close
[0m15:43:44.671890 [debug] [MainThread]: Using postgres connection "master"
[0m15:43:44.672616 [debug] [MainThread]: On master: BEGIN
[0m15:43:44.673081 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:43:44.687862 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:43:44.688276 [debug] [MainThread]: Using postgres connection "master"
[0m15:43:44.688599 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:43:44.737354 [debug] [MainThread]: SQL status: SELECT 10 in 0.0 seconds
[0m15:43:44.742705 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f56b9fe7-eb97-4a57-b6e5-cd98b5711eef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f95e880>]}
[0m15:43:44.743613 [debug] [MainThread]: On master: ROLLBACK
[0m15:43:44.744825 [debug] [MainThread]: Using postgres connection "master"
[0m15:43:44.745359 [debug] [MainThread]: On master: BEGIN
[0m15:43:44.747022 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:43:44.747698 [debug] [MainThread]: On master: COMMIT
[0m15:43:44.748222 [debug] [MainThread]: Using postgres connection "master"
[0m15:43:44.748717 [debug] [MainThread]: On master: COMMIT
[0m15:43:44.749692 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:43:44.750235 [debug] [MainThread]: On master: Close
[0m15:43:44.751661 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:43:44.752809 [info ] [MainThread]: 
[0m15:43:44.762908 [debug] [Thread-1  ]: Began running node model.plaid_de.redemption_bookings_number_by_day
[0m15:43:44.764028 [debug] [Thread-2  ]: Began running node model.plaid_de.ticket_sales_counts
[0m15:43:44.764972 [debug] [Thread-3  ]: Began running node model.plaid_de.valid_and_bookable_routes
[0m15:43:44.766147 [info ] [Thread-1  ]: 1 of 3 START sql view model dbt.redemption_bookings_number_by_day .............. [RUN]
[0m15:43:44.767501 [info ] [Thread-2  ]: 2 of 3 START sql view model dbt.ticket_sales_counts ............................ [RUN]
[0m15:43:44.770374 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bookings_dbt, now model.plaid_de.redemption_bookings_number_by_day)
[0m15:43:44.768752 [info ] [Thread-3  ]: 3 of 3 START sql view model dbt.valid_and_bookable_routes ...................... [RUN]
[0m15:43:44.771981 [debug] [Thread-2  ]: Acquiring new postgres connection 'model.plaid_de.ticket_sales_counts'
[0m15:43:44.772680 [debug] [Thread-1  ]: Began compiling node model.plaid_de.redemption_bookings_number_by_day
[0m15:43:44.773576 [debug] [Thread-3  ]: Acquiring new postgres connection 'model.plaid_de.valid_and_bookable_routes'
[0m15:43:44.774042 [debug] [Thread-2  ]: Began compiling node model.plaid_de.ticket_sales_counts
[0m15:43:44.780587 [debug] [Thread-1  ]: Writing injected SQL for node "model.plaid_de.redemption_bookings_number_by_day"
[0m15:43:44.781051 [debug] [Thread-3  ]: Began compiling node model.plaid_de.valid_and_bookable_routes
[0m15:43:44.782650 [debug] [Thread-2  ]: Writing injected SQL for node "model.plaid_de.ticket_sales_counts"
[0m15:43:44.784320 [debug] [Thread-3  ]: Writing injected SQL for node "model.plaid_de.valid_and_bookable_routes"
[0m15:43:44.785386 [debug] [Thread-3  ]: Timing info for model.plaid_de.valid_and_bookable_routes (compile): 15:43:44.783006 => 15:43:44.785193
[0m15:43:44.785741 [debug] [Thread-2  ]: Timing info for model.plaid_de.ticket_sales_counts (compile): 15:43:44.781412 => 15:43:44.785579
[0m15:43:44.786036 [debug] [Thread-3  ]: Began executing node model.plaid_de.valid_and_bookable_routes
[0m15:43:44.786336 [debug] [Thread-2  ]: Began executing node model.plaid_de.ticket_sales_counts
[0m15:43:44.786717 [debug] [Thread-1  ]: Timing info for model.plaid_de.redemption_bookings_number_by_day (compile): 15:43:44.774356 => 15:43:44.786523
[0m15:43:44.828286 [debug] [Thread-3  ]: Writing runtime sql for node "model.plaid_de.valid_and_bookable_routes"
[0m15:43:44.829403 [debug] [Thread-2  ]: Writing runtime sql for node "model.plaid_de.ticket_sales_counts"
[0m15:43:44.829785 [debug] [Thread-1  ]: Began executing node model.plaid_de.redemption_bookings_number_by_day
[0m15:43:44.833400 [debug] [Thread-1  ]: Writing runtime sql for node "model.plaid_de.redemption_bookings_number_by_day"
[0m15:43:44.834007 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m15:43:44.834307 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m15:43:44.834591 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m15:43:44.834883 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: BEGIN
[0m15:43:44.835143 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: BEGIN
[0m15:43:44.835387 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: BEGIN
[0m15:43:44.835625 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m15:43:44.835863 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:43:44.836119 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m15:43:44.848687 [debug] [Thread-2  ]: SQL status: BEGIN in 0.0 seconds
[0m15:43:44.849653 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m15:43:44.850210 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */

  create view "bookings"."dbt"."ticket_sales_counts__dbt_tmp"
    
    
  as (
    WITH daily_ticket_sales AS (
    SELECT
        DATE_TRUNC('day', b.book_date) AS sale_date,
        COUNT(t.ticket_no) AS total_tickets
    FROM bookings b
    JOIN tickets t ON b.book_ref = t.book_ref
    GROUP BY sale_date
),

rolling_7d_ticket_sales AS (
    SELECT
        sale_date,
        SUM(total_tickets) OVER (ORDER BY sale_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS rolling_7_days_total
    FROM daily_ticket_sales
),

rolling_28d_ticket_sales AS (
    SELECT
        sale_date,
        SUM(total_tickets) OVER (ORDER BY sale_date ROWS BETWEEN 27 PRECEDING AND CURRENT ROW) AS rolling_28_days_total
    FROM daily_ticket_sales
)
SELECT
    dts.sale_date AS date,
    dts.total_tickets AS daily_total_tickets,
    rolling_7d.rolling_7_days_total,
    rolling_28d.rolling_28_days_total
FROM daily_ticket_sales dts
LEFT JOIN rolling_7d_ticket_sales AS rolling_7d
    ON dts.sale_date = rolling_7d.sale_date
LEFT JOIN rolling_28d_ticket_sales AS rolling_28d
    ON dts.sale_date = rolling_28d.sale_date
  );
[0m15:43:44.863198 [debug] [Thread-3  ]: SQL status: BEGIN in 0.0 seconds
[0m15:43:44.863623 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m15:43:44.864089 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */

  create view "bookings"."dbt"."valid_and_bookable_routes__dbt_tmp"
    
    
  as (
    WITH max_1_transfer_flights AS (
    SELECT
        route1.flight_no AS first_flight,
        route2.flight_no AS second_flight,
        route1.departure_airport AS first_departure_airport,
        route1.arrival_airport AS first_arrival_airport,
        route2.departure_airport AS second_departure_airport,
        route2.arrival_airport AS second_arrival_airport,
        route1.scheduled_departure as first_scheduled_departure_time,
        route2.scheduled_departure as second_scheduled_departure_time,
        route1.scheduled_arrival as first_scheduled_arrival_time,
        route2.scheduled_arrival as second_scheduled_arrival_time,
        route3.flight_no as third_flight,
        CASE
            WHEN route2.flight_no IS NULL THEN 1
            ELSE 0
        END AS is_transfer
    FROM routes AS route1
    LEFT OUTER JOIN routes AS route2
    ON route1.arrival_airport = route2.departure_airport
    LEFT OUTER JOIN routes AS route3
    ON route2.arrival_airport = route3.departure_airport
    AND route3.flight_no IS NULL
),
max_1_transfer_and_non_circular_flights AS (
  SELECT
    first_flight,
    second_flight,
    first_departure_airport,
    first_arrival_airport,
    second_departure_airport,
    second_arrival_airport,
    first_scheduled_departure_time,
    second_scheduled_departure_time,
    first_scheduled_arrival_time,
    second_scheduled_arrival_time,
    is_transfer
  FROM max_1_transfer_flights
  WHERE first_departure_airport <> second_arrival_airport -- non-circular
),
max_1_transfer_and_non_circular_flights_within_24h AS (
    SELECT *
    FROM max_1_transfer_and_non_circular_flights
    WHERE second_scheduled_arrival_time - first_scheduled_departure_time <= interval '24 hours'
)
SELECT
    first_flight as first_flight_no,
    second_flight as second_flight_no,
    first_departure_airport as origin_airport,
    first_scheduled_departure_time as first_scheduled_departure_time,
    COALESCE(second_arrival_airport, first_arrival_airport) as destination_airport_code,
    COALESCE(second_scheduled_arrival_time, first_scheduled_arrival_time) as destination_arrival_time,
    CASE WHEN second_flight IS NOT NULL THEN first_arrival_airport END as transfer_airport_code,
    CASE WHEN second_flight IS NOT NULL THEN first_scheduled_arrival_time END as transfer_airport_arrival_time,
    CASE WHEN second_flight IS NOT NULL THEN second_scheduled_departure_time END as transfer_airport_departure_time
FROM max_1_transfer_and_non_circular_flights_within_24h AS valid_routes
  );
[0m15:43:44.865695 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m15:43:44.865970 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m15:43:44.866235 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */

  create view "bookings"."dbt"."redemption_bookings_number_by_day__dbt_tmp"
    
    
  as (
    SELECT
    DATE_TRUNC('day', b.book_date) AS date,
    COUNT(*) AS redemption_count
FROM bookings b
WHERE total_amount = -1
    OR total_amount = 0
    OR total_amount = -12345678.00
GROUP BY date
ORDER BY redemption_count desc
  );
[0m15:43:44.884131 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.0 seconds
[0m15:43:44.884421 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.0 seconds
[0m15:43:44.891014 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.0 seconds
[0m15:43:44.891451 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m15:43:44.894316 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m15:43:44.896750 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m15:43:44.897033 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */
alter table "bookings"."dbt"."redemption_bookings_number_by_day" rename to "redemption_bookings_number_by_day__dbt_backup"
[0m15:43:44.897286 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */
alter table "bookings"."dbt"."ticket_sales_counts" rename to "ticket_sales_counts__dbt_backup"
[0m15:43:44.897550 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */
alter table "bookings"."dbt"."valid_and_bookable_routes" rename to "valid_and_bookable_routes__dbt_backup"
[0m15:43:44.900335 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m15:43:44.902842 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m15:43:44.903117 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m15:43:44.903351 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m15:43:44.903639 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */
alter table "bookings"."dbt"."valid_and_bookable_routes__dbt_tmp" rename to "valid_and_bookable_routes"
[0m15:43:44.905838 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m15:43:44.908049 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m15:43:44.908404 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */
alter table "bookings"."dbt"."ticket_sales_counts__dbt_tmp" rename to "ticket_sales_counts"
[0m15:43:44.908674 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */
alter table "bookings"."dbt"."redemption_bookings_number_by_day__dbt_tmp" rename to "redemption_bookings_number_by_day"
[0m15:43:44.908977 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m15:43:44.916518 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m15:43:44.922633 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: COMMIT
[0m15:43:44.922941 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m15:43:44.924445 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: COMMIT
[0m15:43:44.924730 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m15:43:44.926106 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: COMMIT
[0m15:43:44.926346 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m15:43:44.926564 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: COMMIT
[0m15:43:44.926779 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m15:43:44.927038 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: COMMIT
[0m15:43:44.927345 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: COMMIT
[0m15:43:44.929564 [debug] [Thread-3  ]: SQL status: COMMIT in 0.0 seconds
[0m15:43:44.933535 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m15:43:44.933775 [debug] [Thread-2  ]: SQL status: COMMIT in 0.0 seconds
[0m15:43:44.934004 [debug] [Thread-1  ]: SQL status: COMMIT in 0.0 seconds
[0m15:43:44.934286 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */
drop view if exists "bookings"."dbt"."valid_and_bookable_routes__dbt_backup" cascade
[0m15:43:44.936069 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m15:43:44.937810 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m15:43:44.939623 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */
drop view if exists "bookings"."dbt"."ticket_sales_counts__dbt_backup" cascade
[0m15:43:44.939917 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */
drop view if exists "bookings"."dbt"."redemption_bookings_number_by_day__dbt_backup" cascade
[0m15:43:44.949595 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.0 seconds
[0m15:43:44.949894 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.0 seconds
[0m15:43:44.950117 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.0 seconds
[0m15:43:44.951204 [debug] [Thread-1  ]: Timing info for model.plaid_de.redemption_bookings_number_by_day (execute): 15:43:44.830213 => 15:43:44.951060
[0m15:43:44.952197 [debug] [Thread-3  ]: Timing info for model.plaid_de.valid_and_bookable_routes (execute): 15:43:44.786907 => 15:43:44.952065
[0m15:43:44.953156 [debug] [Thread-2  ]: Timing info for model.plaid_de.ticket_sales_counts (execute): 15:43:44.811091 => 15:43:44.953029
[0m15:43:44.953428 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: Close
[0m15:43:44.953717 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: Close
[0m15:43:44.954518 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: Close
[0m15:43:44.955206 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f56b9fe7-eb97-4a57-b6e5-cd98b5711eef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10faf6b80>]}
[0m15:43:44.955808 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f56b9fe7-eb97-4a57-b6e5-cd98b5711eef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fb26be0>]}
[0m15:43:44.956233 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f56b9fe7-eb97-4a57-b6e5-cd98b5711eef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10faccd90>]}
[0m15:43:44.957637 [info ] [Thread-1  ]: 1 of 3 OK created sql view model dbt.redemption_bookings_number_by_day ......... [[32mCREATE VIEW[0m in 0.19s]
[0m15:43:44.958160 [info ] [Thread-2  ]: 2 of 3 OK created sql view model dbt.ticket_sales_counts ....................... [[32mCREATE VIEW[0m in 0.18s]
[0m15:43:44.958641 [info ] [Thread-3  ]: 3 of 3 OK created sql view model dbt.valid_and_bookable_routes ................. [[32mCREATE VIEW[0m in 0.18s]
[0m15:43:44.959285 [debug] [Thread-1  ]: Finished running node model.plaid_de.redemption_bookings_number_by_day
[0m15:43:44.960264 [debug] [Thread-2  ]: Finished running node model.plaid_de.ticket_sales_counts
[0m15:43:44.960817 [debug] [Thread-3  ]: Finished running node model.plaid_de.valid_and_bookable_routes
[0m15:43:44.963053 [debug] [MainThread]: Using postgres connection "master"
[0m15:43:44.963320 [debug] [MainThread]: On master: BEGIN
[0m15:43:44.963550 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:43:44.976099 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:43:44.976425 [debug] [MainThread]: On master: COMMIT
[0m15:43:44.976621 [debug] [MainThread]: Using postgres connection "master"
[0m15:43:44.976802 [debug] [MainThread]: On master: COMMIT
[0m15:43:44.977146 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:43:44.977385 [debug] [MainThread]: On master: Close
[0m15:43:44.977883 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:43:44.978098 [debug] [MainThread]: Connection 'model.plaid_de.redemption_bookings_number_by_day' was properly closed.
[0m15:43:44.978426 [debug] [MainThread]: Connection 'model.plaid_de.ticket_sales_counts' was properly closed.
[0m15:43:44.978694 [debug] [MainThread]: Connection 'model.plaid_de.valid_and_bookable_routes' was properly closed.
[0m15:43:44.979576 [info ] [MainThread]: 
[0m15:43:44.979888 [info ] [MainThread]: Finished running 3 view models in 0 hours 0 minutes and 0.74 seconds (0.74s).
[0m15:43:44.980622 [debug] [MainThread]: Command end result
[0m15:43:44.985740 [info ] [MainThread]: 
[0m15:43:44.986093 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:43:44.986359 [info ] [MainThread]: 
[0m15:43:44.986651 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m15:43:44.987202 [debug] [MainThread]: Command `dbt run` succeeded at 15:43:44.987126 after 1.43 seconds
[0m15:43:44.987506 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dd37f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10face2b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f924a60>]}
[0m15:43:44.987785 [debug] [MainThread]: Flushing usage events
[0m15:55:30.752567 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fb24f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111053340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c8bf6d0>]}


============================== 15:55:30.757289 | 03c77a2c-83ac-42d6-8ac0-7c5678e15ed0 ==============================
[0m15:55:30.757289 [info ] [MainThread]: Running with dbt=1.5.4
[0m15:55:30.757730 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '.', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m15:55:30.807326 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '03c77a2c-83ac-42d6-8ac0-7c5678e15ed0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c8bfc10>]}
[0m15:55:30.819424 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '03c77a2c-83ac-42d6-8ac0-7c5678e15ed0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11140b670>]}
[0m15:55:30.819869 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m15:55:30.835759 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m15:55:30.883382 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:55:30.883673 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:55:30.888023 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '03c77a2c-83ac-42d6-8ac0-7c5678e15ed0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1116dffd0>]}
[0m15:55:30.893406 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '03c77a2c-83ac-42d6-8ac0-7c5678e15ed0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11165f610>]}
[0m15:55:30.893716 [info ] [MainThread]: Found 3 models, 0 tests, 0 snapshots, 0 analyses, 307 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m15:55:30.893969 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '03c77a2c-83ac-42d6-8ac0-7c5678e15ed0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11165f580>]}
[0m15:55:30.894915 [info ] [MainThread]: 
[0m15:55:30.895398 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:55:30.896096 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bookings'
[0m15:55:30.903295 [debug] [ThreadPool]: Using postgres connection "list_bookings"
[0m15:55:30.903516 [debug] [ThreadPool]: On list_bookings: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings"} */

    select distinct nspname from pg_namespace
  
[0m15:55:30.903710 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:55:31.339838 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.0 seconds
[0m15:55:31.344389 [debug] [ThreadPool]: On list_bookings: Close
[0m15:55:31.348390 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bookings, now list_bookings_dbt)
[0m15:55:31.372658 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m15:55:31.373279 [debug] [ThreadPool]: On list_bookings_dbt: BEGIN
[0m15:55:31.373673 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:55:31.398545 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m15:55:31.399286 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m15:55:31.399727 [debug] [ThreadPool]: On list_bookings_dbt: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings_dbt"} */
select
      'bookings' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'bookings' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
[0m15:55:31.421815 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m15:55:31.425108 [debug] [ThreadPool]: On list_bookings_dbt: ROLLBACK
[0m15:55:31.426140 [debug] [ThreadPool]: On list_bookings_dbt: Close
[0m15:55:31.435280 [debug] [MainThread]: Using postgres connection "master"
[0m15:55:31.435738 [debug] [MainThread]: On master: BEGIN
[0m15:55:31.435998 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:55:31.454516 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:55:31.454964 [debug] [MainThread]: Using postgres connection "master"
[0m15:55:31.455485 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:55:31.483098 [debug] [MainThread]: SQL status: SELECT 10 in 0.0 seconds
[0m15:55:31.485884 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '03c77a2c-83ac-42d6-8ac0-7c5678e15ed0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11165f340>]}
[0m15:55:31.486710 [debug] [MainThread]: On master: ROLLBACK
[0m15:55:31.487501 [debug] [MainThread]: Using postgres connection "master"
[0m15:55:31.487949 [debug] [MainThread]: On master: BEGIN
[0m15:55:31.488857 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:55:31.489346 [debug] [MainThread]: On master: COMMIT
[0m15:55:31.489805 [debug] [MainThread]: Using postgres connection "master"
[0m15:55:31.490239 [debug] [MainThread]: On master: COMMIT
[0m15:55:31.490867 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:55:31.491349 [debug] [MainThread]: On master: Close
[0m15:55:31.492081 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:55:31.492448 [info ] [MainThread]: 
[0m15:55:31.497261 [debug] [Thread-1  ]: Began running node model.plaid_de.redemption_bookings_number_by_day
[0m15:55:31.497649 [debug] [Thread-2  ]: Began running node model.plaid_de.ticket_sales_counts
[0m15:55:31.498044 [debug] [Thread-3  ]: Began running node model.plaid_de.valid_and_bookable_routes
[0m15:55:31.498518 [info ] [Thread-1  ]: 1 of 3 START sql view model dbt.redemption_bookings_number_by_day .............. [RUN]
[0m15:55:31.499090 [info ] [Thread-2  ]: 2 of 3 START sql view model dbt.ticket_sales_counts ............................ [RUN]
[0m15:55:31.499659 [info ] [Thread-3  ]: 3 of 3 START sql view model dbt.valid_and_bookable_routes ...................... [RUN]
[0m15:55:31.500396 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bookings_dbt, now model.plaid_de.redemption_bookings_number_by_day)
[0m15:55:31.501215 [debug] [Thread-2  ]: Acquiring new postgres connection 'model.plaid_de.ticket_sales_counts'
[0m15:55:31.502334 [debug] [Thread-3  ]: Acquiring new postgres connection 'model.plaid_de.valid_and_bookable_routes'
[0m15:55:31.502752 [debug] [Thread-1  ]: Began compiling node model.plaid_de.redemption_bookings_number_by_day
[0m15:55:31.503120 [debug] [Thread-2  ]: Began compiling node model.plaid_de.ticket_sales_counts
[0m15:55:31.503490 [debug] [Thread-3  ]: Began compiling node model.plaid_de.valid_and_bookable_routes
[0m15:55:31.513276 [debug] [Thread-1  ]: Writing injected SQL for node "model.plaid_de.redemption_bookings_number_by_day"
[0m15:55:31.515113 [debug] [Thread-2  ]: Writing injected SQL for node "model.plaid_de.ticket_sales_counts"
[0m15:55:31.516848 [debug] [Thread-3  ]: Writing injected SQL for node "model.plaid_de.valid_and_bookable_routes"
[0m15:55:31.518126 [debug] [Thread-3  ]: Timing info for model.plaid_de.valid_and_bookable_routes (compile): 15:55:31.515408 => 15:55:31.517866
[0m15:55:31.518563 [debug] [Thread-2  ]: Timing info for model.plaid_de.ticket_sales_counts (compile): 15:55:31.513637 => 15:55:31.518369
[0m15:55:31.519012 [debug] [Thread-1  ]: Timing info for model.plaid_de.redemption_bookings_number_by_day (compile): 15:55:31.503753 => 15:55:31.518808
[0m15:55:31.519406 [debug] [Thread-3  ]: Began executing node model.plaid_de.valid_and_bookable_routes
[0m15:55:31.519750 [debug] [Thread-2  ]: Began executing node model.plaid_de.ticket_sales_counts
[0m15:55:31.520128 [debug] [Thread-1  ]: Began executing node model.plaid_de.redemption_bookings_number_by_day
[0m15:55:31.558448 [debug] [Thread-3  ]: Writing runtime sql for node "model.plaid_de.valid_and_bookable_routes"
[0m15:55:31.558787 [debug] [Thread-2  ]: Writing runtime sql for node "model.plaid_de.ticket_sales_counts"
[0m15:55:31.561842 [debug] [Thread-1  ]: Writing runtime sql for node "model.plaid_de.redemption_bookings_number_by_day"
[0m15:55:31.562712 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m15:55:31.562980 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m15:55:31.563251 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: BEGIN
[0m15:55:31.563478 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m15:55:31.563712 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: BEGIN
[0m15:55:31.563941 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m15:55:31.564161 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: BEGIN
[0m15:55:31.564378 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:55:31.564683 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m15:55:31.580816 [debug] [Thread-2  ]: SQL status: BEGIN in 0.0 seconds
[0m15:55:31.581151 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m15:55:31.581444 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */

  create view "bookings"."dbt"."ticket_sales_counts__dbt_tmp"
    
    
  as (
    WITH daily_ticket_sales AS (
    SELECT
        DATE_TRUNC('day', b.book_date) AS sale_date,
        COUNT(t.ticket_no) AS total_tickets
    FROM bookings b
    JOIN tickets t ON b.book_ref = t.book_ref
    GROUP BY sale_date
),

rolling_7d_ticket_sales AS (
    SELECT
        sale_date,
        SUM(total_tickets) OVER (ORDER BY sale_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS rolling_7_days_total
    FROM daily_ticket_sales
),

rolling_28d_ticket_sales AS (
    SELECT
        sale_date,
        SUM(total_tickets) OVER (ORDER BY sale_date ROWS BETWEEN 27 PRECEDING AND CURRENT ROW) AS rolling_28_days_total
    FROM daily_ticket_sales
)
SELECT
    dts.sale_date AS date,
    dts.total_tickets AS daily_total_tickets,
    rolling_7d.rolling_7_days_total,
    rolling_28d.rolling_28_days_total
FROM daily_ticket_sales dts
LEFT JOIN rolling_7d_ticket_sales AS rolling_7d
    ON dts.sale_date = rolling_7d.sale_date
LEFT JOIN rolling_28d_ticket_sales AS rolling_28d
    ON dts.sale_date = rolling_28d.sale_date
  );
[0m15:55:31.583005 [debug] [Thread-3  ]: SQL status: BEGIN in 0.0 seconds
[0m15:55:31.583299 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m15:55:31.583695 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */

  create view "bookings"."dbt"."valid_and_bookable_routes__dbt_tmp"
    
    
  as (
    WITH max_1_transfer_flights AS (
    SELECT
        route1.flight_no AS first_flight,
        route2.flight_no AS second_flight,
        route1.departure_airport AS first_departure_airport,
        route1.arrival_airport AS first_arrival_airport,
        route2.departure_airport AS second_departure_airport,
        route2.arrival_airport AS second_arrival_airport,
        route1.scheduled_departure as first_scheduled_departure_time,
        route2.scheduled_departure as second_scheduled_departure_time,
        route1.scheduled_arrival as first_scheduled_arrival_time,
        route2.scheduled_arrival as second_scheduled_arrival_time,
        route3.flight_no as third_flight,
        CASE
            WHEN route2.flight_no IS NULL THEN 1
            ELSE 0
        END AS is_transfer
    FROM routes AS route1
    LEFT OUTER JOIN routes AS route2
    ON route1.arrival_airport = route2.departure_airport
    LEFT OUTER JOIN routes AS route3
    ON route2.arrival_airport = route3.departure_airport
    AND route3.flight_no IS NULL
),
max_1_transfer_and_non_circular_flights AS (
  SELECT
    first_flight,
    second_flight,
    first_departure_airport,
    first_arrival_airport,
    second_departure_airport,
    second_arrival_airport,
    first_scheduled_departure_time,
    second_scheduled_departure_time,
    first_scheduled_arrival_time,
    second_scheduled_arrival_time,
    is_transfer
  FROM max_1_transfer_flights
  WHERE first_departure_airport <> second_arrival_airport -- non-circular
),
max_1_transfer_and_non_circular_flights_within_24h AS (
    SELECT *
    FROM max_1_transfer_and_non_circular_flights
    WHERE second_scheduled_arrival_time - first_scheduled_departure_time <= interval '24 hours'
)
SELECT
    first_flight as first_flight_no,
    second_flight as second_flight_no,
    first_departure_airport as origin_airport,
    first_scheduled_departure_time as first_scheduled_departure_time,
    COALESCE(second_arrival_airport, first_arrival_airport) as destination_airport_code,
    COALESCE(second_scheduled_arrival_time, first_scheduled_arrival_time) as destination_arrival_time,
    CASE WHEN second_flight IS NOT NULL THEN first_arrival_airport END as transfer_airport_code,
    CASE WHEN second_flight IS NOT NULL THEN first_scheduled_arrival_time END as transfer_airport_arrival_time,
    CASE WHEN second_flight IS NOT NULL THEN second_scheduled_departure_time END as transfer_airport_departure_time
FROM max_1_transfer_and_non_circular_flights_within_24h AS valid_routes
  );
[0m15:55:31.608731 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m15:55:31.609140 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m15:55:31.609410 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */

  create view "bookings"."dbt"."redemption_bookings_number_by_day__dbt_tmp"
    
    
  as (
    SELECT
    DATE_TRUNC('day', b.book_date) AS date,
    COUNT(*) AS redemption_count
FROM bookings b
WHERE total_amount = -1
    OR total_amount = 0
    OR total_amount = -12345678.00
GROUP BY date
ORDER BY redemption_count desc
  );
[0m15:55:31.621029 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.0 seconds
[0m15:55:31.626450 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m15:55:31.626773 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.0 seconds
[0m15:55:31.627011 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.0 seconds
[0m15:55:31.627237 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */
alter table "bookings"."dbt"."ticket_sales_counts" rename to "ticket_sales_counts__dbt_backup"
[0m15:55:31.629451 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m15:55:31.631584 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m15:55:31.631900 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */
alter table "bookings"."dbt"."redemption_bookings_number_by_day" rename to "redemption_bookings_number_by_day__dbt_backup"
[0m15:55:31.632156 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */
alter table "bookings"."dbt"."valid_and_bookable_routes" rename to "valid_and_bookable_routes__dbt_backup"
[0m15:55:31.634676 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m15:55:31.634893 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m15:55:31.635104 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m15:55:31.637007 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m15:55:31.638994 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m15:55:31.640903 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m15:55:31.641165 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */
alter table "bookings"."dbt"."redemption_bookings_number_by_day__dbt_tmp" rename to "redemption_bookings_number_by_day"
[0m15:55:31.641403 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */
alter table "bookings"."dbt"."valid_and_bookable_routes__dbt_tmp" rename to "valid_and_bookable_routes"
[0m15:55:31.641619 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */
alter table "bookings"."dbt"."ticket_sales_counts__dbt_tmp" rename to "ticket_sales_counts"
[0m15:55:31.642199 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m15:55:31.642436 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m15:55:31.642639 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m15:55:31.658597 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: COMMIT
[0m15:55:31.659011 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: COMMIT
[0m15:55:31.660348 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: COMMIT
[0m15:55:31.660596 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m15:55:31.660835 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m15:55:31.661079 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m15:55:31.661317 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: COMMIT
[0m15:55:31.661554 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: COMMIT
[0m15:55:31.661822 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: COMMIT
[0m15:55:31.662655 [debug] [Thread-3  ]: SQL status: COMMIT in 0.0 seconds
[0m15:55:31.666324 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m15:55:31.666568 [debug] [Thread-1  ]: SQL status: COMMIT in 0.0 seconds
[0m15:55:31.666780 [debug] [Thread-2  ]: SQL status: COMMIT in 0.0 seconds
[0m15:55:31.667018 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */
drop view if exists "bookings"."dbt"."valid_and_bookable_routes__dbt_backup" cascade
[0m15:55:31.668762 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m15:55:31.670451 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m15:55:31.670746 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */
drop view if exists "bookings"."dbt"."redemption_bookings_number_by_day__dbt_backup" cascade
[0m15:55:31.671022 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */
drop view if exists "bookings"."dbt"."ticket_sales_counts__dbt_backup" cascade
[0m15:55:31.675625 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.0 seconds
[0m15:55:31.675887 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.0 seconds
[0m15:55:31.676128 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.0 seconds
[0m15:55:31.677171 [debug] [Thread-3  ]: Timing info for model.plaid_de.valid_and_bookable_routes (execute): 15:55:31.520370 => 15:55:31.677031
[0m15:55:31.678128 [debug] [Thread-1  ]: Timing info for model.plaid_de.redemption_bookings_number_by_day (execute): 15:55:31.559015 => 15:55:31.678001
[0m15:55:31.679041 [debug] [Thread-2  ]: Timing info for model.plaid_de.ticket_sales_counts (execute): 15:55:31.551484 => 15:55:31.678917
[0m15:55:31.679298 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: Close
[0m15:55:31.679547 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: Close
[0m15:55:31.679778 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: Close
[0m15:55:31.680284 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '03c77a2c-83ac-42d6-8ac0-7c5678e15ed0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1118b01f0>]}
[0m15:55:31.680711 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '03c77a2c-83ac-42d6-8ac0-7c5678e15ed0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1119199d0>]}
[0m15:55:31.681236 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '03c77a2c-83ac-42d6-8ac0-7c5678e15ed0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111757220>]}
[0m15:55:31.682432 [info ] [Thread-3  ]: 3 of 3 OK created sql view model dbt.valid_and_bookable_routes ................. [[32mCREATE VIEW[0m in 0.18s]
[0m15:55:31.682897 [info ] [Thread-1  ]: 1 of 3 OK created sql view model dbt.redemption_bookings_number_by_day ......... [[32mCREATE VIEW[0m in 0.18s]
[0m15:55:31.683333 [info ] [Thread-2  ]: 2 of 3 OK created sql view model dbt.ticket_sales_counts ....................... [[32mCREATE VIEW[0m in 0.18s]
[0m15:55:31.683781 [debug] [Thread-3  ]: Finished running node model.plaid_de.valid_and_bookable_routes
[0m15:55:31.684229 [debug] [Thread-1  ]: Finished running node model.plaid_de.redemption_bookings_number_by_day
[0m15:55:31.684579 [debug] [Thread-2  ]: Finished running node model.plaid_de.ticket_sales_counts
[0m15:55:31.686163 [debug] [MainThread]: Using postgres connection "master"
[0m15:55:31.686384 [debug] [MainThread]: On master: BEGIN
[0m15:55:31.686567 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:55:31.709637 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:55:31.710019 [debug] [MainThread]: On master: COMMIT
[0m15:55:31.710233 [debug] [MainThread]: Using postgres connection "master"
[0m15:55:31.710425 [debug] [MainThread]: On master: COMMIT
[0m15:55:31.710790 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:55:31.711046 [debug] [MainThread]: On master: Close
[0m15:55:31.711523 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:55:31.711705 [debug] [MainThread]: Connection 'model.plaid_de.redemption_bookings_number_by_day' was properly closed.
[0m15:55:31.711889 [debug] [MainThread]: Connection 'model.plaid_de.ticket_sales_counts' was properly closed.
[0m15:55:31.712072 [debug] [MainThread]: Connection 'model.plaid_de.valid_and_bookable_routes' was properly closed.
[0m15:55:31.712444 [info ] [MainThread]: 
[0m15:55:31.712708 [info ] [MainThread]: Finished running 3 view models in 0 hours 0 minutes and 0.82 seconds (0.82s).
[0m15:55:31.713407 [debug] [MainThread]: Command end result
[0m15:55:31.717379 [info ] [MainThread]: 
[0m15:55:31.717676 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:55:31.717931 [info ] [MainThread]: 
[0m15:55:31.718203 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m15:55:31.718674 [debug] [MainThread]: Command `dbt run` succeeded at 15:55:31.718610 after 1.00 seconds
[0m15:55:31.718907 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fb24f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11140b670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1116a9a00>]}
[0m15:55:31.719158 [debug] [MainThread]: Flushing usage events
[0m18:29:14.197900 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c810850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dd3f340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095bf6d0>]}


============================== 18:29:14.202677 | 71774c3e-41f4-46eb-b8c2-4652565bfd52 ==============================
[0m18:29:14.202677 [info ] [MainThread]: Running with dbt=1.5.4
[0m18:29:14.203131 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '.', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m18:29:14.308588 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '71774c3e-41f4-46eb-b8c2-4652565bfd52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095bf640>]}
[0m18:29:14.320631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '71774c3e-41f4-46eb-b8c2-4652565bfd52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e0f76a0>]}
[0m18:29:14.321114 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m18:29:14.357571 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m18:29:14.405714 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:29:14.406160 [debug] [MainThread]: Partial parsing: updated file: plaid_de://models/analytics/valid_and_bookable_routes.sql
[0m18:29:14.425969 [debug] [MainThread]: 1699: static parser successfully parsed analytics/valid_and_bookable_routes.sql
[0m18:29:14.440741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '71774c3e-41f4-46eb-b8c2-4652565bfd52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e419dc0>]}
[0m18:29:14.445898 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '71774c3e-41f4-46eb-b8c2-4652565bfd52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e34a640>]}
[0m18:29:14.446194 [info ] [MainThread]: Found 3 models, 0 tests, 0 snapshots, 0 analyses, 307 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m18:29:14.446456 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '71774c3e-41f4-46eb-b8c2-4652565bfd52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e34a5b0>]}
[0m18:29:14.447383 [info ] [MainThread]: 
[0m18:29:14.447850 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:29:14.448543 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bookings'
[0m18:29:14.455310 [debug] [ThreadPool]: Using postgres connection "list_bookings"
[0m18:29:14.455529 [debug] [ThreadPool]: On list_bookings: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings"} */

    select distinct nspname from pg_namespace
  
[0m18:29:14.455719 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:29:14.950184 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.0 seconds
[0m18:29:14.954918 [debug] [ThreadPool]: On list_bookings: Close
[0m18:29:14.958280 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bookings, now list_bookings_dbt)
[0m18:29:14.967129 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m18:29:14.967530 [debug] [ThreadPool]: On list_bookings_dbt: BEGIN
[0m18:29:14.967779 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:29:14.992057 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m18:29:14.992391 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m18:29:14.992669 [debug] [ThreadPool]: On list_bookings_dbt: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings_dbt"} */
select
      'bookings' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'bookings' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
[0m18:29:15.033755 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m18:29:15.040009 [debug] [ThreadPool]: On list_bookings_dbt: ROLLBACK
[0m18:29:15.041384 [debug] [ThreadPool]: On list_bookings_dbt: Close
[0m18:29:15.058970 [debug] [MainThread]: Using postgres connection "master"
[0m18:29:15.060230 [debug] [MainThread]: On master: BEGIN
[0m18:29:15.060969 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:29:15.094951 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m18:29:15.095301 [debug] [MainThread]: Using postgres connection "master"
[0m18:29:15.095587 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m18:29:15.197301 [debug] [MainThread]: SQL status: SELECT 10 in 0.0 seconds
[0m18:29:15.203526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '71774c3e-41f4-46eb-b8c2-4652565bfd52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e34a340>]}
[0m18:29:15.205568 [debug] [MainThread]: On master: ROLLBACK
[0m18:29:15.207735 [debug] [MainThread]: Using postgres connection "master"
[0m18:29:15.208254 [debug] [MainThread]: On master: BEGIN
[0m18:29:15.209467 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m18:29:15.209937 [debug] [MainThread]: On master: COMMIT
[0m18:29:15.210656 [debug] [MainThread]: Using postgres connection "master"
[0m18:29:15.211773 [debug] [MainThread]: On master: COMMIT
[0m18:29:15.213455 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m18:29:15.214652 [debug] [MainThread]: On master: Close
[0m18:29:15.217120 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:29:15.217870 [info ] [MainThread]: 
[0m18:29:15.240196 [debug] [Thread-1  ]: Began running node model.plaid_de.redemption_bookings_number_by_day
[0m18:29:15.241025 [debug] [Thread-2  ]: Began running node model.plaid_de.ticket_sales_counts
[0m18:29:15.241298 [debug] [Thread-3  ]: Began running node model.plaid_de.valid_and_bookable_routes
[0m18:29:15.240729 [info ] [Thread-1  ]: 1 of 3 START sql view model dbt.redemption_bookings_number_by_day .............. [RUN]
[0m18:29:15.241834 [info ] [Thread-2  ]: 2 of 3 START sql view model dbt.ticket_sales_counts ............................ [RUN]
[0m18:29:15.242249 [info ] [Thread-3  ]: 3 of 3 START sql view model dbt.valid_and_bookable_routes ...................... [RUN]
[0m18:29:15.242847 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bookings_dbt, now model.plaid_de.redemption_bookings_number_by_day)
[0m18:29:15.243344 [debug] [Thread-2  ]: Acquiring new postgres connection 'model.plaid_de.ticket_sales_counts'
[0m18:29:15.243839 [debug] [Thread-3  ]: Acquiring new postgres connection 'model.plaid_de.valid_and_bookable_routes'
[0m18:29:15.244096 [debug] [Thread-1  ]: Began compiling node model.plaid_de.redemption_bookings_number_by_day
[0m18:29:15.244336 [debug] [Thread-2  ]: Began compiling node model.plaid_de.ticket_sales_counts
[0m18:29:15.244605 [debug] [Thread-3  ]: Began compiling node model.plaid_de.valid_and_bookable_routes
[0m18:29:15.251450 [debug] [Thread-1  ]: Writing injected SQL for node "model.plaid_de.redemption_bookings_number_by_day"
[0m18:29:15.252749 [debug] [Thread-2  ]: Writing injected SQL for node "model.plaid_de.ticket_sales_counts"
[0m18:29:15.254128 [debug] [Thread-3  ]: Writing injected SQL for node "model.plaid_de.valid_and_bookable_routes"
[0m18:29:15.256178 [debug] [Thread-2  ]: Timing info for model.plaid_de.ticket_sales_counts (compile): 18:29:15.251667 => 18:29:15.255974
[0m18:29:15.256516 [debug] [Thread-3  ]: Timing info for model.plaid_de.valid_and_bookable_routes (compile): 18:29:15.252951 => 18:29:15.256342
[0m18:29:15.256903 [debug] [Thread-2  ]: Began executing node model.plaid_de.ticket_sales_counts
[0m18:29:15.257295 [debug] [Thread-3  ]: Began executing node model.plaid_de.valid_and_bookable_routes
[0m18:29:15.257606 [debug] [Thread-1  ]: Timing info for model.plaid_de.redemption_bookings_number_by_day (compile): 18:29:15.244811 => 18:29:15.257457
[0m18:29:15.296532 [debug] [Thread-2  ]: Writing runtime sql for node "model.plaid_de.ticket_sales_counts"
[0m18:29:15.296946 [debug] [Thread-3  ]: Writing runtime sql for node "model.plaid_de.valid_and_bookable_routes"
[0m18:29:15.297261 [debug] [Thread-1  ]: Began executing node model.plaid_de.redemption_bookings_number_by_day
[0m18:29:15.300510 [debug] [Thread-1  ]: Writing runtime sql for node "model.plaid_de.redemption_bookings_number_by_day"
[0m18:29:15.300968 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m18:29:15.301211 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m18:29:15.301474 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: BEGIN
[0m18:29:15.301706 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m18:29:15.301938 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: BEGIN
[0m18:29:15.302174 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m18:29:15.302395 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: BEGIN
[0m18:29:15.302613 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m18:29:15.302922 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m18:29:15.321288 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m18:29:15.323813 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m18:29:15.324572 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */

  create view "bookings"."dbt"."redemption_bookings_number_by_day__dbt_tmp"
    
    
  as (
    SELECT
    DATE_TRUNC('day', b.book_date) AS date,
    COUNT(*) AS redemption_count
FROM bookings b
WHERE total_amount = -1
    OR total_amount = 0
    OR total_amount = -12345678.00
GROUP BY date
ORDER BY redemption_count desc
  );
[0m18:29:15.325895 [debug] [Thread-3  ]: SQL status: BEGIN in 0.0 seconds
[0m18:29:15.326143 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m18:29:15.326769 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */

  create view "bookings"."dbt"."valid_and_bookable_routes__dbt_tmp"
    
    
  as (
    WITH no_transfer_flights AS (
    SELECT
        route1.flight_no AS first_flight,
        NULL AS second_flight,
        route1.departure_airport AS first_departure_airport,
        route1.arrival_airport AS first_arrival_airport,
        NULL AS second_departure_airport,
        NULL AS second_arrival_airport,
        route1.scheduled_departure as first_scheduled_departure_time,
        NULL::time without time zone as second_scheduled_departure_time,
        route1.scheduled_arrival as first_scheduled_arrival_time,
        NULL::time without time zone as second_scheduled_arrival_time
    FROM routes AS route1
),
one_transfer_flights AS (
    SELECT
        route1.flight_no AS first_flight,
        route2.flight_no AS second_flight,
        route1.departure_airport AS first_departure_airport,
        route1.arrival_airport AS first_arrival_airport,
        route2.departure_airport AS second_departure_airport,
        route2.arrival_airport AS second_arrival_airport,
        route1.scheduled_departure as first_scheduled_departure_time,
        route2.scheduled_departure as second_scheduled_departure_time,
        route1.scheduled_arrival as first_scheduled_arrival_time,
        route2.scheduled_arrival as second_scheduled_arrival_time
    FROM routes AS route1
    LEFT OUTER JOIN routes AS route2
    ON route1.arrival_airport = route2.departure_airport
),
max_1_transfer_and_non_circular_flights AS (
  SELECT
    first_flight,
    second_flight,
    first_departure_airport,
    first_arrival_airport,
    second_departure_airport,
    second_arrival_airport,
    first_scheduled_departure_time,
    second_scheduled_departure_time,
    first_scheduled_arrival_time,
    second_scheduled_arrival_time
  FROM one_transfer_flights
  WHERE first_departure_airport <> second_arrival_airport -- non-circular
  UNION ALL
  SELECT
    first_flight,
    second_flight,
    first_departure_airport,
    first_arrival_airport,
    second_departure_airport,
    second_arrival_airport,
    first_scheduled_departure_time,
    second_scheduled_departure_time,
    first_scheduled_arrival_time,
    second_scheduled_arrival_time
  FROM no_transfer_flights
),
max_1_transfer_and_non_circular_flights_within_24h AS (
    SELECT *
    FROM max_1_transfer_and_non_circular_flights
    WHERE first_scheduled_departure_time NOT BETWEEN second_scheduled_departure_time AND second_scheduled_arrival_time  -- since we have no dates, this is a good trick I think to figure out if the flights took more than 24 hours?
) SELECT
    first_flight as first_flight_no,
    second_flight as second_flight_no,
    first_departure_airport as origin_airport,
    first_scheduled_departure_time as first_scheduled_departure_time,
    COALESCE(second_arrival_airport, first_arrival_airport) as destination_airport_code,
    COALESCE(second_scheduled_arrival_time, first_scheduled_arrival_time) as destination_arrival_time,
    CASE WHEN is_transfer = 1 THEN first_arrival_airport END as transfer_airport_code,
    CASE WHEN is_transfer = 1 THEN first_scheduled_arrival_time END as transfer_airport_arrival_time,
    CASE WHEN is_transfer = 1 THEN second_scheduled_departure_time END as transfer_airport_departure_time
FROM max_1_transfer_and_non_circular_flights_within_24h AS valid_routes
  );
[0m18:29:15.331350 [debug] [Thread-3  ]: Postgres adapter: Postgres error: column "is_transfer" does not exist
LINE 76:     CASE WHEN is_transfer = 1 THEN first_arrival_airport END...
                       ^

[0m18:29:15.331668 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: ROLLBACK
[0m18:29:15.333144 [debug] [Thread-3  ]: Timing info for model.plaid_de.valid_and_bookable_routes (execute): 18:29:15.275509 => 18:29:15.332871
[0m18:29:15.333423 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: Close
[0m18:29:15.337531 [debug] [Thread-2  ]: SQL status: BEGIN in 0.0 seconds
[0m18:29:15.337814 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m18:29:15.338174 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */

  create view "bookings"."dbt"."ticket_sales_counts__dbt_tmp"
    
    
  as (
    WITH daily_ticket_sales AS (
    SELECT
        DATE_TRUNC('day', b.book_date) AS sale_date,
        COUNT(t.ticket_no) AS total_tickets
    FROM bookings b
    JOIN tickets t ON b.book_ref = t.book_ref
    GROUP BY sale_date
),

rolling_7d_ticket_sales AS (
    SELECT
        sale_date,
        SUM(total_tickets) OVER (ORDER BY sale_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS rolling_7_days_total
    FROM daily_ticket_sales
),

rolling_28d_ticket_sales AS (
    SELECT
        sale_date,
        SUM(total_tickets) OVER (ORDER BY sale_date ROWS BETWEEN 27 PRECEDING AND CURRENT ROW) AS rolling_28_days_total
    FROM daily_ticket_sales
)
SELECT
    dts.sale_date AS date,
    dts.total_tickets AS daily_total_tickets,
    rolling_7d.rolling_7_days_total,
    rolling_28d.rolling_28_days_total
FROM daily_ticket_sales dts
LEFT JOIN rolling_7d_ticket_sales AS rolling_7d
    ON dts.sale_date = rolling_7d.sale_date
LEFT JOIN rolling_28d_ticket_sales AS rolling_28d
    ON dts.sale_date = rolling_28d.sale_date
  );
[0m18:29:15.341793 [debug] [Thread-3  ]: Database Error in model valid_and_bookable_routes (models/analytics/valid_and_bookable_routes.sql)
  column "is_transfer" does not exist
  LINE 76:     CASE WHEN is_transfer = 1 THEN first_arrival_airport END...
                         ^
  compiled Code at target/run/plaid_de/models/analytics/valid_and_bookable_routes.sql
[0m18:29:15.342175 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '71774c3e-41f4-46eb-b8c2-4652565bfd52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e4e5f40>]}
[0m18:29:15.343485 [error] [Thread-3  ]: 3 of 3 ERROR creating sql view model dbt.valid_and_bookable_routes ............. [[31mERROR[0m in 0.10s]
[0m18:29:15.343957 [debug] [Thread-3  ]: Finished running node model.plaid_de.valid_and_bookable_routes
[0m18:29:15.370086 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.0 seconds
[0m18:29:15.370396 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.0 seconds
[0m18:29:15.375914 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m18:29:15.378164 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m18:29:15.378457 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */
alter table "bookings"."dbt"."redemption_bookings_number_by_day" rename to "redemption_bookings_number_by_day__dbt_backup"
[0m18:29:15.378721 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */
alter table "bookings"."dbt"."ticket_sales_counts" rename to "ticket_sales_counts__dbt_backup"
[0m18:29:15.381069 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:29:15.383164 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m18:29:15.383401 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:29:15.383618 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */
alter table "bookings"."dbt"."redemption_bookings_number_by_day__dbt_tmp" rename to "redemption_bookings_number_by_day"
[0m18:29:15.385598 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m18:29:15.385880 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */
alter table "bookings"."dbt"."ticket_sales_counts__dbt_tmp" rename to "ticket_sales_counts"
[0m18:29:15.386105 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:29:15.391741 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:29:15.399675 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: COMMIT
[0m18:29:15.401197 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: COMMIT
[0m18:29:15.401491 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m18:29:15.401778 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m18:29:15.402041 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: COMMIT
[0m18:29:15.402278 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: COMMIT
[0m18:29:15.410725 [debug] [Thread-1  ]: SQL status: COMMIT in 0.0 seconds
[0m18:29:15.410976 [debug] [Thread-2  ]: SQL status: COMMIT in 0.0 seconds
[0m18:29:15.414662 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m18:29:15.416713 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m18:29:15.416988 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */
drop view if exists "bookings"."dbt"."redemption_bookings_number_by_day__dbt_backup" cascade
[0m18:29:15.417237 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */
drop view if exists "bookings"."dbt"."ticket_sales_counts__dbt_backup" cascade
[0m18:29:15.424664 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.0 seconds
[0m18:29:15.425678 [debug] [Thread-1  ]: Timing info for model.plaid_de.redemption_bookings_number_by_day (execute): 18:29:15.297594 => 18:29:15.425546
[0m18:29:15.425908 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.0 seconds
[0m18:29:15.426131 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: Close
[0m18:29:15.427041 [debug] [Thread-2  ]: Timing info for model.plaid_de.ticket_sales_counts (execute): 18:29:15.257801 => 18:29:15.426922
[0m18:29:15.427547 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '71774c3e-41f4-46eb-b8c2-4652565bfd52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e45ea90>]}
[0m18:29:15.427778 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: Close
[0m18:29:15.428175 [info ] [Thread-1  ]: 1 of 3 OK created sql view model dbt.redemption_bookings_number_by_day ......... [[32mCREATE VIEW[0m in 0.18s]
[0m18:29:15.428660 [debug] [Thread-1  ]: Finished running node model.plaid_de.redemption_bookings_number_by_day
[0m18:29:15.429185 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '71774c3e-41f4-46eb-b8c2-4652565bfd52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e5fbbe0>]}
[0m18:29:15.429655 [info ] [Thread-2  ]: 2 of 3 OK created sql view model dbt.ticket_sales_counts ....................... [[32mCREATE VIEW[0m in 0.19s]
[0m18:29:15.430076 [debug] [Thread-2  ]: Finished running node model.plaid_de.ticket_sales_counts
[0m18:29:15.430931 [debug] [MainThread]: Using postgres connection "master"
[0m18:29:15.431116 [debug] [MainThread]: On master: BEGIN
[0m18:29:15.431292 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:29:15.441438 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m18:29:15.441692 [debug] [MainThread]: On master: COMMIT
[0m18:29:15.442804 [debug] [MainThread]: Using postgres connection "master"
[0m18:29:15.443028 [debug] [MainThread]: On master: COMMIT
[0m18:29:15.443393 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m18:29:15.443598 [debug] [MainThread]: On master: Close
[0m18:29:15.443989 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:29:15.444165 [debug] [MainThread]: Connection 'model.plaid_de.redemption_bookings_number_by_day' was properly closed.
[0m18:29:15.444323 [debug] [MainThread]: Connection 'model.plaid_de.ticket_sales_counts' was properly closed.
[0m18:29:15.444478 [debug] [MainThread]: Connection 'model.plaid_de.valid_and_bookable_routes' was properly closed.
[0m18:29:15.444827 [info ] [MainThread]: 
[0m18:29:15.445089 [info ] [MainThread]: Finished running 3 view models in 0 hours 0 minutes and 1.00 seconds (1.00s).
[0m18:29:15.445709 [debug] [MainThread]: Command end result
[0m18:29:15.449719 [info ] [MainThread]: 
[0m18:29:15.450007 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:29:15.450241 [info ] [MainThread]: 
[0m18:29:15.450476 [error] [MainThread]: [33mDatabase Error in model valid_and_bookable_routes (models/analytics/valid_and_bookable_routes.sql)[0m
[0m18:29:15.450701 [error] [MainThread]:   column "is_transfer" does not exist
[0m18:29:15.450922 [error] [MainThread]:   LINE 76:     CASE WHEN is_transfer = 1 THEN first_arrival_airport END...
[0m18:29:15.451138 [error] [MainThread]:                          ^
[0m18:29:15.451351 [error] [MainThread]:   compiled Code at target/run/plaid_de/models/analytics/valid_and_bookable_routes.sql
[0m18:29:15.451568 [info ] [MainThread]: 
[0m18:29:15.451824 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m18:29:15.452290 [debug] [MainThread]: Command `dbt run` failed at 18:29:15.452228 after 1.30 seconds
[0m18:29:15.453207 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c810850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e3c52e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e110100>]}
[0m18:29:15.453479 [debug] [MainThread]: Flushing usage events
[0m18:29:52.365366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f985a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110eb4340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c6bf6d0>]}


============================== 18:29:52.371393 | 01a38a2b-b44d-43e2-bad3-82f9a4531c1b ==============================
[0m18:29:52.371393 [info ] [MainThread]: Running with dbt=1.5.4
[0m18:29:52.371844 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '.', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m18:29:52.423174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '01a38a2b-b44d-43e2-bad3-82f9a4531c1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c6bf640>]}
[0m18:29:52.436037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '01a38a2b-b44d-43e2-bad3-82f9a4531c1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11126c6d0>]}
[0m18:29:52.436522 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m18:29:52.452895 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m18:29:52.508409 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:29:52.508857 [debug] [MainThread]: Partial parsing: updated file: plaid_de://models/analytics/valid_and_bookable_routes.sql
[0m18:29:52.529159 [debug] [MainThread]: 1699: static parser successfully parsed analytics/valid_and_bookable_routes.sql
[0m18:29:52.544317 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '01a38a2b-b44d-43e2-bad3-82f9a4531c1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11158edf0>]}
[0m18:29:52.548848 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '01a38a2b-b44d-43e2-bad3-82f9a4531c1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1114c0670>]}
[0m18:29:52.549173 [info ] [MainThread]: Found 3 models, 0 tests, 0 snapshots, 0 analyses, 307 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m18:29:52.549437 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '01a38a2b-b44d-43e2-bad3-82f9a4531c1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1114c05e0>]}
[0m18:29:52.550382 [info ] [MainThread]: 
[0m18:29:52.550892 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:29:52.551576 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bookings'
[0m18:29:52.558525 [debug] [ThreadPool]: Using postgres connection "list_bookings"
[0m18:29:52.558758 [debug] [ThreadPool]: On list_bookings: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings"} */

    select distinct nspname from pg_namespace
  
[0m18:29:52.558954 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:29:52.598813 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.0 seconds
[0m18:29:52.599831 [debug] [ThreadPool]: On list_bookings: Close
[0m18:29:52.600791 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bookings, now list_bookings_dbt)
[0m18:29:52.604743 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m18:29:52.604950 [debug] [ThreadPool]: On list_bookings_dbt: BEGIN
[0m18:29:52.605217 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:29:52.632009 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m18:29:52.632274 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m18:29:52.632503 [debug] [ThreadPool]: On list_bookings_dbt: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings_dbt"} */
select
      'bookings' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'bookings' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
[0m18:29:52.638445 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m18:29:52.639465 [debug] [ThreadPool]: On list_bookings_dbt: ROLLBACK
[0m18:29:52.640101 [debug] [ThreadPool]: On list_bookings_dbt: Close
[0m18:29:52.644009 [debug] [MainThread]: Using postgres connection "master"
[0m18:29:52.644273 [debug] [MainThread]: On master: BEGIN
[0m18:29:52.644469 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:29:52.658784 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m18:29:52.659072 [debug] [MainThread]: Using postgres connection "master"
[0m18:29:52.659369 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m18:29:52.688111 [debug] [MainThread]: SQL status: SELECT 10 in 0.0 seconds
[0m18:29:52.689410 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '01a38a2b-b44d-43e2-bad3-82f9a4531c1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1114c0220>]}
[0m18:29:52.689769 [debug] [MainThread]: On master: ROLLBACK
[0m18:29:52.691348 [debug] [MainThread]: Using postgres connection "master"
[0m18:29:52.691580 [debug] [MainThread]: On master: BEGIN
[0m18:29:52.692253 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m18:29:52.692540 [debug] [MainThread]: On master: COMMIT
[0m18:29:52.692779 [debug] [MainThread]: Using postgres connection "master"
[0m18:29:52.693000 [debug] [MainThread]: On master: COMMIT
[0m18:29:52.693660 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m18:29:52.693958 [debug] [MainThread]: On master: Close
[0m18:29:52.694531 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:29:52.694859 [info ] [MainThread]: 
[0m18:29:52.699331 [debug] [Thread-1  ]: Began running node model.plaid_de.redemption_bookings_number_by_day
[0m18:29:52.699635 [debug] [Thread-2  ]: Began running node model.plaid_de.ticket_sales_counts
[0m18:29:52.699922 [debug] [Thread-3  ]: Began running node model.plaid_de.valid_and_bookable_routes
[0m18:29:52.700303 [info ] [Thread-1  ]: 1 of 3 START sql view model dbt.redemption_bookings_number_by_day .............. [RUN]
[0m18:29:52.700737 [info ] [Thread-2  ]: 2 of 3 START sql view model dbt.ticket_sales_counts ............................ [RUN]
[0m18:29:52.701160 [info ] [Thread-3  ]: 3 of 3 START sql view model dbt.valid_and_bookable_routes ...................... [RUN]
[0m18:29:52.701698 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bookings_dbt, now model.plaid_de.redemption_bookings_number_by_day)
[0m18:29:52.702193 [debug] [Thread-2  ]: Acquiring new postgres connection 'model.plaid_de.ticket_sales_counts'
[0m18:29:52.702670 [debug] [Thread-3  ]: Acquiring new postgres connection 'model.plaid_de.valid_and_bookable_routes'
[0m18:29:52.702947 [debug] [Thread-1  ]: Began compiling node model.plaid_de.redemption_bookings_number_by_day
[0m18:29:52.703209 [debug] [Thread-2  ]: Began compiling node model.plaid_de.ticket_sales_counts
[0m18:29:52.703450 [debug] [Thread-3  ]: Began compiling node model.plaid_de.valid_and_bookable_routes
[0m18:29:52.708879 [debug] [Thread-1  ]: Writing injected SQL for node "model.plaid_de.redemption_bookings_number_by_day"
[0m18:29:52.710010 [debug] [Thread-2  ]: Writing injected SQL for node "model.plaid_de.ticket_sales_counts"
[0m18:29:52.711115 [debug] [Thread-3  ]: Writing injected SQL for node "model.plaid_de.valid_and_bookable_routes"
[0m18:29:52.712490 [debug] [Thread-1  ]: Timing info for model.plaid_de.redemption_bookings_number_by_day (compile): 18:29:52.703622 => 18:29:52.712338
[0m18:29:52.712794 [debug] [Thread-3  ]: Timing info for model.plaid_de.valid_and_bookable_routes (compile): 18:29:52.710182 => 18:29:52.712653
[0m18:29:52.713021 [debug] [Thread-1  ]: Began executing node model.plaid_de.redemption_bookings_number_by_day
[0m18:29:52.713271 [debug] [Thread-2  ]: Timing info for model.plaid_de.ticket_sales_counts (compile): 18:29:52.709067 => 18:29:52.713156
[0m18:29:52.713501 [debug] [Thread-3  ]: Began executing node model.plaid_de.valid_and_bookable_routes
[0m18:29:52.739569 [debug] [Thread-2  ]: Began executing node model.plaid_de.ticket_sales_counts
[0m18:29:52.740624 [debug] [Thread-1  ]: Writing runtime sql for node "model.plaid_de.redemption_bookings_number_by_day"
[0m18:29:52.743682 [debug] [Thread-3  ]: Writing runtime sql for node "model.plaid_de.valid_and_bookable_routes"
[0m18:29:52.746619 [debug] [Thread-2  ]: Writing runtime sql for node "model.plaid_de.ticket_sales_counts"
[0m18:29:52.747251 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m18:29:52.747487 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m18:29:52.747731 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m18:29:52.747926 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: BEGIN
[0m18:29:52.748130 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: BEGIN
[0m18:29:52.748343 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: BEGIN
[0m18:29:52.748556 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m18:29:52.748757 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m18:29:52.748969 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m18:29:52.761179 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m18:29:52.761475 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m18:29:52.761724 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */

  create view "bookings"."dbt"."redemption_bookings_number_by_day__dbt_tmp"
    
    
  as (
    SELECT
    DATE_TRUNC('day', b.book_date) AS date,
    COUNT(*) AS redemption_count
FROM bookings b
WHERE total_amount = -1
    OR total_amount = 0
    OR total_amount = -12345678.00
GROUP BY date
ORDER BY redemption_count desc
  );
[0m18:29:52.762015 [debug] [Thread-2  ]: SQL status: BEGIN in 0.0 seconds
[0m18:29:52.762277 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m18:29:52.762558 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */

  create view "bookings"."dbt"."ticket_sales_counts__dbt_tmp"
    
    
  as (
    WITH daily_ticket_sales AS (
    SELECT
        DATE_TRUNC('day', b.book_date) AS sale_date,
        COUNT(t.ticket_no) AS total_tickets
    FROM bookings b
    JOIN tickets t ON b.book_ref = t.book_ref
    GROUP BY sale_date
),

rolling_7d_ticket_sales AS (
    SELECT
        sale_date,
        SUM(total_tickets) OVER (ORDER BY sale_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS rolling_7_days_total
    FROM daily_ticket_sales
),

rolling_28d_ticket_sales AS (
    SELECT
        sale_date,
        SUM(total_tickets) OVER (ORDER BY sale_date ROWS BETWEEN 27 PRECEDING AND CURRENT ROW) AS rolling_28_days_total
    FROM daily_ticket_sales
)
SELECT
    dts.sale_date AS date,
    dts.total_tickets AS daily_total_tickets,
    rolling_7d.rolling_7_days_total,
    rolling_28d.rolling_28_days_total
FROM daily_ticket_sales dts
LEFT JOIN rolling_7d_ticket_sales AS rolling_7d
    ON dts.sale_date = rolling_7d.sale_date
LEFT JOIN rolling_28d_ticket_sales AS rolling_28d
    ON dts.sale_date = rolling_28d.sale_date
  );
[0m18:29:52.765070 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.0 seconds
[0m18:29:52.765304 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.0 seconds
[0m18:29:52.770281 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m18:29:52.772400 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m18:29:52.772617 [debug] [Thread-3  ]: SQL status: BEGIN in 0.0 seconds
[0m18:29:52.772871 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */
alter table "bookings"."dbt"."redemption_bookings_number_by_day" rename to "redemption_bookings_number_by_day__dbt_backup"
[0m18:29:52.773124 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */
alter table "bookings"."dbt"."ticket_sales_counts" rename to "ticket_sales_counts__dbt_backup"
[0m18:29:52.773346 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m18:29:52.773809 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */

  create view "bookings"."dbt"."valid_and_bookable_routes__dbt_tmp"
    
    
  as (
    WITH no_transfer_flights AS (
    SELECT
        route1.flight_no AS first_flight,
        NULL AS second_flight,
        route1.departure_airport AS first_departure_airport,
        route1.arrival_airport AS first_arrival_airport,
        NULL AS second_departure_airport,
        NULL AS second_arrival_airport,
        route1.scheduled_departure as first_scheduled_departure_time,
        NULL::time without time zone as second_scheduled_departure_time,
        route1.scheduled_arrival as first_scheduled_arrival_time,
        NULL::time without time zone as second_scheduled_arrival_time
    FROM routes AS route1
),
one_transfer_flights AS (
    SELECT
        route1.flight_no AS first_flight,
        route2.flight_no AS second_flight,
        route1.departure_airport AS first_departure_airport,
        route1.arrival_airport AS first_arrival_airport,
        route2.departure_airport AS second_departure_airport,
        route2.arrival_airport AS second_arrival_airport,
        route1.scheduled_departure as first_scheduled_departure_time,
        route2.scheduled_departure as second_scheduled_departure_time,
        route1.scheduled_arrival as first_scheduled_arrival_time,
        route2.scheduled_arrival as second_scheduled_arrival_time
    FROM routes AS route1
    LEFT OUTER JOIN routes AS route2
    ON route1.arrival_airport = route2.departure_airport
),
max_1_transfer_and_non_circular_flights AS (
  SELECT
    first_flight,
    second_flight,
    first_departure_airport,
    first_arrival_airport,
    second_departure_airport,
    second_arrival_airport,
    first_scheduled_departure_time,
    second_scheduled_departure_time,
    first_scheduled_arrival_time,
    second_scheduled_arrival_time
  FROM one_transfer_flights
  WHERE first_departure_airport <> second_arrival_airport -- non-circular
  UNION ALL
  SELECT
    first_flight,
    second_flight,
    first_departure_airport,
    first_arrival_airport,
    second_departure_airport,
    second_arrival_airport,
    first_scheduled_departure_time,
    second_scheduled_departure_time,
    first_scheduled_arrival_time,
    second_scheduled_arrival_time
  FROM no_transfer_flights
),
max_1_transfer_and_non_circular_flights_within_24h AS (
    SELECT *
    FROM max_1_transfer_and_non_circular_flights
    WHERE first_scheduled_departure_time NOT BETWEEN second_scheduled_departure_time AND second_scheduled_arrival_time  -- since we have no dates, this is a good trick I think to figure out if the flights took more than 24 hours?
) SELECT
    first_flight as first_flight_no,
    second_flight as second_flight_no,
    first_departure_airport as origin_airport,
    COALESCE(second_arrival_airport, first_arrival_airport) as destination_airport_code,
    CASE WHEN second_flight IS NOT NULL THEN first_arrival_airport END as transfer_airport_code,
    first_scheduled_departure_time as first_scheduled_departure_time,
    CASE WHEN second_flight IS NOT NULL THEN first_scheduled_arrival_time END as transfer_airport_arrival_time,
    CASE WHEN second_flight IS NOT NULL THEN second_scheduled_departure_time END as transfer_airport_departure_time,
    COALESCE(second_scheduled_arrival_time, first_scheduled_arrival_time) as destination_arrival_time
FROM max_1_transfer_and_non_circular_flights_within_24h AS valid_routes
  );
[0m18:29:52.775811 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:29:52.776053 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:29:52.778102 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m18:29:52.780212 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m18:29:52.780494 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.0 seconds
[0m18:29:52.780760 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */
alter table "bookings"."dbt"."redemption_bookings_number_by_day__dbt_tmp" rename to "redemption_bookings_number_by_day"
[0m18:29:52.781014 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */
alter table "bookings"."dbt"."ticket_sales_counts__dbt_tmp" rename to "ticket_sales_counts"
[0m18:29:52.783043 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m18:29:52.783359 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */
alter table "bookings"."dbt"."valid_and_bookable_routes" rename to "valid_and_bookable_routes__dbt_backup"
[0m18:29:52.784860 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:29:52.785075 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:29:52.785288 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:29:52.787217 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m18:29:52.799362 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: COMMIT
[0m18:29:52.800652 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: COMMIT
[0m18:29:52.800909 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */
alter table "bookings"."dbt"."valid_and_bookable_routes__dbt_tmp" rename to "valid_and_bookable_routes"
[0m18:29:52.801151 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m18:29:52.801364 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m18:29:52.801638 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: COMMIT
[0m18:29:52.801881 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: COMMIT
[0m18:29:52.802096 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:29:52.803599 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: COMMIT
[0m18:29:52.803885 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m18:29:52.804121 [debug] [Thread-1  ]: SQL status: COMMIT in 0.0 seconds
[0m18:29:52.804361 [debug] [Thread-2  ]: SQL status: COMMIT in 0.0 seconds
[0m18:29:52.804598 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: COMMIT
[0m18:29:52.808413 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m18:29:52.810127 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m18:29:52.810445 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */
drop view if exists "bookings"."dbt"."redemption_bookings_number_by_day__dbt_backup" cascade
[0m18:29:52.810708 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */
drop view if exists "bookings"."dbt"."ticket_sales_counts__dbt_backup" cascade
[0m18:29:52.811035 [debug] [Thread-3  ]: SQL status: COMMIT in 0.0 seconds
[0m18:29:52.812798 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m18:29:52.813034 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.0 seconds
[0m18:29:52.813238 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.0 seconds
[0m18:29:52.813479 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */
drop view if exists "bookings"."dbt"."valid_and_bookable_routes__dbt_backup" cascade
[0m18:29:52.814531 [debug] [Thread-1  ]: Timing info for model.plaid_de.redemption_bookings_number_by_day (execute): 18:29:52.714565 => 18:29:52.814395
[0m18:29:52.815401 [debug] [Thread-2  ]: Timing info for model.plaid_de.ticket_sales_counts (execute): 18:29:52.743864 => 18:29:52.815289
[0m18:29:52.815703 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: Close
[0m18:29:52.815949 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: Close
[0m18:29:52.816461 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01a38a2b-b44d-43e2-bad3-82f9a4531c1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111771c10>]}
[0m18:29:52.816900 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01a38a2b-b44d-43e2-bad3-82f9a4531c1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1117cbc10>]}
[0m18:29:52.818018 [info ] [Thread-1  ]: 1 of 3 OK created sql view model dbt.redemption_bookings_number_by_day ......... [[32mCREATE VIEW[0m in 0.11s]
[0m18:29:52.818709 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.0 seconds
[0m18:29:52.818477 [info ] [Thread-2  ]: 2 of 3 OK created sql view model dbt.ticket_sales_counts ....................... [[32mCREATE VIEW[0m in 0.11s]
[0m18:29:52.819190 [debug] [Thread-1  ]: Finished running node model.plaid_de.redemption_bookings_number_by_day
[0m18:29:52.820176 [debug] [Thread-3  ]: Timing info for model.plaid_de.valid_and_bookable_routes (execute): 18:29:52.740825 => 18:29:52.820048
[0m18:29:52.820537 [debug] [Thread-2  ]: Finished running node model.plaid_de.ticket_sales_counts
[0m18:29:52.820867 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: Close
[0m18:29:52.821369 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01a38a2b-b44d-43e2-bad3-82f9a4531c1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11177bd90>]}
[0m18:29:52.824481 [info ] [Thread-3  ]: 3 of 3 OK created sql view model dbt.valid_and_bookable_routes ................. [[32mCREATE VIEW[0m in 0.12s]
[0m18:29:52.824907 [debug] [Thread-3  ]: Finished running node model.plaid_de.valid_and_bookable_routes
[0m18:29:52.825774 [debug] [MainThread]: Using postgres connection "master"
[0m18:29:52.825973 [debug] [MainThread]: On master: BEGIN
[0m18:29:52.826144 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:29:52.841328 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m18:29:52.841754 [debug] [MainThread]: On master: COMMIT
[0m18:29:52.841998 [debug] [MainThread]: Using postgres connection "master"
[0m18:29:52.842199 [debug] [MainThread]: On master: COMMIT
[0m18:29:52.842961 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m18:29:52.843171 [debug] [MainThread]: On master: Close
[0m18:29:52.843671 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:29:52.843896 [debug] [MainThread]: Connection 'model.plaid_de.redemption_bookings_number_by_day' was properly closed.
[0m18:29:52.844105 [debug] [MainThread]: Connection 'model.plaid_de.ticket_sales_counts' was properly closed.
[0m18:29:52.845075 [debug] [MainThread]: Connection 'model.plaid_de.valid_and_bookable_routes' was properly closed.
[0m18:29:52.845715 [info ] [MainThread]: 
[0m18:29:52.846042 [info ] [MainThread]: Finished running 3 view models in 0 hours 0 minutes and 0.29 seconds (0.29s).
[0m18:29:52.846933 [debug] [MainThread]: Command end result
[0m18:29:52.852305 [info ] [MainThread]: 
[0m18:29:52.852655 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:29:52.852909 [info ] [MainThread]: 
[0m18:29:52.853191 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m18:29:52.853783 [debug] [MainThread]: Command `dbt run` succeeded at 18:29:52.853711 after 0.53 seconds
[0m18:29:52.854207 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f985a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1114f6df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111832dc0>]}
[0m18:29:52.854459 [debug] [MainThread]: Flushing usage events
[0m01:57:03.448037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1107c4f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111ccd340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d5be6d0>]}


============================== 01:57:03.453973 | 7fa19c88-7e94-4472-8252-180e3729a72c ==============================
[0m01:57:03.453973 [info ] [MainThread]: Running with dbt=1.5.4
[0m01:57:03.454413 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '.', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m01:57:03.582743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7fa19c88-7e94-4472-8252-180e3729a72c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d5bec10>]}
[0m01:57:03.594229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7fa19c88-7e94-4472-8252-180e3729a72c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112085670>]}
[0m01:57:03.594666 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m01:57:03.612163 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m01:57:03.659036 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 3 files changed.
[0m01:57:03.659442 [debug] [MainThread]: Partial parsing: updated file: plaid_de://models/analytics/ticket_sales_counts.sql
[0m01:57:03.659701 [debug] [MainThread]: Partial parsing: updated file: plaid_de://models/analytics/valid_and_bookable_routes.sql
[0m01:57:03.659939 [debug] [MainThread]: Partial parsing: updated file: plaid_de://models/analytics/redemption_bookings_number_by_day.sql
[0m01:57:03.679318 [debug] [MainThread]: 1603: static parser failed on analytics/ticket_sales_counts.sql
[0m01:57:03.683149 [error] [MainThread]: Encountered an error:
Compilation Error in model ticket_sales_counts (models/analytics/ticket_sales_counts.sql)
  expected token ',', got 'unique_key'
    line 4
      unique_key='date_day'
[0m01:57:03.684155 [debug] [MainThread]: Command `dbt run` failed at 01:57:03.683554 after 0.27 seconds
[0m01:57:03.684443 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1107c4f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112370fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112370fa0>]}
[0m01:57:03.684695 [debug] [MainThread]: Flushing usage events
[0m01:58:08.981279 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c4c44f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d9cd340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092bc6d0>]}


============================== 01:58:08.988188 | 3ec2bee7-bc33-42ab-a47e-9a2839cfa86c ==============================
[0m01:58:08.988188 [info ] [MainThread]: Running with dbt=1.5.4
[0m01:58:08.988630 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '.', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m01:58:09.038143 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3ec2bee7-bc33-42ab-a47e-9a2839cfa86c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092bcc10>]}
[0m01:58:09.049994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3ec2bee7-bc33-42ab-a47e-9a2839cfa86c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dd85640>]}
[0m01:58:09.050427 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m01:58:09.069330 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m01:58:09.120950 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 3 files changed.
[0m01:58:09.121374 [debug] [MainThread]: Partial parsing: updated file: plaid_de://models/analytics/valid_and_bookable_routes.sql
[0m01:58:09.121633 [debug] [MainThread]: Partial parsing: updated file: plaid_de://models/analytics/ticket_sales_counts.sql
[0m01:58:09.121874 [debug] [MainThread]: Partial parsing: updated file: plaid_de://models/analytics/redemption_bookings_number_by_day.sql
[0m01:58:09.141249 [debug] [MainThread]: 1603: static parser failed on analytics/valid_and_bookable_routes.sql
[0m01:58:09.143775 [error] [MainThread]: Encountered an error:
Compilation Error in model valid_and_bookable_routes (models/analytics/valid_and_bookable_routes.sql)
  expected token ',', got 'unique_key'
    line 4
      unique_key='date_day'
[0m01:58:09.144772 [debug] [MainThread]: Command `dbt run` failed at 01:58:09.144195 after 0.19 seconds
[0m01:58:09.145054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c4c44f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e071f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e071fa0>]}
[0m01:58:09.145343 [debug] [MainThread]: Flushing usage events
[0m01:59:14.583672 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1102e3f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111812340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d0bf6d0>]}


============================== 01:59:14.589198 | 5baa3b71-7500-49a8-9329-0e6af84816ed ==============================
[0m01:59:14.589198 [info ] [MainThread]: Running with dbt=1.5.4
[0m01:59:14.589646 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '.', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m01:59:14.639053 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5baa3b71-7500-49a8-9329-0e6af84816ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d0bfc10>]}
[0m01:59:14.650624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5baa3b71-7500-49a8-9329-0e6af84816ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111bca670>]}
[0m01:59:14.651056 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m01:59:14.668353 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m01:59:14.718728 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 3 files changed.
[0m01:59:14.719156 [debug] [MainThread]: Partial parsing: updated file: plaid_de://models/analytics/redemption_bookings_number_by_day.sql
[0m01:59:14.719417 [debug] [MainThread]: Partial parsing: updated file: plaid_de://models/analytics/ticket_sales_counts.sql
[0m01:59:14.719658 [debug] [MainThread]: Partial parsing: updated file: plaid_de://models/analytics/valid_and_bookable_routes.sql
[0m01:59:14.739133 [debug] [MainThread]: 1699: static parser successfully parsed analytics/redemption_bookings_number_by_day.sql
[0m01:59:14.747812 [debug] [MainThread]: 1699: static parser successfully parsed analytics/ticket_sales_counts.sql
[0m01:59:14.750372 [debug] [MainThread]: 1699: static parser successfully parsed analytics/valid_and_bookable_routes.sql
[0m01:59:14.758355 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5baa3b71-7500-49a8-9329-0e6af84816ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111ef20d0>]}
[0m01:59:14.763242 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5baa3b71-7500-49a8-9329-0e6af84816ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e1e610>]}
[0m01:59:14.763540 [info ] [MainThread]: Found 3 models, 0 tests, 0 snapshots, 0 analyses, 307 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m01:59:14.763791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5baa3b71-7500-49a8-9329-0e6af84816ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e1e580>]}
[0m01:59:14.764682 [info ] [MainThread]: 
[0m01:59:14.765144 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:59:14.765858 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bookings'
[0m01:59:14.772638 [debug] [ThreadPool]: Using postgres connection "list_bookings"
[0m01:59:14.772859 [debug] [ThreadPool]: On list_bookings: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings"} */

    select distinct nspname from pg_namespace
  
[0m01:59:14.773039 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:59:15.172737 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.0 seconds
[0m01:59:15.174341 [debug] [ThreadPool]: On list_bookings: Close
[0m01:59:15.175778 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bookings_dbt'
[0m01:59:15.180271 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m01:59:15.180521 [debug] [ThreadPool]: On list_bookings_dbt: BEGIN
[0m01:59:15.180709 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:59:15.195640 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m01:59:15.195926 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m01:59:15.196151 [debug] [ThreadPool]: On list_bookings_dbt: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings_dbt"} */
select
      'bookings' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'bookings' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
[0m01:59:15.225704 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m01:59:15.228596 [debug] [ThreadPool]: On list_bookings_dbt: ROLLBACK
[0m01:59:15.229412 [debug] [ThreadPool]: On list_bookings_dbt: Close
[0m01:59:15.242034 [debug] [MainThread]: Using postgres connection "master"
[0m01:59:15.242335 [debug] [MainThread]: On master: BEGIN
[0m01:59:15.242529 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:59:15.254230 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:59:15.254525 [debug] [MainThread]: Using postgres connection "master"
[0m01:59:15.254815 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:59:15.304350 [debug] [MainThread]: SQL status: SELECT 10 in 0.0 seconds
[0m01:59:15.309336 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5baa3b71-7500-49a8-9329-0e6af84816ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e1e370>]}
[0m01:59:15.310279 [debug] [MainThread]: On master: ROLLBACK
[0m01:59:15.311154 [debug] [MainThread]: Using postgres connection "master"
[0m01:59:15.311673 [debug] [MainThread]: On master: BEGIN
[0m01:59:15.312584 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:59:15.313085 [debug] [MainThread]: On master: COMMIT
[0m01:59:15.313545 [debug] [MainThread]: Using postgres connection "master"
[0m01:59:15.314016 [debug] [MainThread]: On master: COMMIT
[0m01:59:15.314846 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:59:15.315407 [debug] [MainThread]: On master: Close
[0m01:59:15.316658 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:59:15.317439 [info ] [MainThread]: 
[0m01:59:15.332216 [debug] [Thread-1  ]: Began running node model.plaid_de.redemption_bookings_number_by_day
[0m01:59:15.332768 [debug] [Thread-2  ]: Began running node model.plaid_de.ticket_sales_counts
[0m01:59:15.333048 [debug] [Thread-3  ]: Began running node model.plaid_de.valid_and_bookable_routes
[0m01:59:15.333492 [info ] [Thread-1  ]: 1 of 3 START sql incremental model dbt.redemption_bookings_number_by_day ....... [RUN]
[0m01:59:15.333940 [info ] [Thread-2  ]: 2 of 3 START sql incremental model dbt.ticket_sales_counts ..................... [RUN]
[0m01:59:15.334369 [info ] [Thread-3  ]: 3 of 3 START sql incremental model dbt.valid_and_bookable_routes ............... [RUN]
[0m01:59:15.334997 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bookings, now model.plaid_de.redemption_bookings_number_by_day)
[0m01:59:15.335677 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly list_bookings_dbt, now model.plaid_de.ticket_sales_counts)
[0m01:59:15.336204 [debug] [Thread-3  ]: Acquiring new postgres connection 'model.plaid_de.valid_and_bookable_routes'
[0m01:59:15.336480 [debug] [Thread-1  ]: Began compiling node model.plaid_de.redemption_bookings_number_by_day
[0m01:59:15.336736 [debug] [Thread-2  ]: Began compiling node model.plaid_de.ticket_sales_counts
[0m01:59:15.336992 [debug] [Thread-3  ]: Began compiling node model.plaid_de.valid_and_bookable_routes
[0m01:59:15.343362 [debug] [Thread-1  ]: Writing injected SQL for node "model.plaid_de.redemption_bookings_number_by_day"
[0m01:59:15.345564 [debug] [Thread-2  ]: Writing injected SQL for node "model.plaid_de.ticket_sales_counts"
[0m01:59:15.347995 [debug] [Thread-3  ]: Writing injected SQL for node "model.plaid_de.valid_and_bookable_routes"
[0m01:59:15.349446 [debug] [Thread-1  ]: Timing info for model.plaid_de.redemption_bookings_number_by_day (compile): 01:59:15.337166 => 01:59:15.349284
[0m01:59:15.349729 [debug] [Thread-2  ]: Timing info for model.plaid_de.ticket_sales_counts (compile): 01:59:15.343693 => 01:59:15.349591
[0m01:59:15.349996 [debug] [Thread-3  ]: Timing info for model.plaid_de.valid_and_bookable_routes (compile): 01:59:15.345775 => 01:59:15.349871
[0m01:59:15.350239 [debug] [Thread-1  ]: Began executing node model.plaid_de.redemption_bookings_number_by_day
[0m01:59:15.350476 [debug] [Thread-2  ]: Began executing node model.plaid_de.ticket_sales_counts
[0m01:59:15.350704 [debug] [Thread-3  ]: Began executing node model.plaid_de.valid_and_bookable_routes
[0m01:59:15.400446 [debug] [Thread-1  ]: Writing runtime sql for node "model.plaid_de.redemption_bookings_number_by_day"
[0m01:59:15.400910 [debug] [Thread-2  ]: Writing runtime sql for node "model.plaid_de.ticket_sales_counts"
[0m01:59:15.405114 [debug] [Thread-3  ]: Writing runtime sql for node "model.plaid_de.valid_and_bookable_routes"
[0m01:59:15.406745 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m01:59:15.406997 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m01:59:15.407258 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m01:59:15.407532 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: BEGIN
[0m01:59:15.407773 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: BEGIN
[0m01:59:15.408005 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: BEGIN
[0m01:59:15.408227 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m01:59:15.408452 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m01:59:15.408665 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m01:59:15.449899 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m01:59:15.450270 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m01:59:15.450543 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */

      
  
    

  create  table "bookings"."dbt"."redemption_bookings_number_by_day__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    DATE_TRUNC('day', b.book_date) AS date,
    COUNT(*) AS redemption_count
FROM bookings b
WHERE total_amount = -1
    OR total_amount = 0
    OR total_amount = -12345678.00
GROUP BY date
ORDER BY redemption_count desc
  );
  
  
[0m01:59:15.455673 [debug] [Thread-3  ]: SQL status: BEGIN in 0.0 seconds
[0m01:59:15.455938 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m01:59:15.456358 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */

      
  
    

  create  table "bookings"."dbt"."valid_and_bookable_routes__dbt_tmp"
  
  
    as
  
  (
    

WITH no_transfer_flights AS (
    SELECT
        route1.flight_no AS first_flight,
        NULL AS second_flight,
        route1.departure_airport AS first_departure_airport,
        route1.arrival_airport AS first_arrival_airport,
        NULL AS second_departure_airport,
        NULL AS second_arrival_airport,
        route1.scheduled_departure as first_scheduled_departure_time,
        NULL::time without time zone as second_scheduled_departure_time,
        route1.scheduled_arrival as first_scheduled_arrival_time,
        NULL::time without time zone as second_scheduled_arrival_time
    FROM routes AS route1
),
one_transfer_flights AS (
    SELECT
        route1.flight_no AS first_flight,
        route2.flight_no AS second_flight,
        route1.departure_airport AS first_departure_airport,
        route1.arrival_airport AS first_arrival_airport,
        route2.departure_airport AS second_departure_airport,
        route2.arrival_airport AS second_arrival_airport,
        route1.scheduled_departure as first_scheduled_departure_time,
        route2.scheduled_departure as second_scheduled_departure_time,
        route1.scheduled_arrival as first_scheduled_arrival_time,
        route2.scheduled_arrival as second_scheduled_arrival_time
    FROM routes AS route1
    LEFT OUTER JOIN routes AS route2
    ON route1.arrival_airport = route2.departure_airport
),
max_1_transfer_and_non_circular_flights AS (
  SELECT
    first_flight,
    second_flight,
    first_departure_airport,
    first_arrival_airport,
    second_departure_airport,
    second_arrival_airport,
    first_scheduled_departure_time,
    second_scheduled_departure_time,
    first_scheduled_arrival_time,
    second_scheduled_arrival_time
  FROM one_transfer_flights
  WHERE first_departure_airport <> second_arrival_airport -- non-circular
  UNION ALL
  SELECT
    first_flight,
    second_flight,
    first_departure_airport,
    first_arrival_airport,
    second_departure_airport,
    second_arrival_airport,
    first_scheduled_departure_time,
    second_scheduled_departure_time,
    first_scheduled_arrival_time,
    second_scheduled_arrival_time
  FROM no_transfer_flights
),
max_1_transfer_and_non_circular_flights_with_travel_times AS (
    SELECT
        first_flight,
        second_flight,
        first_departure_airport,
        first_arrival_airport,
        second_departure_airport,
        second_arrival_airport,
        first_scheduled_departure_time,
        first_scheduled_arrival_time,
        second_scheduled_departure_time,
        second_scheduled_arrival_time,
        CASE WHEN first_scheduled_arrival_time - first_scheduled_departure_time < '00:00:00'::INTERVAL
            THEN first_scheduled_arrival_time - first_scheduled_departure_time + INTERVAL '24 HOURS'
            ELSE first_scheduled_arrival_time - first_scheduled_departure_time
        END as normalized_first_leg,
        CASE WHEN second_scheduled_departure_time - first_scheduled_arrival_time < '00:00:00'::INTERVAL
            THEN second_scheduled_departure_time - first_scheduled_arrival_time + INTERVAL '24 HOURS'
            ELSE second_scheduled_departure_time - first_scheduled_arrival_time
        END as normalized_second_leg,
        CASE WHEN second_scheduled_arrival_time - second_scheduled_departure_time < '00:00:00'::INTERVAL
            THEN second_scheduled_arrival_time - second_scheduled_departure_time + INTERVAL '24 HOURS'
            ELSE second_scheduled_arrival_time - second_scheduled_departure_time
        END as normalized_third_leg
    FROM max_1_transfer_and_non_circular_flights
), max_1_transfer_and_non_circular_flights_within_24hours AS (
    SELECT
        first_flight,
        second_flight,
        first_departure_airport,
        first_arrival_airport,
        second_departure_airport,
        second_arrival_airport,
        first_scheduled_departure_time,
        first_scheduled_arrival_time,
        second_scheduled_departure_time,
        second_scheduled_arrival_time
    FROM max_1_transfer_and_non_circular_flights_with_travel_times
    WHERE normalized_first_leg + normalized_second_leg + normalized_third_leg <= INTERVAL '24 HOURS'
) SELECT
    first_flight as first_flight_no,
    second_flight as second_flight_no,
    first_departure_airport as origin_airport,
    COALESCE(second_arrival_airport, first_arrival_airport) as destination_airport_code,
    CASE WHEN second_flight IS NOT NULL THEN first_arrival_airport END as transfer_airport_code,
    first_scheduled_departure_time as first_scheduled_departure_time,
    CASE WHEN second_flight IS NOT NULL THEN first_scheduled_arrival_time END as transfer_airport_arrival_time,
    CASE WHEN second_flight IS NOT NULL THEN second_scheduled_departure_time END as transfer_airport_departure_time,
    COALESCE(second_scheduled_arrival_time, first_scheduled_arrival_time) as destination_arrival_time
FROM max_1_transfer_and_non_circular_flights_within_24h AS valid_routes
  );
  
  
[0m01:59:15.460933 [debug] [Thread-3  ]: Postgres adapter: Postgres error: relation "max_1_transfer_and_non_circular_flights_within_24h" does not exist
LINE 122: FROM max_1_transfer_and_non_circular_flights_within_24h AS v...
               ^

[0m01:59:15.461257 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: ROLLBACK
[0m01:59:15.462109 [debug] [Thread-3  ]: Timing info for model.plaid_de.valid_and_bookable_routes (execute): 01:59:15.401125 => 01:59:15.461858
[0m01:59:15.462419 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: Close
[0m01:59:15.463127 [debug] [Thread-2  ]: SQL status: BEGIN in 0.0 seconds
[0m01:59:15.463418 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m01:59:15.463903 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */

      
  
    

  create  table "bookings"."dbt"."ticket_sales_counts__dbt_tmp"
  
  
    as
  
  (
    

WITH daily_ticket_sales AS (
    SELECT
        DATE_TRUNC('day', b.book_date) AS sale_date,
        COUNT(t.ticket_no) AS total_tickets
    FROM bookings b
    JOIN tickets t ON b.book_ref = t.book_ref
    GROUP BY sale_date
),

rolling_7d_ticket_sales AS (
    SELECT
        sale_date,
        SUM(total_tickets) OVER (ORDER BY sale_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS rolling_7_days_total
    FROM daily_ticket_sales
),

rolling_28d_ticket_sales AS (
    SELECT
        sale_date,
        SUM(total_tickets) OVER (ORDER BY sale_date ROWS BETWEEN 27 PRECEDING AND CURRENT ROW) AS rolling_28_days_total
    FROM daily_ticket_sales
)
SELECT
    dts.sale_date AS date,
    dts.total_tickets AS daily_total_tickets,
    rolling_7d.rolling_7_days_total,
    rolling_28d.rolling_28_days_total
FROM daily_ticket_sales dts
LEFT JOIN rolling_7d_ticket_sales AS rolling_7d
    ON dts.sale_date = rolling_7d.sale_date
LEFT JOIN rolling_28d_ticket_sales AS rolling_28d
    ON dts.sale_date = rolling_28d.sale_date
  );
  
  
[0m01:59:15.468211 [debug] [Thread-3  ]: Database Error in model valid_and_bookable_routes (models/analytics/valid_and_bookable_routes.sql)
  relation "max_1_transfer_and_non_circular_flights_within_24h" does not exist
  LINE 122: FROM max_1_transfer_and_non_circular_flights_within_24h AS v...
                 ^
  compiled Code at target/run/plaid_de/models/analytics/valid_and_bookable_routes.sql
[0m01:59:15.468574 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5baa3b71-7500-49a8-9329-0e6af84816ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e99070>]}
[0m01:59:15.469552 [error] [Thread-3  ]: 3 of 3 ERROR creating sql incremental model dbt.valid_and_bookable_routes ...... [[31mERROR[0m in 0.13s]
[0m01:59:15.470005 [debug] [Thread-3  ]: Finished running node model.plaid_de.valid_and_bookable_routes
[0m01:59:16.199657 [debug] [Thread-1  ]: SQL status: SELECT 111 in 1.0 seconds
[0m01:59:16.222453 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m01:59:16.223568 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */
alter table "bookings"."dbt"."redemption_bookings_number_by_day" rename to "redemption_bookings_number_by_day__dbt_backup"
[0m01:59:16.226111 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m01:59:16.233207 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m01:59:16.234358 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */
alter table "bookings"."dbt"."redemption_bookings_number_by_day__dbt_tmp" rename to "redemption_bookings_number_by_day"
[0m01:59:16.238897 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m01:59:16.260816 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: COMMIT
[0m01:59:16.261175 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m01:59:16.261415 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: COMMIT
[0m01:59:16.263791 [debug] [Thread-1  ]: SQL status: COMMIT in 0.0 seconds
[0m01:59:16.267520 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m01:59:16.267794 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */
drop view if exists "bookings"."dbt"."redemption_bookings_number_by_day__dbt_backup" cascade
[0m01:59:16.273590 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.0 seconds
[0m01:59:16.274766 [debug] [Thread-1  ]: Timing info for model.plaid_de.redemption_bookings_number_by_day (execute): 01:59:15.350861 => 01:59:16.274608
[0m01:59:16.275031 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: Close
[0m01:59:16.275640 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5baa3b71-7500-49a8-9329-0e6af84816ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1120cfd90>]}
[0m01:59:16.276139 [info ] [Thread-1  ]: 1 of 3 OK created sql incremental model dbt.redemption_bookings_number_by_day .. [[32mSELECT 111[0m in 0.94s]
[0m01:59:16.276685 [debug] [Thread-1  ]: Finished running node model.plaid_de.redemption_bookings_number_by_day
[0m01:59:17.823244 [debug] [Thread-2  ]: SQL status: SELECT 117 in 2.0 seconds
[0m01:59:17.841763 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m01:59:17.842654 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */
alter table "bookings"."dbt"."ticket_sales_counts" rename to "ticket_sales_counts__dbt_backup"
[0m01:59:17.844955 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m01:59:17.852647 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m01:59:17.853487 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */
alter table "bookings"."dbt"."ticket_sales_counts__dbt_tmp" rename to "ticket_sales_counts"
[0m01:59:17.854515 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m01:59:17.859127 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: COMMIT
[0m01:59:17.859805 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m01:59:17.860386 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: COMMIT
[0m01:59:17.861968 [debug] [Thread-2  ]: SQL status: COMMIT in 0.0 seconds
[0m01:59:17.866446 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m01:59:17.866840 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */
drop view if exists "bookings"."dbt"."ticket_sales_counts__dbt_backup" cascade
[0m01:59:17.869212 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.0 seconds
[0m01:59:17.870779 [debug] [Thread-2  ]: Timing info for model.plaid_de.ticket_sales_counts (execute): 01:59:15.377415 => 01:59:17.870574
[0m01:59:17.871085 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: Close
[0m01:59:17.871771 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5baa3b71-7500-49a8-9329-0e6af84816ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112137100>]}
[0m01:59:17.872652 [info ] [Thread-2  ]: 2 of 3 OK created sql incremental model dbt.ticket_sales_counts ................ [[32mSELECT 117[0m in 2.54s]
[0m01:59:17.873185 [debug] [Thread-2  ]: Finished running node model.plaid_de.ticket_sales_counts
[0m01:59:17.874863 [debug] [MainThread]: Using postgres connection "master"
[0m01:59:17.875105 [debug] [MainThread]: On master: BEGIN
[0m01:59:17.875339 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:59:17.902287 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:59:17.902709 [debug] [MainThread]: On master: COMMIT
[0m01:59:17.902971 [debug] [MainThread]: Using postgres connection "master"
[0m01:59:17.903191 [debug] [MainThread]: On master: COMMIT
[0m01:59:17.903627 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:59:17.903859 [debug] [MainThread]: On master: Close
[0m01:59:17.904415 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:59:17.904638 [debug] [MainThread]: Connection 'model.plaid_de.redemption_bookings_number_by_day' was properly closed.
[0m01:59:17.904836 [debug] [MainThread]: Connection 'model.plaid_de.ticket_sales_counts' was properly closed.
[0m01:59:17.905026 [debug] [MainThread]: Connection 'model.plaid_de.valid_and_bookable_routes' was properly closed.
[0m01:59:17.905999 [info ] [MainThread]: 
[0m01:59:17.906445 [info ] [MainThread]: Finished running 3 incremental models in 0 hours 0 minutes and 3.14 seconds (3.14s).
[0m01:59:17.907483 [debug] [MainThread]: Command end result
[0m01:59:17.913591 [info ] [MainThread]: 
[0m01:59:17.914019 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m01:59:17.914335 [info ] [MainThread]: 
[0m01:59:17.914658 [error] [MainThread]: [33mDatabase Error in model valid_and_bookable_routes (models/analytics/valid_and_bookable_routes.sql)[0m
[0m01:59:17.914971 [error] [MainThread]:   relation "max_1_transfer_and_non_circular_flights_within_24h" does not exist
[0m01:59:17.915261 [error] [MainThread]:   LINE 122: FROM max_1_transfer_and_non_circular_flights_within_24h AS v...
[0m01:59:17.915541 [error] [MainThread]:                  ^
[0m01:59:17.915820 [error] [MainThread]:   compiled Code at target/run/plaid_de/models/analytics/valid_and_bookable_routes.sql
[0m01:59:17.916116 [info ] [MainThread]: 
[0m01:59:17.916472 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m01:59:17.917312 [debug] [MainThread]: Command `dbt run` failed at 01:59:17.917220 after 3.36 seconds
[0m01:59:17.917708 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1102e3f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e68d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e68ac0>]}
[0m01:59:17.918020 [debug] [MainThread]: Flushing usage events
[0m02:00:07.237270 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dc8f550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f199790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f199970>]}


============================== 02:00:07.243301 | 634bb330-6ca3-48ad-bc0f-33402cd24f96 ==============================
[0m02:00:07.243301 [info ] [MainThread]: Running with dbt=1.5.4
[0m02:00:07.243757 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '.', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m02:00:07.294649 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '634bb330-6ca3-48ad-bc0f-33402cd24f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aabe6d0>]}
[0m02:00:07.307062 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '634bb330-6ca3-48ad-bc0f-33402cd24f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f551610>]}
[0m02:00:07.307520 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m02:00:07.324264 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m02:00:07.372623 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m02:00:07.373064 [debug] [MainThread]: Partial parsing: updated file: plaid_de://models/analytics/valid_and_bookable_routes.sql
[0m02:00:07.393901 [debug] [MainThread]: 1699: static parser successfully parsed analytics/valid_and_bookable_routes.sql
[0m02:00:07.410187 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '634bb330-6ca3-48ad-bc0f-33402cd24f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f87a0d0>]}
[0m02:00:07.415261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '634bb330-6ca3-48ad-bc0f-33402cd24f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f7a35b0>]}
[0m02:00:07.415546 [info ] [MainThread]: Found 3 models, 0 tests, 0 snapshots, 0 analyses, 307 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m02:00:07.415796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '634bb330-6ca3-48ad-bc0f-33402cd24f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f7a3520>]}
[0m02:00:07.416707 [info ] [MainThread]: 
[0m02:00:07.417169 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m02:00:07.417882 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bookings'
[0m02:00:07.424997 [debug] [ThreadPool]: Using postgres connection "list_bookings"
[0m02:00:07.425233 [debug] [ThreadPool]: On list_bookings: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings"} */

    select distinct nspname from pg_namespace
  
[0m02:00:07.425422 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:00:07.462080 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.0 seconds
[0m02:00:07.463070 [debug] [ThreadPool]: On list_bookings: Close
[0m02:00:07.463996 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bookings, now list_bookings_dbt)
[0m02:00:07.467781 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m02:00:07.467987 [debug] [ThreadPool]: On list_bookings_dbt: BEGIN
[0m02:00:07.468157 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:00:07.484637 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m02:00:07.484861 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m02:00:07.485069 [debug] [ThreadPool]: On list_bookings_dbt: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings_dbt"} */
select
      'bookings' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'bookings' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
[0m02:00:07.489790 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m02:00:07.490673 [debug] [ThreadPool]: On list_bookings_dbt: ROLLBACK
[0m02:00:07.491189 [debug] [ThreadPool]: On list_bookings_dbt: Close
[0m02:00:07.494416 [debug] [MainThread]: Using postgres connection "master"
[0m02:00:07.494616 [debug] [MainThread]: On master: BEGIN
[0m02:00:07.494786 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:00:07.508046 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m02:00:07.508231 [debug] [MainThread]: Using postgres connection "master"
[0m02:00:07.508481 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m02:00:07.534209 [debug] [MainThread]: SQL status: SELECT 7 in 0.0 seconds
[0m02:00:07.535355 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '634bb330-6ca3-48ad-bc0f-33402cd24f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f7a32b0>]}
[0m02:00:07.535662 [debug] [MainThread]: On master: ROLLBACK
[0m02:00:07.536125 [debug] [MainThread]: Using postgres connection "master"
[0m02:00:07.536318 [debug] [MainThread]: On master: BEGIN
[0m02:00:07.537401 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m02:00:07.537665 [debug] [MainThread]: On master: COMMIT
[0m02:00:07.537883 [debug] [MainThread]: Using postgres connection "master"
[0m02:00:07.538087 [debug] [MainThread]: On master: COMMIT
[0m02:00:07.538815 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m02:00:07.539017 [debug] [MainThread]: On master: Close
[0m02:00:07.539496 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:00:07.539763 [info ] [MainThread]: 
[0m02:00:07.544556 [debug] [Thread-1  ]: Began running node model.plaid_de.redemption_bookings_number_by_day
[0m02:00:07.544824 [debug] [Thread-2  ]: Began running node model.plaid_de.ticket_sales_counts
[0m02:00:07.545107 [debug] [Thread-3  ]: Began running node model.plaid_de.valid_and_bookable_routes
[0m02:00:07.545441 [info ] [Thread-1  ]: 1 of 3 START sql incremental model dbt.redemption_bookings_number_by_day ....... [RUN]
[0m02:00:07.545815 [info ] [Thread-2  ]: 2 of 3 START sql incremental model dbt.ticket_sales_counts ..................... [RUN]
[0m02:00:07.546207 [info ] [Thread-3  ]: 3 of 3 START sql incremental model dbt.valid_and_bookable_routes ............... [RUN]
[0m02:00:07.546698 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bookings_dbt, now model.plaid_de.redemption_bookings_number_by_day)
[0m02:00:07.547151 [debug] [Thread-2  ]: Acquiring new postgres connection 'model.plaid_de.ticket_sales_counts'
[0m02:00:07.547585 [debug] [Thread-3  ]: Acquiring new postgres connection 'model.plaid_de.valid_and_bookable_routes'
[0m02:00:07.547890 [debug] [Thread-1  ]: Began compiling node model.plaid_de.redemption_bookings_number_by_day
[0m02:00:07.548125 [debug] [Thread-2  ]: Began compiling node model.plaid_de.ticket_sales_counts
[0m02:00:07.548358 [debug] [Thread-3  ]: Began compiling node model.plaid_de.valid_and_bookable_routes
[0m02:00:07.554447 [debug] [Thread-1  ]: Writing injected SQL for node "model.plaid_de.redemption_bookings_number_by_day"
[0m02:00:07.556315 [debug] [Thread-2  ]: Writing injected SQL for node "model.plaid_de.ticket_sales_counts"
[0m02:00:07.558560 [debug] [Thread-3  ]: Writing injected SQL for node "model.plaid_de.valid_and_bookable_routes"
[0m02:00:07.559192 [debug] [Thread-1  ]: Timing info for model.plaid_de.redemption_bookings_number_by_day (compile): 02:00:07.548522 => 02:00:07.559037
[0m02:00:07.559486 [debug] [Thread-2  ]: Timing info for model.plaid_de.ticket_sales_counts (compile): 02:00:07.554636 => 02:00:07.559355
[0m02:00:07.559720 [debug] [Thread-1  ]: Began executing node model.plaid_de.redemption_bookings_number_by_day
[0m02:00:07.559956 [debug] [Thread-2  ]: Began executing node model.plaid_de.ticket_sales_counts
[0m02:00:07.560255 [debug] [Thread-3  ]: Timing info for model.plaid_de.valid_and_bookable_routes (compile): 02:00:07.556492 => 02:00:07.560120
[0m02:00:07.606907 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m02:00:07.608346 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m02:00:07.608601 [debug] [Thread-3  ]: Began executing node model.plaid_de.valid_and_bookable_routes
[0m02:00:07.608923 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */

    
  
    

  create temporary table "ticket_sales_counts__dbt_tmp020007588093"
  
  
    as
  
  (
    

WITH daily_ticket_sales AS (
    SELECT
        DATE_TRUNC('day', b.book_date) AS sale_date,
        COUNT(t.ticket_no) AS total_tickets
    FROM bookings b
    JOIN tickets t ON b.book_ref = t.book_ref
    GROUP BY sale_date
),

rolling_7d_ticket_sales AS (
    SELECT
        sale_date,
        SUM(total_tickets) OVER (ORDER BY sale_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS rolling_7_days_total
    FROM daily_ticket_sales
),

rolling_28d_ticket_sales AS (
    SELECT
        sale_date,
        SUM(total_tickets) OVER (ORDER BY sale_date ROWS BETWEEN 27 PRECEDING AND CURRENT ROW) AS rolling_28_days_total
    FROM daily_ticket_sales
)
SELECT
    dts.sale_date AS date,
    dts.total_tickets AS daily_total_tickets,
    rolling_7d.rolling_7_days_total,
    rolling_28d.rolling_28_days_total
FROM daily_ticket_sales dts
LEFT JOIN rolling_7d_ticket_sales AS rolling_7d
    ON dts.sale_date = rolling_7d.sale_date
LEFT JOIN rolling_28d_ticket_sales AS rolling_28d
    ON dts.sale_date = rolling_28d.sale_date
  );
  
  
[0m02:00:07.609234 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */

    
  
    

  create temporary table "redemption_bookings_number_by_day__dbt_tmp020007581518"
  
  
    as
  
  (
    

SELECT
    DATE_TRUNC('day', b.book_date) AS date,
    COUNT(*) AS redemption_count
FROM bookings b
WHERE total_amount = -1
    OR total_amount = 0
    OR total_amount = -12345678.00
GROUP BY date
ORDER BY redemption_count desc
  );
  
  
[0m02:00:07.613234 [debug] [Thread-3  ]: Writing runtime sql for node "model.plaid_de.valid_and_bookable_routes"
[0m02:00:07.613497 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m02:00:07.613742 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m02:00:07.614352 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m02:00:07.614613 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: BEGIN
[0m02:00:07.614823 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m02:00:07.635602 [debug] [Thread-3  ]: SQL status: BEGIN in 0.0 seconds
[0m02:00:07.635832 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m02:00:07.636233 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */

      
  
    

  create  table "bookings"."dbt"."valid_and_bookable_routes__dbt_tmp"
  
  
    as
  
  (
    

WITH no_transfer_flights AS (
    SELECT
        route1.flight_no AS first_flight,
        NULL AS second_flight,
        route1.departure_airport AS first_departure_airport,
        route1.arrival_airport AS first_arrival_airport,
        NULL AS second_departure_airport,
        NULL AS second_arrival_airport,
        route1.scheduled_departure as first_scheduled_departure_time,
        NULL::time without time zone as second_scheduled_departure_time,
        route1.scheduled_arrival as first_scheduled_arrival_time,
        NULL::time without time zone as second_scheduled_arrival_time
    FROM routes AS route1
),
one_transfer_flights AS (
    SELECT
        route1.flight_no AS first_flight,
        route2.flight_no AS second_flight,
        route1.departure_airport AS first_departure_airport,
        route1.arrival_airport AS first_arrival_airport,
        route2.departure_airport AS second_departure_airport,
        route2.arrival_airport AS second_arrival_airport,
        route1.scheduled_departure as first_scheduled_departure_time,
        route2.scheduled_departure as second_scheduled_departure_time,
        route1.scheduled_arrival as first_scheduled_arrival_time,
        route2.scheduled_arrival as second_scheduled_arrival_time
    FROM routes AS route1
    LEFT OUTER JOIN routes AS route2
    ON route1.arrival_airport = route2.departure_airport
),
max_1_transfer_and_non_circular_flights AS (
  SELECT
    first_flight,
    second_flight,
    first_departure_airport,
    first_arrival_airport,
    second_departure_airport,
    second_arrival_airport,
    first_scheduled_departure_time,
    second_scheduled_departure_time,
    first_scheduled_arrival_time,
    second_scheduled_arrival_time
  FROM one_transfer_flights
  WHERE first_departure_airport <> second_arrival_airport -- non-circular
  UNION ALL
  SELECT
    first_flight,
    second_flight,
    first_departure_airport,
    first_arrival_airport,
    second_departure_airport,
    second_arrival_airport,
    first_scheduled_departure_time,
    second_scheduled_departure_time,
    first_scheduled_arrival_time,
    second_scheduled_arrival_time
  FROM no_transfer_flights
),
max_1_transfer_and_non_circular_flights_with_travel_times AS (
    SELECT
        first_flight,
        second_flight,
        first_departure_airport,
        first_arrival_airport,
        second_departure_airport,
        second_arrival_airport,
        first_scheduled_departure_time,
        first_scheduled_arrival_time,
        second_scheduled_departure_time,
        second_scheduled_arrival_time,
        CASE WHEN first_scheduled_arrival_time - first_scheduled_departure_time < '00:00:00'::INTERVAL
            THEN first_scheduled_arrival_time - first_scheduled_departure_time + INTERVAL '24 HOURS'
            ELSE first_scheduled_arrival_time - first_scheduled_departure_time
        END as normalized_first_leg,
        CASE WHEN second_scheduled_departure_time - first_scheduled_arrival_time < '00:00:00'::INTERVAL
            THEN second_scheduled_departure_time - first_scheduled_arrival_time + INTERVAL '24 HOURS'
            ELSE second_scheduled_departure_time - first_scheduled_arrival_time
        END as normalized_second_leg,
        CASE WHEN second_scheduled_arrival_time - second_scheduled_departure_time < '00:00:00'::INTERVAL
            THEN second_scheduled_arrival_time - second_scheduled_departure_time + INTERVAL '24 HOURS'
            ELSE second_scheduled_arrival_time - second_scheduled_departure_time
        END as normalized_third_leg
    FROM max_1_transfer_and_non_circular_flights
), max_1_transfer_and_non_circular_flights_within_24hours AS (
    SELECT
        first_flight,
        second_flight,
        first_departure_airport,
        first_arrival_airport,
        second_departure_airport,
        second_arrival_airport,
        first_scheduled_departure_time,
        first_scheduled_arrival_time,
        second_scheduled_departure_time,
        second_scheduled_arrival_time
    FROM max_1_transfer_and_non_circular_flights_with_travel_times
    WHERE normalized_first_leg + normalized_second_leg + normalized_third_leg <= INTERVAL '24 HOURS'
) SELECT
    first_flight as first_flight_no,
    second_flight as second_flight_no,
    first_departure_airport as origin_airport,
    COALESCE(second_arrival_airport, first_arrival_airport) as destination_airport_code,
    CASE WHEN second_flight IS NOT NULL THEN first_arrival_airport END as transfer_airport_code,
    first_scheduled_departure_time as first_scheduled_departure_time,
    CASE WHEN second_flight IS NOT NULL THEN first_scheduled_arrival_time END as transfer_airport_arrival_time,
    CASE WHEN second_flight IS NOT NULL THEN second_scheduled_departure_time END as transfer_airport_departure_time,
    COALESCE(second_scheduled_arrival_time, first_scheduled_arrival_time) as destination_arrival_time
FROM max_1_transfer_and_non_circular_flights_within_24hours AS valid_routes
  );
  
  
[0m02:00:07.708596 [debug] [Thread-1  ]: SQL status: SELECT 111 in 0.0 seconds
[0m02:00:07.717235 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m02:00:07.717706 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: BEGIN
[0m02:00:07.718954 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m02:00:07.719321 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m02:00:07.719599 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'redemption_bookings_number_by_day__dbt_tmp020007581518'
        
      order by ordinal_position

  
[0m02:00:07.732440 [debug] [Thread-1  ]: SQL status: SELECT 2 in 0.0 seconds
[0m02:00:07.736589 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m02:00:07.736925 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "bookings".INFORMATION_SCHEMA.columns
      where table_name = 'redemption_bookings_number_by_day'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
[0m02:00:07.738735 [debug] [Thread-1  ]: SQL status: SELECT 2 in 0.0 seconds
[0m02:00:07.744556 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m02:00:07.744866 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "bookings".INFORMATION_SCHEMA.columns
      where table_name = 'redemption_bookings_number_by_day'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
[0m02:00:07.747586 [debug] [Thread-1  ]: SQL status: SELECT 2 in 0.0 seconds
[0m02:00:07.757773 [debug] [Thread-1  ]: Writing runtime sql for node "model.plaid_de.redemption_bookings_number_by_day"
[0m02:00:07.758351 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m02:00:07.758609 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */

      
        
            delete from "bookings"."dbt"."redemption_bookings_number_by_day"
            where (
                date_day) in (
                select (date_day)
                from "redemption_bookings_number_by_day__dbt_tmp020007581518"
            );

        
    

    insert into "bookings"."dbt"."redemption_bookings_number_by_day" ("date", "redemption_count")
    (
        select "date", "redemption_count"
        from "redemption_bookings_number_by_day__dbt_tmp020007581518"
    )
  
[0m02:00:07.760809 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column "date_day" does not exist
LINE 8:                 select (date_day)
                                ^

[0m02:00:07.761170 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: ROLLBACK
[0m02:00:07.761897 [debug] [Thread-1  ]: Timing info for model.plaid_de.redemption_bookings_number_by_day (execute): 02:00:07.560392 => 02:00:07.761716
[0m02:00:07.762175 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: Close
[0m02:00:07.768117 [debug] [Thread-1  ]: Database Error in model redemption_bookings_number_by_day (models/analytics/redemption_bookings_number_by_day.sql)
  column "date_day" does not exist
  LINE 8:                 select (date_day)
                                  ^
  compiled Code at target/run/plaid_de/models/analytics/redemption_bookings_number_by_day.sql
[0m02:00:07.768547 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '634bb330-6ca3-48ad-bc0f-33402cd24f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f8c73a0>]}
[0m02:00:07.769584 [error] [Thread-1  ]: 1 of 3 ERROR creating sql incremental model dbt.redemption_bookings_number_by_day  [[31mERROR[0m in 0.22s]
[0m02:00:07.770067 [debug] [Thread-1  ]: Finished running node model.plaid_de.redemption_bookings_number_by_day
[0m02:00:07.895959 [debug] [Thread-3  ]: SQL status: SELECT 8112 in 0.0 seconds
[0m02:00:07.908964 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m02:00:07.909478 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */
alter table "bookings"."dbt"."valid_and_bookable_routes" rename to "valid_and_bookable_routes__dbt_backup"
[0m02:00:07.912081 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m02:00:07.915514 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m02:00:07.915844 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */
alter table "bookings"."dbt"."valid_and_bookable_routes__dbt_tmp" rename to "valid_and_bookable_routes"
[0m02:00:07.916555 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m02:00:07.932514 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: COMMIT
[0m02:00:07.932842 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m02:00:07.933072 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: COMMIT
[0m02:00:07.941032 [debug] [Thread-3  ]: SQL status: COMMIT in 0.0 seconds
[0m02:00:07.944814 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m02:00:07.945091 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */
drop view if exists "bookings"."dbt"."valid_and_bookable_routes__dbt_backup" cascade
[0m02:00:07.947410 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.0 seconds
[0m02:00:07.948480 [debug] [Thread-3  ]: Timing info for model.plaid_de.valid_and_bookable_routes (execute): 02:00:07.609419 => 02:00:07.948342
[0m02:00:07.948742 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: Close
[0m02:00:07.949233 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '634bb330-6ca3-48ad-bc0f-33402cd24f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f947400>]}
[0m02:00:07.949669 [info ] [Thread-3  ]: 3 of 3 OK created sql incremental model dbt.valid_and_bookable_routes .......... [[32mSELECT 8112[0m in 0.40s]
[0m02:00:07.950186 [debug] [Thread-3  ]: Finished running node model.plaid_de.valid_and_bookable_routes
[0m02:00:08.134627 [debug] [Thread-2  ]: SQL status: SELECT 117 in 1.0 seconds
[0m02:00:08.148416 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m02:00:08.150183 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: BEGIN
[0m02:00:08.152007 [debug] [Thread-2  ]: SQL status: BEGIN in 0.0 seconds
[0m02:00:08.152620 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m02:00:08.153271 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'ticket_sales_counts__dbt_tmp020007588093'
        
      order by ordinal_position

  
[0m02:00:08.157941 [debug] [Thread-2  ]: SQL status: SELECT 4 in 0.0 seconds
[0m02:00:08.169248 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m02:00:08.170431 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "bookings".INFORMATION_SCHEMA.columns
      where table_name = 'ticket_sales_counts'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
[0m02:00:08.172979 [debug] [Thread-2  ]: SQL status: SELECT 4 in 0.0 seconds
[0m02:00:08.179972 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m02:00:08.180665 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "bookings".INFORMATION_SCHEMA.columns
      where table_name = 'ticket_sales_counts'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
[0m02:00:08.182655 [debug] [Thread-2  ]: SQL status: SELECT 4 in 0.0 seconds
[0m02:00:08.186893 [debug] [Thread-2  ]: Writing runtime sql for node "model.plaid_de.ticket_sales_counts"
[0m02:00:08.187550 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m02:00:08.187871 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */

      
        
            delete from "bookings"."dbt"."ticket_sales_counts"
            where (
                date_day) in (
                select (date_day)
                from "ticket_sales_counts__dbt_tmp020007588093"
            );

        
    

    insert into "bookings"."dbt"."ticket_sales_counts" ("date", "daily_total_tickets", "rolling_7_days_total", "rolling_28_days_total")
    (
        select "date", "daily_total_tickets", "rolling_7_days_total", "rolling_28_days_total"
        from "ticket_sales_counts__dbt_tmp020007588093"
    )
  
[0m02:00:08.189342 [debug] [Thread-2  ]: Postgres adapter: Postgres error: column "date_day" does not exist
LINE 8:                 select (date_day)
                                ^

[0m02:00:08.189621 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: ROLLBACK
[0m02:00:08.190235 [debug] [Thread-2  ]: Timing info for model.plaid_de.ticket_sales_counts (execute): 02:00:07.586674 => 02:00:08.190075
[0m02:00:08.190506 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: Close
[0m02:00:08.191516 [debug] [Thread-2  ]: Database Error in model ticket_sales_counts (models/analytics/ticket_sales_counts.sql)
  column "date_day" does not exist
  LINE 8:                 select (date_day)
                                  ^
  compiled Code at target/run/plaid_de/models/analytics/ticket_sales_counts.sql
[0m02:00:08.191847 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '634bb330-6ca3-48ad-bc0f-33402cd24f96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f947f70>]}
[0m02:00:08.192295 [error] [Thread-2  ]: 2 of 3 ERROR creating sql incremental model dbt.ticket_sales_counts ............ [[31mERROR[0m in 0.64s]
[0m02:00:08.192700 [debug] [Thread-2  ]: Finished running node model.plaid_de.ticket_sales_counts
[0m02:00:08.193806 [debug] [MainThread]: Using postgres connection "master"
[0m02:00:08.194034 [debug] [MainThread]: On master: BEGIN
[0m02:00:08.194234 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m02:00:08.205549 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m02:00:08.205789 [debug] [MainThread]: On master: COMMIT
[0m02:00:08.205995 [debug] [MainThread]: Using postgres connection "master"
[0m02:00:08.206188 [debug] [MainThread]: On master: COMMIT
[0m02:00:08.206637 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m02:00:08.206919 [debug] [MainThread]: On master: Close
[0m02:00:08.207449 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:00:08.207682 [debug] [MainThread]: Connection 'model.plaid_de.redemption_bookings_number_by_day' was properly closed.
[0m02:00:08.207880 [debug] [MainThread]: Connection 'model.plaid_de.ticket_sales_counts' was properly closed.
[0m02:00:08.208087 [debug] [MainThread]: Connection 'model.plaid_de.valid_and_bookable_routes' was properly closed.
[0m02:00:08.208448 [info ] [MainThread]: 
[0m02:00:08.208788 [info ] [MainThread]: Finished running 3 incremental models in 0 hours 0 minutes and 0.79 seconds (0.79s).
[0m02:00:08.209577 [debug] [MainThread]: Command end result
[0m02:00:08.214568 [info ] [MainThread]: 
[0m02:00:08.214888 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m02:00:08.215163 [info ] [MainThread]: 
[0m02:00:08.215441 [error] [MainThread]: [33mDatabase Error in model redemption_bookings_number_by_day (models/analytics/redemption_bookings_number_by_day.sql)[0m
[0m02:00:08.215707 [error] [MainThread]:   column "date_day" does not exist
[0m02:00:08.215960 [error] [MainThread]:   LINE 8:                 select (date_day)
[0m02:00:08.216209 [error] [MainThread]:                                   ^
[0m02:00:08.216454 [error] [MainThread]:   compiled Code at target/run/plaid_de/models/analytics/redemption_bookings_number_by_day.sql
[0m02:00:08.216707 [info ] [MainThread]: 
[0m02:00:08.216960 [error] [MainThread]: [33mDatabase Error in model ticket_sales_counts (models/analytics/ticket_sales_counts.sql)[0m
[0m02:00:08.217210 [error] [MainThread]:   column "date_day" does not exist
[0m02:00:08.217453 [error] [MainThread]:   LINE 8:                 select (date_day)
[0m02:00:08.217696 [error] [MainThread]:                                   ^
[0m02:00:08.217938 [error] [MainThread]:   compiled Code at target/run/plaid_de/models/analytics/ticket_sales_counts.sql
[0m02:00:08.218189 [info ] [MainThread]: 
[0m02:00:08.218493 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=2 SKIP=0 TOTAL=3
[0m02:00:08.219025 [debug] [MainThread]: Command `dbt run` failed at 02:00:08.218953 after 1.01 seconds
[0m02:00:08.219302 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dc8f550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f947280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fa59dc0>]}
[0m02:00:08.219582 [debug] [MainThread]: Flushing usage events
[0m02:03:01.546443 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110290f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111799340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d0bf6d0>]}


============================== 02:03:01.552271 | e95112cc-5bdd-4f9f-919f-2fa365169dc0 ==============================
[0m02:03:01.552271 [info ] [MainThread]: Running with dbt=1.5.4
[0m02:03:01.552721 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '.', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m02:03:01.602027 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e95112cc-5bdd-4f9f-919f-2fa365169dc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d0bfc10>]}
[0m02:03:01.613651 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e95112cc-5bdd-4f9f-919f-2fa365169dc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111b51670>]}
[0m02:03:01.614099 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m02:03:01.629970 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m02:03:01.678819 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 3 files changed.
[0m02:03:01.679311 [debug] [MainThread]: Partial parsing: updated file: plaid_de://models/analytics/ticket_sales_counts.sql
[0m02:03:01.679602 [debug] [MainThread]: Partial parsing: updated file: plaid_de://models/analytics/valid_and_bookable_routes.sql
[0m02:03:01.681495 [debug] [MainThread]: Partial parsing: updated file: plaid_de://models/analytics/redemption_bookings_number_by_day.sql
[0m02:03:01.701690 [debug] [MainThread]: 1699: static parser successfully parsed analytics/ticket_sales_counts.sql
[0m02:03:01.710421 [debug] [MainThread]: 1699: static parser successfully parsed analytics/valid_and_bookable_routes.sql
[0m02:03:01.712940 [debug] [MainThread]: 1699: static parser successfully parsed analytics/redemption_bookings_number_by_day.sql
[0m02:03:01.721451 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e95112cc-5bdd-4f9f-919f-2fa365169dc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e7b0d0>]}
[0m02:03:01.725756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e95112cc-5bdd-4f9f-919f-2fa365169dc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111da5610>]}
[0m02:03:01.726053 [info ] [MainThread]: Found 3 models, 0 tests, 0 snapshots, 0 analyses, 307 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m02:03:01.726304 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e95112cc-5bdd-4f9f-919f-2fa365169dc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111da5580>]}
[0m02:03:01.727214 [info ] [MainThread]: 
[0m02:03:01.727688 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m02:03:01.728345 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bookings'
[0m02:03:01.735018 [debug] [ThreadPool]: Using postgres connection "list_bookings"
[0m02:03:01.735234 [debug] [ThreadPool]: On list_bookings: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings"} */

    select distinct nspname from pg_namespace
  
[0m02:03:01.735409 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:03:01.958512 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.0 seconds
[0m02:03:01.959628 [debug] [ThreadPool]: On list_bookings: Close
[0m02:03:01.960675 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bookings, now list_bookings_dbt)
[0m02:03:01.965019 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m02:03:01.965247 [debug] [ThreadPool]: On list_bookings_dbt: BEGIN
[0m02:03:01.965494 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:03:01.984237 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m02:03:01.984512 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m02:03:01.984735 [debug] [ThreadPool]: On list_bookings_dbt: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings_dbt"} */
select
      'bookings' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'bookings' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
[0m02:03:01.988688 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m02:03:01.989657 [debug] [ThreadPool]: On list_bookings_dbt: ROLLBACK
[0m02:03:01.990465 [debug] [ThreadPool]: On list_bookings_dbt: Close
[0m02:03:01.994257 [debug] [MainThread]: Using postgres connection "master"
[0m02:03:01.994485 [debug] [MainThread]: On master: BEGIN
[0m02:03:01.994663 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:03:02.006918 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m02:03:02.007248 [debug] [MainThread]: Using postgres connection "master"
[0m02:03:02.007543 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m02:03:02.030171 [debug] [MainThread]: SQL status: SELECT 6 in 0.0 seconds
[0m02:03:02.031277 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e95112cc-5bdd-4f9f-919f-2fa365169dc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111ebaf70>]}
[0m02:03:02.031646 [debug] [MainThread]: On master: ROLLBACK
[0m02:03:02.032172 [debug] [MainThread]: Using postgres connection "master"
[0m02:03:02.032399 [debug] [MainThread]: On master: BEGIN
[0m02:03:02.033030 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m02:03:02.033281 [debug] [MainThread]: On master: COMMIT
[0m02:03:02.033507 [debug] [MainThread]: Using postgres connection "master"
[0m02:03:02.033709 [debug] [MainThread]: On master: COMMIT
[0m02:03:02.034101 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m02:03:02.034332 [debug] [MainThread]: On master: Close
[0m02:03:02.034835 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:03:02.035126 [info ] [MainThread]: 
[0m02:03:02.039443 [debug] [Thread-1  ]: Began running node model.plaid_de.redemption_bookings_number_by_day
[0m02:03:02.039733 [debug] [Thread-2  ]: Began running node model.plaid_de.ticket_sales_counts
[0m02:03:02.040004 [debug] [Thread-3  ]: Began running node model.plaid_de.valid_and_bookable_routes
[0m02:03:02.040382 [info ] [Thread-1  ]: 1 of 3 START sql incremental model dbt.redemption_bookings_number_by_day ....... [RUN]
[0m02:03:02.040803 [info ] [Thread-2  ]: 2 of 3 START sql incremental model dbt.ticket_sales_counts ..................... [RUN]
[0m02:03:02.041185 [info ] [Thread-3  ]: 3 of 3 START sql incremental model dbt.valid_and_bookable_routes ............... [RUN]
[0m02:03:02.041692 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bookings_dbt, now model.plaid_de.redemption_bookings_number_by_day)
[0m02:03:02.042142 [debug] [Thread-2  ]: Acquiring new postgres connection 'model.plaid_de.ticket_sales_counts'
[0m02:03:02.042634 [debug] [Thread-3  ]: Acquiring new postgres connection 'model.plaid_de.valid_and_bookable_routes'
[0m02:03:02.042897 [debug] [Thread-1  ]: Began compiling node model.plaid_de.redemption_bookings_number_by_day
[0m02:03:02.043146 [debug] [Thread-2  ]: Began compiling node model.plaid_de.ticket_sales_counts
[0m02:03:02.043381 [debug] [Thread-3  ]: Began compiling node model.plaid_de.valid_and_bookable_routes
[0m02:03:02.049455 [debug] [Thread-1  ]: Writing injected SQL for node "model.plaid_de.redemption_bookings_number_by_day"
[0m02:03:02.051324 [debug] [Thread-2  ]: Writing injected SQL for node "model.plaid_de.ticket_sales_counts"
[0m02:03:02.053544 [debug] [Thread-3  ]: Writing injected SQL for node "model.plaid_de.valid_and_bookable_routes"
[0m02:03:02.054152 [debug] [Thread-1  ]: Timing info for model.plaid_de.redemption_bookings_number_by_day (compile): 02:03:02.043544 => 02:03:02.054001
[0m02:03:02.054457 [debug] [Thread-2  ]: Timing info for model.plaid_de.ticket_sales_counts (compile): 02:03:02.049636 => 02:03:02.054329
[0m02:03:02.054672 [debug] [Thread-1  ]: Began executing node model.plaid_de.redemption_bookings_number_by_day
[0m02:03:02.054946 [debug] [Thread-2  ]: Began executing node model.plaid_de.ticket_sales_counts
[0m02:03:02.055197 [debug] [Thread-3  ]: Timing info for model.plaid_de.valid_and_bookable_routes (compile): 02:03:02.051512 => 02:03:02.055076
[0m02:03:02.101917 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m02:03:02.102934 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m02:03:02.103167 [debug] [Thread-3  ]: Began executing node model.plaid_de.valid_and_bookable_routes
[0m02:03:02.103431 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */

    
  
    

  create temporary table "redemption_bookings_number_by_day__dbt_tmp020302074612"
  
  
    as
  
  (
    

SELECT
    DATE_TRUNC('day', b.book_date) AS date,
    COUNT(*) AS redemption_count
FROM bookings b
WHERE total_amount = -1
    OR total_amount = 0
    OR total_amount = -12345678.00
GROUP BY date
ORDER BY redemption_count desc
  );
  
  
[0m02:03:02.103721 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */

    
  
    

  create temporary table "ticket_sales_counts__dbt_tmp020302082118"
  
  
    as
  
  (
    

WITH daily_ticket_sales AS (
    SELECT
        DATE_TRUNC('day', b.book_date) AS sale_date,
        COUNT(t.ticket_no) AS total_tickets
    FROM bookings b
    JOIN tickets t ON b.book_ref = t.book_ref
    GROUP BY sale_date
),

rolling_7d_ticket_sales AS (
    SELECT
        sale_date,
        SUM(total_tickets) OVER (ORDER BY sale_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS rolling_7_days_total
    FROM daily_ticket_sales
),

rolling_28d_ticket_sales AS (
    SELECT
        sale_date,
        SUM(total_tickets) OVER (ORDER BY sale_date ROWS BETWEEN 27 PRECEDING AND CURRENT ROW) AS rolling_28_days_total
    FROM daily_ticket_sales
)
SELECT
    dts.sale_date AS date,
    dts.total_tickets AS daily_total_tickets,
    rolling_7d.rolling_7_days_total,
    rolling_28d.rolling_28_days_total
FROM daily_ticket_sales dts
LEFT JOIN rolling_7d_ticket_sales AS rolling_7d
    ON dts.sale_date = rolling_7d.sale_date
LEFT JOIN rolling_28d_ticket_sales AS rolling_28d
    ON dts.sale_date = rolling_28d.sale_date
  );
  
  
[0m02:03:02.107506 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m02:03:02.107762 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m02:03:02.107988 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m02:03:02.108406 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */

    
  
    

  create temporary table "valid_and_bookable_routes__dbt_tmp020302105839"
  
  
    as
  
  (
    

WITH no_transfer_flights AS (
    SELECT
        route1.flight_no AS first_flight,
        NULL AS second_flight,
        route1.departure_airport AS first_departure_airport,
        route1.arrival_airport AS first_arrival_airport,
        NULL AS second_departure_airport,
        NULL AS second_arrival_airport,
        route1.scheduled_departure as first_scheduled_departure_time,
        NULL::time without time zone as second_scheduled_departure_time,
        route1.scheduled_arrival as first_scheduled_arrival_time,
        NULL::time without time zone as second_scheduled_arrival_time
    FROM routes AS route1
),
one_transfer_flights AS (
    SELECT
        route1.flight_no AS first_flight,
        route2.flight_no AS second_flight,
        route1.departure_airport AS first_departure_airport,
        route1.arrival_airport AS first_arrival_airport,
        route2.departure_airport AS second_departure_airport,
        route2.arrival_airport AS second_arrival_airport,
        route1.scheduled_departure as first_scheduled_departure_time,
        route2.scheduled_departure as second_scheduled_departure_time,
        route1.scheduled_arrival as first_scheduled_arrival_time,
        route2.scheduled_arrival as second_scheduled_arrival_time
    FROM routes AS route1
    LEFT OUTER JOIN routes AS route2
    ON route1.arrival_airport = route2.departure_airport
),
max_1_transfer_and_non_circular_flights AS (
  SELECT
    first_flight,
    second_flight,
    first_departure_airport,
    first_arrival_airport,
    second_departure_airport,
    second_arrival_airport,
    first_scheduled_departure_time,
    second_scheduled_departure_time,
    first_scheduled_arrival_time,
    second_scheduled_arrival_time
  FROM one_transfer_flights
  WHERE first_departure_airport <> second_arrival_airport -- non-circular
  UNION ALL
  SELECT
    first_flight,
    second_flight,
    first_departure_airport,
    first_arrival_airport,
    second_departure_airport,
    second_arrival_airport,
    first_scheduled_departure_time,
    second_scheduled_departure_time,
    first_scheduled_arrival_time,
    second_scheduled_arrival_time
  FROM no_transfer_flights
),
max_1_transfer_and_non_circular_flights_with_travel_times AS (
    SELECT
        first_flight,
        second_flight,
        first_departure_airport,
        first_arrival_airport,
        second_departure_airport,
        second_arrival_airport,
        first_scheduled_departure_time,
        first_scheduled_arrival_time,
        second_scheduled_departure_time,
        second_scheduled_arrival_time,
        CASE WHEN first_scheduled_arrival_time - first_scheduled_departure_time < '00:00:00'::INTERVAL
            THEN first_scheduled_arrival_time - first_scheduled_departure_time + INTERVAL '24 HOURS'
            ELSE first_scheduled_arrival_time - first_scheduled_departure_time
        END as normalized_first_leg,
        CASE WHEN second_scheduled_departure_time - first_scheduled_arrival_time < '00:00:00'::INTERVAL
            THEN second_scheduled_departure_time - first_scheduled_arrival_time + INTERVAL '24 HOURS'
            ELSE second_scheduled_departure_time - first_scheduled_arrival_time
        END as normalized_second_leg,
        CASE WHEN second_scheduled_arrival_time - second_scheduled_departure_time < '00:00:00'::INTERVAL
            THEN second_scheduled_arrival_time - second_scheduled_departure_time + INTERVAL '24 HOURS'
            ELSE second_scheduled_arrival_time - second_scheduled_departure_time
        END as normalized_third_leg
    FROM max_1_transfer_and_non_circular_flights
), max_1_transfer_and_non_circular_flights_within_24hours AS (
    SELECT
        first_flight,
        second_flight,
        first_departure_airport,
        first_arrival_airport,
        second_departure_airport,
        second_arrival_airport,
        first_scheduled_departure_time,
        first_scheduled_arrival_time,
        second_scheduled_departure_time,
        second_scheduled_arrival_time
    FROM max_1_transfer_and_non_circular_flights_with_travel_times
    WHERE normalized_first_leg + normalized_second_leg + normalized_third_leg <= INTERVAL '24 HOURS'
) SELECT
    first_flight as first_flight_no,
    second_flight as second_flight_no,
    first_departure_airport as origin_airport,
    COALESCE(second_arrival_airport, first_arrival_airport) as destination_airport_code,
    CASE WHEN second_flight IS NOT NULL THEN first_arrival_airport END as transfer_airport_code,
    first_scheduled_departure_time as first_scheduled_departure_time,
    CASE WHEN second_flight IS NOT NULL THEN first_scheduled_arrival_time END as transfer_airport_arrival_time,
    CASE WHEN second_flight IS NOT NULL THEN second_scheduled_departure_time END as transfer_airport_departure_time,
    COALESCE(second_scheduled_arrival_time, first_scheduled_arrival_time) as destination_arrival_time
FROM max_1_transfer_and_non_circular_flights_within_24hours AS valid_routes
  );
  
  
[0m02:03:02.109030 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m02:03:02.195991 [debug] [Thread-1  ]: SQL status: SELECT 111 in 0.0 seconds
[0m02:03:02.202121 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m02:03:02.202510 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: BEGIN
[0m02:03:02.203593 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m02:03:02.203889 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m02:03:02.204151 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'redemption_bookings_number_by_day__dbt_tmp020302074612'
        
      order by ordinal_position

  
[0m02:03:02.208791 [debug] [Thread-1  ]: SQL status: SELECT 2 in 0.0 seconds
[0m02:03:02.212967 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m02:03:02.213287 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "bookings".INFORMATION_SCHEMA.columns
      where table_name = 'redemption_bookings_number_by_day'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
[0m02:03:02.215570 [debug] [Thread-1  ]: SQL status: SELECT 2 in 0.0 seconds
[0m02:03:02.221618 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m02:03:02.221960 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "bookings".INFORMATION_SCHEMA.columns
      where table_name = 'redemption_bookings_number_by_day'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
[0m02:03:02.223641 [debug] [Thread-1  ]: SQL status: SELECT 2 in 0.0 seconds
[0m02:03:02.233822 [debug] [Thread-1  ]: Writing runtime sql for node "model.plaid_de.redemption_bookings_number_by_day"
[0m02:03:02.234369 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m02:03:02.234637 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */

      
        
            delete from "bookings"."dbt"."redemption_bookings_number_by_day"
            where (
                date) in (
                select (date)
                from "redemption_bookings_number_by_day__dbt_tmp020302074612"
            );

        
    

    insert into "bookings"."dbt"."redemption_bookings_number_by_day" ("date", "redemption_count")
    (
        select "date", "redemption_count"
        from "redemption_bookings_number_by_day__dbt_tmp020302074612"
    )
  
[0m02:03:02.236300 [debug] [Thread-1  ]: SQL status: INSERT 0 111 in 0.0 seconds
[0m02:03:02.246978 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: COMMIT
[0m02:03:02.247238 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m02:03:02.247461 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: COMMIT
[0m02:03:02.248595 [debug] [Thread-1  ]: SQL status: COMMIT in 0.0 seconds
[0m02:03:02.249234 [debug] [Thread-1  ]: Timing info for model.plaid_de.redemption_bookings_number_by_day (execute): 02:03:02.055346 => 02:03:02.249096
[0m02:03:02.249485 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: Close
[0m02:03:02.249987 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e95112cc-5bdd-4f9f-919f-2fa365169dc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112055e50>]}
[0m02:03:02.250981 [info ] [Thread-1  ]: 1 of 3 OK created sql incremental model dbt.redemption_bookings_number_by_day .. [[32mINSERT 0 111[0m in 0.21s]
[0m02:03:02.251550 [debug] [Thread-1  ]: Finished running node model.plaid_de.redemption_bookings_number_by_day
[0m02:03:02.253489 [debug] [Thread-3  ]: SQL status: SELECT 8112 in 0.0 seconds
[0m02:03:02.255568 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m02:03:02.255802 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: BEGIN
[0m02:03:02.256245 [debug] [Thread-3  ]: SQL status: BEGIN in 0.0 seconds
[0m02:03:02.256477 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m02:03:02.256705 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'valid_and_bookable_routes__dbt_tmp020302105839'
        
      order by ordinal_position

  
[0m02:03:02.259261 [debug] [Thread-3  ]: SQL status: SELECT 9 in 0.0 seconds
[0m02:03:02.261455 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m02:03:02.261701 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "bookings".INFORMATION_SCHEMA.columns
      where table_name = 'valid_and_bookable_routes'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
[0m02:03:02.263319 [debug] [Thread-3  ]: SQL status: SELECT 9 in 0.0 seconds
[0m02:03:02.265700 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m02:03:02.265956 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "bookings".INFORMATION_SCHEMA.columns
      where table_name = 'valid_and_bookable_routes'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
[0m02:03:02.267393 [debug] [Thread-3  ]: SQL status: SELECT 9 in 0.0 seconds
[0m02:03:02.269173 [debug] [Thread-3  ]: Writing runtime sql for node "model.plaid_de.valid_and_bookable_routes"
[0m02:03:02.269656 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m02:03:02.269938 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */

      
        
            delete from "bookings"."dbt"."valid_and_bookable_routes"
            where (
                [first_flight_no, second_flight_no, first_departure_airport, second_departure_airport, first_arrival_airport, second_arrival_airport]) in (
                select ([first_flight_no, second_flight_no, first_departure_airport, second_departure_airport, first_arrival_airport, second_arrival_airport])
                from "valid_and_bookable_routes__dbt_tmp020302105839"
            );

        
    

    insert into "bookings"."dbt"."valid_and_bookable_routes" ("first_flight_no", "second_flight_no", "origin_airport", "destination_airport_code", "transfer_airport_code", "first_scheduled_departure_time", "transfer_airport_arrival_time", "transfer_airport_departure_time", "destination_arrival_time")
    (
        select "first_flight_no", "second_flight_no", "origin_airport", "destination_airport_code", "transfer_airport_code", "first_scheduled_departure_time", "transfer_airport_arrival_time", "transfer_airport_departure_time", "destination_arrival_time"
        from "valid_and_bookable_routes__dbt_tmp020302105839"
    )
  
[0m02:03:02.271594 [debug] [Thread-3  ]: Postgres adapter: Postgres error: syntax error at or near "["
LINE 7:                 [first_flight_no, second_flight_no, first_de...
                        ^

[0m02:03:02.271888 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: ROLLBACK
[0m02:03:02.272588 [debug] [Thread-3  ]: Timing info for model.plaid_de.valid_and_bookable_routes (execute): 02:03:02.103916 => 02:03:02.272430
[0m02:03:02.272839 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: Close
[0m02:03:02.277157 [debug] [Thread-3  ]: Database Error in model valid_and_bookable_routes (models/analytics/valid_and_bookable_routes.sql)
  syntax error at or near "["
  LINE 7:                 [first_flight_no, second_flight_no, first_de...
                          ^
  compiled Code at target/run/plaid_de/models/analytics/valid_and_bookable_routes.sql
[0m02:03:02.277460 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e95112cc-5bdd-4f9f-919f-2fa365169dc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111eb6f70>]}
[0m02:03:02.277835 [error] [Thread-3  ]: 3 of 3 ERROR creating sql incremental model dbt.valid_and_bookable_routes ...... [[31mERROR[0m in 0.24s]
[0m02:03:02.278174 [debug] [Thread-3  ]: Finished running node model.plaid_de.valid_and_bookable_routes
[0m02:03:02.657410 [debug] [Thread-2  ]: SQL status: SELECT 117 in 1.0 seconds
[0m02:03:02.670964 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m02:03:02.671836 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: BEGIN
[0m02:03:02.672894 [debug] [Thread-2  ]: SQL status: BEGIN in 0.0 seconds
[0m02:03:02.673511 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m02:03:02.674187 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'ticket_sales_counts__dbt_tmp020302082118'
        
      order by ordinal_position

  
[0m02:03:02.678237 [debug] [Thread-2  ]: SQL status: SELECT 4 in 0.0 seconds
[0m02:03:02.685847 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m02:03:02.686903 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "bookings".INFORMATION_SCHEMA.columns
      where table_name = 'ticket_sales_counts'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
[0m02:03:02.689277 [debug] [Thread-2  ]: SQL status: SELECT 4 in 0.0 seconds
[0m02:03:02.695442 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m02:03:02.695889 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "bookings".INFORMATION_SCHEMA.columns
      where table_name = 'ticket_sales_counts'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
[0m02:03:02.697975 [debug] [Thread-2  ]: SQL status: SELECT 4 in 0.0 seconds
[0m02:03:02.699928 [debug] [Thread-2  ]: Writing runtime sql for node "model.plaid_de.ticket_sales_counts"
[0m02:03:02.700511 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m02:03:02.700787 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */

      
        
            delete from "bookings"."dbt"."ticket_sales_counts"
            where (
                date) in (
                select (date)
                from "ticket_sales_counts__dbt_tmp020302082118"
            );

        
    

    insert into "bookings"."dbt"."ticket_sales_counts" ("date", "daily_total_tickets", "rolling_7_days_total", "rolling_28_days_total")
    (
        select "date", "daily_total_tickets", "rolling_7_days_total", "rolling_28_days_total"
        from "ticket_sales_counts__dbt_tmp020302082118"
    )
  
[0m02:03:02.702502 [debug] [Thread-2  ]: SQL status: INSERT 0 117 in 0.0 seconds
[0m02:03:02.706116 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: COMMIT
[0m02:03:02.706549 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m02:03:02.706796 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: COMMIT
[0m02:03:02.707491 [debug] [Thread-2  ]: SQL status: COMMIT in 0.0 seconds
[0m02:03:02.708214 [debug] [Thread-2  ]: Timing info for model.plaid_de.ticket_sales_counts (execute): 02:03:02.080817 => 02:03:02.708006
[0m02:03:02.708477 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: Close
[0m02:03:02.709094 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e95112cc-5bdd-4f9f-919f-2fa365169dc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1120b0370>]}
[0m02:03:02.709563 [info ] [Thread-2  ]: 2 of 3 OK created sql incremental model dbt.ticket_sales_counts ................ [[32mINSERT 0 117[0m in 0.67s]
[0m02:03:02.710063 [debug] [Thread-2  ]: Finished running node model.plaid_de.ticket_sales_counts
[0m02:03:02.711244 [debug] [MainThread]: Using postgres connection "master"
[0m02:03:02.711517 [debug] [MainThread]: On master: BEGIN
[0m02:03:02.711735 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m02:03:02.723237 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m02:03:02.723522 [debug] [MainThread]: On master: COMMIT
[0m02:03:02.723737 [debug] [MainThread]: Using postgres connection "master"
[0m02:03:02.724004 [debug] [MainThread]: On master: COMMIT
[0m02:03:02.724613 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m02:03:02.724864 [debug] [MainThread]: On master: Close
[0m02:03:02.725308 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:03:02.725512 [debug] [MainThread]: Connection 'model.plaid_de.redemption_bookings_number_by_day' was properly closed.
[0m02:03:02.725685 [debug] [MainThread]: Connection 'model.plaid_de.ticket_sales_counts' was properly closed.
[0m02:03:02.725843 [debug] [MainThread]: Connection 'model.plaid_de.valid_and_bookable_routes' was properly closed.
[0m02:03:02.726141 [info ] [MainThread]: 
[0m02:03:02.726405 [info ] [MainThread]: Finished running 3 incremental models in 0 hours 0 minutes and 1.00 seconds (1.00s).
[0m02:03:02.727607 [debug] [MainThread]: Command end result
[0m02:03:02.734394 [info ] [MainThread]: 
[0m02:03:02.734693 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m02:03:02.734991 [info ] [MainThread]: 
[0m02:03:02.735505 [error] [MainThread]: [33mDatabase Error in model valid_and_bookable_routes (models/analytics/valid_and_bookable_routes.sql)[0m
[0m02:03:02.735992 [error] [MainThread]:   syntax error at or near "["
[0m02:03:02.736461 [error] [MainThread]:   LINE 7:                 [first_flight_no, second_flight_no, first_de...
[0m02:03:02.736847 [error] [MainThread]:                           ^
[0m02:03:02.737076 [error] [MainThread]:   compiled Code at target/run/plaid_de/models/analytics/valid_and_bookable_routes.sql
[0m02:03:02.737356 [info ] [MainThread]: 
[0m02:03:02.737710 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m02:03:02.738234 [debug] [MainThread]: Command `dbt run` failed at 02:03:02.738164 after 1.22 seconds
[0m02:03:02.738675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110290f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111f4cfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111f342e0>]}
[0m02:03:02.739036 [debug] [MainThread]: Flushing usage events
[0m02:03:54.992862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1105c4f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111acd340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d3bd6d0>]}


============================== 02:03:54.999849 | 98292040-9e7a-4306-973d-f5193817efe7 ==============================
[0m02:03:54.999849 [info ] [MainThread]: Running with dbt=1.5.4
[0m02:03:55.000304 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '.', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m02:03:55.050143 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '98292040-9e7a-4306-973d-f5193817efe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d3bdc10>]}
[0m02:03:55.063565 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '98292040-9e7a-4306-973d-f5193817efe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e85670>]}
[0m02:03:55.064125 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m02:03:55.082188 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m02:03:55.130521 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m02:03:55.130951 [debug] [MainThread]: Partial parsing: updated file: plaid_de://models/analytics/valid_and_bookable_routes.sql
[0m02:03:55.151123 [debug] [MainThread]: 1699: static parser successfully parsed analytics/valid_and_bookable_routes.sql
[0m02:03:55.165281 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '98292040-9e7a-4306-973d-f5193817efe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1121a8d90>]}
[0m02:03:55.169983 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '98292040-9e7a-4306-973d-f5193817efe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1120d9610>]}
[0m02:03:55.170288 [info ] [MainThread]: Found 3 models, 0 tests, 0 snapshots, 0 analyses, 307 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m02:03:55.170545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '98292040-9e7a-4306-973d-f5193817efe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1120d9580>]}
[0m02:03:55.171481 [info ] [MainThread]: 
[0m02:03:55.171983 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m02:03:55.172656 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bookings'
[0m02:03:55.179364 [debug] [ThreadPool]: Using postgres connection "list_bookings"
[0m02:03:55.179587 [debug] [ThreadPool]: On list_bookings: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings"} */

    select distinct nspname from pg_namespace
  
[0m02:03:55.179769 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:03:55.384068 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.0 seconds
[0m02:03:55.385406 [debug] [ThreadPool]: On list_bookings: Close
[0m02:03:55.386598 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bookings_dbt'
[0m02:03:55.394567 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m02:03:55.394852 [debug] [ThreadPool]: On list_bookings_dbt: BEGIN
[0m02:03:55.395083 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:03:55.409268 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m02:03:55.409648 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m02:03:55.409937 [debug] [ThreadPool]: On list_bookings_dbt: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings_dbt"} */
select
      'bookings' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'bookings' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
[0m02:03:55.414509 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m02:03:55.415748 [debug] [ThreadPool]: On list_bookings_dbt: ROLLBACK
[0m02:03:55.416264 [debug] [ThreadPool]: On list_bookings_dbt: Close
[0m02:03:55.420776 [debug] [MainThread]: Using postgres connection "master"
[0m02:03:55.421071 [debug] [MainThread]: On master: BEGIN
[0m02:03:55.421295 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:03:55.433222 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m02:03:55.433465 [debug] [MainThread]: Using postgres connection "master"
[0m02:03:55.433762 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m02:03:55.454810 [debug] [MainThread]: SQL status: SELECT 6 in 0.0 seconds
[0m02:03:55.455877 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '98292040-9e7a-4306-973d-f5193817efe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112123d90>]}
[0m02:03:55.456221 [debug] [MainThread]: On master: ROLLBACK
[0m02:03:55.457034 [debug] [MainThread]: Using postgres connection "master"
[0m02:03:55.457268 [debug] [MainThread]: On master: BEGIN
[0m02:03:55.458688 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m02:03:55.458915 [debug] [MainThread]: On master: COMMIT
[0m02:03:55.459128 [debug] [MainThread]: Using postgres connection "master"
[0m02:03:55.459328 [debug] [MainThread]: On master: COMMIT
[0m02:03:55.459694 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m02:03:55.459907 [debug] [MainThread]: On master: Close
[0m02:03:55.460399 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:03:55.460688 [info ] [MainThread]: 
[0m02:03:55.465350 [debug] [Thread-1  ]: Began running node model.plaid_de.redemption_bookings_number_by_day
[0m02:03:55.465683 [debug] [Thread-2  ]: Began running node model.plaid_de.ticket_sales_counts
[0m02:03:55.465987 [debug] [Thread-3  ]: Began running node model.plaid_de.valid_and_bookable_routes
[0m02:03:55.466329 [info ] [Thread-1  ]: 1 of 3 START sql incremental model dbt.redemption_bookings_number_by_day ....... [RUN]
[0m02:03:55.466754 [info ] [Thread-2  ]: 2 of 3 START sql incremental model dbt.ticket_sales_counts ..................... [RUN]
[0m02:03:55.467193 [info ] [Thread-3  ]: 3 of 3 START sql incremental model dbt.valid_and_bookable_routes ............... [RUN]
[0m02:03:55.467756 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bookings, now model.plaid_de.redemption_bookings_number_by_day)
[0m02:03:55.468226 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly list_bookings_dbt, now model.plaid_de.ticket_sales_counts)
[0m02:03:55.468713 [debug] [Thread-3  ]: Acquiring new postgres connection 'model.plaid_de.valid_and_bookable_routes'
[0m02:03:55.468990 [debug] [Thread-1  ]: Began compiling node model.plaid_de.redemption_bookings_number_by_day
[0m02:03:55.469263 [debug] [Thread-2  ]: Began compiling node model.plaid_de.ticket_sales_counts
[0m02:03:55.469535 [debug] [Thread-3  ]: Began compiling node model.plaid_de.valid_and_bookable_routes
[0m02:03:55.475833 [debug] [Thread-1  ]: Writing injected SQL for node "model.plaid_de.redemption_bookings_number_by_day"
[0m02:03:55.477894 [debug] [Thread-2  ]: Writing injected SQL for node "model.plaid_de.ticket_sales_counts"
[0m02:03:55.480178 [debug] [Thread-3  ]: Writing injected SQL for node "model.plaid_de.valid_and_bookable_routes"
[0m02:03:55.481077 [debug] [Thread-1  ]: Timing info for model.plaid_de.redemption_bookings_number_by_day (compile): 02:03:55.469721 => 02:03:55.480930
[0m02:03:55.481346 [debug] [Thread-2  ]: Timing info for model.plaid_de.ticket_sales_counts (compile): 02:03:55.476115 => 02:03:55.481216
[0m02:03:55.481616 [debug] [Thread-3  ]: Timing info for model.plaid_de.valid_and_bookable_routes (compile): 02:03:55.478073 => 02:03:55.481495
[0m02:03:55.481832 [debug] [Thread-1  ]: Began executing node model.plaid_de.redemption_bookings_number_by_day
[0m02:03:55.482045 [debug] [Thread-2  ]: Began executing node model.plaid_de.ticket_sales_counts
[0m02:03:55.482265 [debug] [Thread-3  ]: Began executing node model.plaid_de.valid_and_bookable_routes
[0m02:03:55.525766 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m02:03:55.527705 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m02:03:55.531379 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m02:03:55.531656 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */

    
  
    

  create temporary table "redemption_bookings_number_by_day__dbt_tmp020355501933"
  
  
    as
  
  (
    

SELECT
    DATE_TRUNC('day', b.book_date) AS date,
    COUNT(*) AS redemption_count
FROM bookings b
WHERE total_amount = -1
    OR total_amount = 0
    OR total_amount = -12345678.00
GROUP BY date
ORDER BY redemption_count desc
  );
  
  
[0m02:03:55.531950 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */

    
  
    

  create temporary table "ticket_sales_counts__dbt_tmp020355509431"
  
  
    as
  
  (
    

WITH daily_ticket_sales AS (
    SELECT
        DATE_TRUNC('day', b.book_date) AS sale_date,
        COUNT(t.ticket_no) AS total_tickets
    FROM bookings b
    JOIN tickets t ON b.book_ref = t.book_ref
    GROUP BY sale_date
),

rolling_7d_ticket_sales AS (
    SELECT
        sale_date,
        SUM(total_tickets) OVER (ORDER BY sale_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS rolling_7_days_total
    FROM daily_ticket_sales
),

rolling_28d_ticket_sales AS (
    SELECT
        sale_date,
        SUM(total_tickets) OVER (ORDER BY sale_date ROWS BETWEEN 27 PRECEDING AND CURRENT ROW) AS rolling_28_days_total
    FROM daily_ticket_sales
)
SELECT
    dts.sale_date AS date,
    dts.total_tickets AS daily_total_tickets,
    rolling_7d.rolling_7_days_total,
    rolling_28d.rolling_28_days_total
FROM daily_ticket_sales dts
LEFT JOIN rolling_7d_ticket_sales AS rolling_7d
    ON dts.sale_date = rolling_7d.sale_date
LEFT JOIN rolling_28d_ticket_sales AS rolling_28d
    ON dts.sale_date = rolling_28d.sale_date
  );
  
  
[0m02:03:55.532398 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */

    
  
    

  create temporary table "valid_and_bookable_routes__dbt_tmp020355529627"
  
  
    as
  
  (
    

WITH no_transfer_flights AS (
    SELECT
        route1.flight_no AS first_flight,
        NULL AS second_flight,
        route1.departure_airport AS first_departure_airport,
        route1.arrival_airport AS first_arrival_airport,
        NULL AS second_departure_airport,
        NULL AS second_arrival_airport,
        route1.scheduled_departure as first_scheduled_departure_time,
        NULL::time without time zone as second_scheduled_departure_time,
        route1.scheduled_arrival as first_scheduled_arrival_time,
        NULL::time without time zone as second_scheduled_arrival_time
    FROM routes AS route1
),
one_transfer_flights AS (
    SELECT
        route1.flight_no AS first_flight,
        route2.flight_no AS second_flight,
        route1.departure_airport AS first_departure_airport,
        route1.arrival_airport AS first_arrival_airport,
        route2.departure_airport AS second_departure_airport,
        route2.arrival_airport AS second_arrival_airport,
        route1.scheduled_departure as first_scheduled_departure_time,
        route2.scheduled_departure as second_scheduled_departure_time,
        route1.scheduled_arrival as first_scheduled_arrival_time,
        route2.scheduled_arrival as second_scheduled_arrival_time
    FROM routes AS route1
    LEFT OUTER JOIN routes AS route2
    ON route1.arrival_airport = route2.departure_airport
),
max_1_transfer_and_non_circular_flights AS (
  SELECT
    first_flight,
    second_flight,
    first_departure_airport,
    first_arrival_airport,
    second_departure_airport,
    second_arrival_airport,
    first_scheduled_departure_time,
    second_scheduled_departure_time,
    first_scheduled_arrival_time,
    second_scheduled_arrival_time
  FROM one_transfer_flights
  WHERE first_departure_airport <> second_arrival_airport -- non-circular
  UNION ALL
  SELECT
    first_flight,
    second_flight,
    first_departure_airport,
    first_arrival_airport,
    second_departure_airport,
    second_arrival_airport,
    first_scheduled_departure_time,
    second_scheduled_departure_time,
    first_scheduled_arrival_time,
    second_scheduled_arrival_time
  FROM no_transfer_flights
),
max_1_transfer_and_non_circular_flights_with_travel_times AS (
    SELECT
        first_flight,
        second_flight,
        first_departure_airport,
        first_arrival_airport,
        second_departure_airport,
        second_arrival_airport,
        first_scheduled_departure_time,
        first_scheduled_arrival_time,
        second_scheduled_departure_time,
        second_scheduled_arrival_time,
        CASE WHEN first_scheduled_arrival_time - first_scheduled_departure_time < '00:00:00'::INTERVAL
            THEN first_scheduled_arrival_time - first_scheduled_departure_time + INTERVAL '24 HOURS'
            ELSE first_scheduled_arrival_time - first_scheduled_departure_time
        END as normalized_first_leg,
        CASE WHEN second_scheduled_departure_time - first_scheduled_arrival_time < '00:00:00'::INTERVAL
            THEN second_scheduled_departure_time - first_scheduled_arrival_time + INTERVAL '24 HOURS'
            ELSE second_scheduled_departure_time - first_scheduled_arrival_time
        END as normalized_second_leg,
        CASE WHEN second_scheduled_arrival_time - second_scheduled_departure_time < '00:00:00'::INTERVAL
            THEN second_scheduled_arrival_time - second_scheduled_departure_time + INTERVAL '24 HOURS'
            ELSE second_scheduled_arrival_time - second_scheduled_departure_time
        END as normalized_third_leg
    FROM max_1_transfer_and_non_circular_flights
), max_1_transfer_and_non_circular_flights_within_24hours AS (
    SELECT
        first_flight,
        second_flight,
        first_departure_airport,
        first_arrival_airport,
        second_departure_airport,
        second_arrival_airport,
        first_scheduled_departure_time,
        first_scheduled_arrival_time,
        second_scheduled_departure_time,
        second_scheduled_arrival_time
    FROM max_1_transfer_and_non_circular_flights_with_travel_times
    WHERE normalized_first_leg + normalized_second_leg + normalized_third_leg <= INTERVAL '24 HOURS'
) SELECT
    first_flight as first_flight_no,
    second_flight as second_flight_no,
    first_departure_airport as origin_airport,
    COALESCE(second_arrival_airport, first_arrival_airport) as destination_airport_code,
    CASE WHEN second_flight IS NOT NULL THEN first_arrival_airport END as transfer_airport_code,
    first_scheduled_departure_time as first_scheduled_departure_time,
    CASE WHEN second_flight IS NOT NULL THEN first_scheduled_arrival_time END as transfer_airport_arrival_time,
    CASE WHEN second_flight IS NOT NULL THEN second_scheduled_departure_time END as transfer_airport_departure_time,
    COALESCE(second_scheduled_arrival_time, first_scheduled_arrival_time) as destination_arrival_time
FROM max_1_transfer_and_non_circular_flights_within_24hours AS valid_routes
  );
  
  
[0m02:03:55.532809 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m02:03:55.533022 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m02:03:55.533223 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m02:03:55.633045 [debug] [Thread-1  ]: SQL status: SELECT 111 in 0.0 seconds
[0m02:03:55.639579 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m02:03:55.639997 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: BEGIN
[0m02:03:55.641037 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m02:03:55.641414 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m02:03:55.641749 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'redemption_bookings_number_by_day__dbt_tmp020355501933'
        
      order by ordinal_position

  
[0m02:03:55.647602 [debug] [Thread-1  ]: SQL status: SELECT 2 in 0.0 seconds
[0m02:03:55.651731 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m02:03:55.652065 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "bookings".INFORMATION_SCHEMA.columns
      where table_name = 'redemption_bookings_number_by_day'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
[0m02:03:55.653724 [debug] [Thread-1  ]: SQL status: SELECT 2 in 0.0 seconds
[0m02:03:55.659481 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m02:03:55.659777 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "bookings".INFORMATION_SCHEMA.columns
      where table_name = 'redemption_bookings_number_by_day'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
[0m02:03:55.661340 [debug] [Thread-1  ]: SQL status: SELECT 2 in 0.0 seconds
[0m02:03:55.671438 [debug] [Thread-1  ]: Writing runtime sql for node "model.plaid_de.redemption_bookings_number_by_day"
[0m02:03:55.672380 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m02:03:55.672680 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_number_by_day"} */

      
        
            delete from "bookings"."dbt"."redemption_bookings_number_by_day"
            where (
                date) in (
                select (date)
                from "redemption_bookings_number_by_day__dbt_tmp020355501933"
            );

        
    

    insert into "bookings"."dbt"."redemption_bookings_number_by_day" ("date", "redemption_count")
    (
        select "date", "redemption_count"
        from "redemption_bookings_number_by_day__dbt_tmp020355501933"
    )
  
[0m02:03:55.674406 [debug] [Thread-1  ]: SQL status: INSERT 0 111 in 0.0 seconds
[0m02:03:55.685129 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: COMMIT
[0m02:03:55.685402 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_number_by_day"
[0m02:03:55.685629 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: COMMIT
[0m02:03:55.686985 [debug] [Thread-1  ]: SQL status: COMMIT in 0.0 seconds
[0m02:03:55.687616 [debug] [Thread-1  ]: Timing info for model.plaid_de.redemption_bookings_number_by_day (execute): 02:03:55.482419 => 02:03:55.687479
[0m02:03:55.687868 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_number_by_day: Close
[0m02:03:55.688341 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98292040-9e7a-4306-973d-f5193817efe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11242ac40>]}
[0m02:03:55.689381 [info ] [Thread-1  ]: 1 of 3 OK created sql incremental model dbt.redemption_bookings_number_by_day .. [[32mINSERT 0 111[0m in 0.22s]
[0m02:03:55.689924 [debug] [Thread-1  ]: Finished running node model.plaid_de.redemption_bookings_number_by_day
[0m02:03:55.694718 [debug] [Thread-3  ]: SQL status: SELECT 8112 in 0.0 seconds
[0m02:03:55.696910 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m02:03:55.697169 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: BEGIN
[0m02:03:55.697620 [debug] [Thread-3  ]: SQL status: BEGIN in 0.0 seconds
[0m02:03:55.697847 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m02:03:55.698073 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'valid_and_bookable_routes__dbt_tmp020355529627'
        
      order by ordinal_position

  
[0m02:03:55.700635 [debug] [Thread-3  ]: SQL status: SELECT 9 in 0.0 seconds
[0m02:03:55.702888 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m02:03:55.703150 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "bookings".INFORMATION_SCHEMA.columns
      where table_name = 'valid_and_bookable_routes'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
[0m02:03:55.704663 [debug] [Thread-3  ]: SQL status: SELECT 9 in 0.0 seconds
[0m02:03:55.707061 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m02:03:55.707325 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "bookings".INFORMATION_SCHEMA.columns
      where table_name = 'valid_and_bookable_routes'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
[0m02:03:55.708920 [debug] [Thread-3  ]: SQL status: SELECT 9 in 0.0 seconds
[0m02:03:55.710722 [debug] [Thread-3  ]: Writing runtime sql for node "model.plaid_de.valid_and_bookable_routes"
[0m02:03:55.711198 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m02:03:55.711476 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */

      
        
            delete from "bookings"."dbt"."valid_and_bookable_routes"
            where (
                first_flight_no || second_flight_no || first_departure_airport || second_departure_airport || first_arrival_airport || second_arrival_airport) in (
                select (first_flight_no || second_flight_no || first_departure_airport || second_departure_airport || first_arrival_airport || second_arrival_airport)
                from "valid_and_bookable_routes__dbt_tmp020355529627"
            );

        
    

    insert into "bookings"."dbt"."valid_and_bookable_routes" ("first_flight_no", "second_flight_no", "origin_airport", "destination_airport_code", "transfer_airport_code", "first_scheduled_departure_time", "transfer_airport_arrival_time", "transfer_airport_departure_time", "destination_arrival_time")
    (
        select "first_flight_no", "second_flight_no", "origin_airport", "destination_airport_code", "transfer_airport_code", "first_scheduled_departure_time", "transfer_airport_arrival_time", "transfer_airport_departure_time", "destination_arrival_time"
        from "valid_and_bookable_routes__dbt_tmp020355529627"
    )
  
[0m02:03:55.713005 [debug] [Thread-3  ]: Postgres adapter: Postgres error: column "first_departure_airport" does not exist
LINE 8: ...   select (first_flight_no || second_flight_no || first_depa...
                                                             ^

[0m02:03:55.713245 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: ROLLBACK
[0m02:03:55.714037 [debug] [Thread-3  ]: Timing info for model.plaid_de.valid_and_bookable_routes (execute): 02:03:55.527858 => 02:03:55.713898
[0m02:03:55.714271 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: Close
[0m02:03:55.718688 [debug] [Thread-3  ]: Database Error in model valid_and_bookable_routes (models/analytics/valid_and_bookable_routes.sql)
  column "first_departure_airport" does not exist
  LINE 8: ...   select (first_flight_no || second_flight_no || first_depa...
                                                               ^
  compiled Code at target/run/plaid_de/models/analytics/valid_and_bookable_routes.sql
[0m02:03:55.719003 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98292040-9e7a-4306-973d-f5193817efe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1121fd760>]}
[0m02:03:55.719369 [error] [Thread-3  ]: 3 of 3 ERROR creating sql incremental model dbt.valid_and_bookable_routes ...... [[31mERROR[0m in 0.25s]
[0m02:03:55.719712 [debug] [Thread-3  ]: Finished running node model.plaid_de.valid_and_bookable_routes
[0m02:03:56.060236 [debug] [Thread-2  ]: SQL status: SELECT 117 in 1.0 seconds
[0m02:03:56.073396 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m02:03:56.074584 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: BEGIN
[0m02:03:56.076172 [debug] [Thread-2  ]: SQL status: BEGIN in 0.0 seconds
[0m02:03:56.076890 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m02:03:56.077946 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'ticket_sales_counts__dbt_tmp020355509431'
        
      order by ordinal_position

  
[0m02:03:56.081538 [debug] [Thread-2  ]: SQL status: SELECT 4 in 0.0 seconds
[0m02:03:56.092580 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m02:03:56.093439 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "bookings".INFORMATION_SCHEMA.columns
      where table_name = 'ticket_sales_counts'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
[0m02:03:56.095479 [debug] [Thread-2  ]: SQL status: SELECT 4 in 0.0 seconds
[0m02:03:56.102416 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m02:03:56.103518 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "bookings".INFORMATION_SCHEMA.columns
      where table_name = 'ticket_sales_counts'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
[0m02:03:56.105645 [debug] [Thread-2  ]: SQL status: SELECT 4 in 0.0 seconds
[0m02:03:56.109218 [debug] [Thread-2  ]: Writing runtime sql for node "model.plaid_de.ticket_sales_counts"
[0m02:03:56.110451 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m02:03:56.110756 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */

      
        
            delete from "bookings"."dbt"."ticket_sales_counts"
            where (
                date) in (
                select (date)
                from "ticket_sales_counts__dbt_tmp020355509431"
            );

        
    

    insert into "bookings"."dbt"."ticket_sales_counts" ("date", "daily_total_tickets", "rolling_7_days_total", "rolling_28_days_total")
    (
        select "date", "daily_total_tickets", "rolling_7_days_total", "rolling_28_days_total"
        from "ticket_sales_counts__dbt_tmp020355509431"
    )
  
[0m02:03:56.112733 [debug] [Thread-2  ]: SQL status: INSERT 0 117 in 0.0 seconds
[0m02:03:56.114778 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: COMMIT
[0m02:03:56.115246 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m02:03:56.115668 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: COMMIT
[0m02:03:56.116731 [debug] [Thread-2  ]: SQL status: COMMIT in 0.0 seconds
[0m02:03:56.117466 [debug] [Thread-2  ]: Timing info for model.plaid_de.ticket_sales_counts (execute): 02:03:55.508124 => 02:03:56.117278
[0m02:03:56.117758 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: Close
[0m02:03:56.118377 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98292040-9e7a-4306-973d-f5193817efe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1123f0f40>]}
[0m02:03:56.118860 [info ] [Thread-2  ]: 2 of 3 OK created sql incremental model dbt.ticket_sales_counts ................ [[32mINSERT 0 117[0m in 0.65s]
[0m02:03:56.119367 [debug] [Thread-2  ]: Finished running node model.plaid_de.ticket_sales_counts
[0m02:03:56.120711 [debug] [MainThread]: Using postgres connection "master"
[0m02:03:56.121016 [debug] [MainThread]: On master: BEGIN
[0m02:03:56.121245 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m02:03:56.132990 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m02:03:56.133299 [debug] [MainThread]: On master: COMMIT
[0m02:03:56.133515 [debug] [MainThread]: Using postgres connection "master"
[0m02:03:56.133714 [debug] [MainThread]: On master: COMMIT
[0m02:03:56.134339 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m02:03:56.134600 [debug] [MainThread]: On master: Close
[0m02:03:56.135116 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:03:56.135326 [debug] [MainThread]: Connection 'model.plaid_de.redemption_bookings_number_by_day' was properly closed.
[0m02:03:56.135515 [debug] [MainThread]: Connection 'model.plaid_de.ticket_sales_counts' was properly closed.
[0m02:03:56.135692 [debug] [MainThread]: Connection 'model.plaid_de.valid_and_bookable_routes' was properly closed.
[0m02:03:56.136054 [info ] [MainThread]: 
[0m02:03:56.136359 [info ] [MainThread]: Finished running 3 incremental models in 0 hours 0 minutes and 0.96 seconds (0.96s).
[0m02:03:56.137203 [debug] [MainThread]: Command end result
[0m02:03:56.142943 [info ] [MainThread]: 
[0m02:03:56.143284 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m02:03:56.143641 [info ] [MainThread]: 
[0m02:03:56.144068 [error] [MainThread]: [33mDatabase Error in model valid_and_bookable_routes (models/analytics/valid_and_bookable_routes.sql)[0m
[0m02:03:56.144333 [error] [MainThread]:   column "first_departure_airport" does not exist
[0m02:03:56.144591 [error] [MainThread]:   LINE 8: ...   select (first_flight_no || second_flight_no || first_depa...
[0m02:03:56.144993 [error] [MainThread]:                                                                ^
[0m02:03:56.145468 [error] [MainThread]:   compiled Code at target/run/plaid_de/models/analytics/valid_and_bookable_routes.sql
[0m02:03:56.145962 [info ] [MainThread]: 
[0m02:03:56.146509 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m02:03:56.147504 [debug] [MainThread]: Command `dbt run` failed at 02:03:56.147371 after 1.19 seconds
[0m02:03:56.148027 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1105c4f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e859a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e85dc0>]}
[0m02:03:56.148549 [debug] [MainThread]: Flushing usage events
[0m02:05:36.954859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c7dea30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dce7340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095bf6d0>]}


============================== 02:05:36.962249 | 2c1a315f-ba14-45df-bd0d-c12d323caf9e ==============================
[0m02:05:36.962249 [info ] [MainThread]: Running with dbt=1.5.4
[0m02:05:36.962696 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '.', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m02:05:37.012840 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2c1a315f-ba14-45df-bd0d-c12d323caf9e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095bf640>]}
[0m02:05:37.024681 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2c1a315f-ba14-45df-bd0d-c12d323caf9e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e09f6d0>]}
[0m02:05:37.025119 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m02:05:37.040877 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m02:05:37.088536 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m02:05:37.088954 [debug] [MainThread]: Partial parsing: updated file: plaid_de://models/analytics/valid_and_bookable_routes.sql
[0m02:05:37.109094 [debug] [MainThread]: 1603: static parser failed on analytics/valid_and_bookable_routes.sql
[0m02:05:37.111811 [error] [MainThread]: Encountered an error:
Compilation Error in model valid_and_bookable_routes (models/analytics/valid_and_bookable_routes.sql)
  invalid syntax for function call expression
    line 2
      config(
[0m02:05:37.112940 [debug] [MainThread]: Command `dbt run` failed at 02:05:37.112214 after 0.19 seconds
[0m02:05:37.113210 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c7dea30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e394280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e3942b0>]}
[0m02:05:37.113470 [debug] [MainThread]: Flushing usage events
[0m02:06:10.104629 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bae3550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d011340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088bf6d0>]}


============================== 02:06:10.111719 | 9fbed26b-5a60-4889-a082-8e07f84a4c39 ==============================
[0m02:06:10.111719 [info ] [MainThread]: Running with dbt=1.5.4
[0m02:06:10.112207 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'profiles_dir': '.', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m02:06:10.165792 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9fbed26b-5a60-4889-a082-8e07f84a4c39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088bfc10>]}
[0m02:06:10.177579 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9fbed26b-5a60-4889-a082-8e07f84a4c39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d3ca5e0>]}
[0m02:06:10.178041 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m02:06:10.194752 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m02:06:10.243779 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m02:06:10.244194 [debug] [MainThread]: Partial parsing: updated file: plaid_de://models/analytics/valid_and_bookable_routes.sql
[0m02:06:10.264456 [debug] [MainThread]: 1603: static parser failed on analytics/valid_and_bookable_routes.sql
[0m02:06:10.267048 [error] [MainThread]: Encountered an error:
Compilation Error in model valid_and_bookable_routes (models/analytics/valid_and_bookable_routes.sql)
  invalid syntax for function call expression
    line 2
      config(
[0m02:06:10.268192 [debug] [MainThread]: Command `dbt run` failed at 02:06:10.267449 after 0.19 seconds
[0m02:06:10.268451 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bae3550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d6be190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d6be1c0>]}
[0m02:06:10.268706 [debug] [MainThread]: Flushing usage events
[0m02:06:14.684900 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10db85850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f0b4340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a8bf6d0>]}


============================== 02:06:14.689432 | 54b809c7-ce26-4eec-ba06-4adf6961ee50 ==============================
[0m02:06:14.689432 [info ] [MainThread]: Running with dbt=1.5.4
[0m02:06:14.689907 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '.', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m02:06:14.736446 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '54b809c7-ce26-4eec-ba06-4adf6961ee50', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a8bf640>]}
[0m02:06:14.748570 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '54b809c7-ce26-4eec-ba06-4adf6961ee50', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f46c6a0>]}
[0m02:06:14.748969 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m02:06:14.763042 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m02:06:14.801527 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m02:06:14.801972 [debug] [MainThread]: Partial parsing: updated file: plaid_de://models/analytics/valid_and_bookable_routes.sql
[0m02:06:14.820402 [debug] [MainThread]: 1603: static parser failed on analytics/valid_and_bookable_routes.sql
[0m02:06:14.822748 [error] [MainThread]: Encountered an error:
Compilation Error in model valid_and_bookable_routes (models/analytics/valid_and_bookable_routes.sql)
  invalid syntax for function call expression
    line 2
      config(
[0m02:06:14.823574 [debug] [MainThread]: Command `dbt run` failed at 02:06:14.823173 after 0.17 seconds
[0m02:06:14.823833 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10db85850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f760250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f760280>]}
[0m02:06:14.824098 [debug] [MainThread]: Flushing usage events
[0m02:07:43.958780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c1e3850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d712340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108fbf6d0>]}


============================== 02:07:43.967896 | e34dd334-37e7-4aa4-990f-956efb482cab ==============================
[0m02:07:43.967896 [info ] [MainThread]: Running with dbt=1.5.4
[0m02:07:43.968324 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '.', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m02:07:44.017851 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e34dd334-37e7-4aa4-990f-956efb482cab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108fbf640>]}
[0m02:07:44.029587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e34dd334-37e7-4aa4-990f-956efb482cab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10daca6a0>]}
[0m02:07:44.030043 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m02:07:44.047201 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m02:07:44.095636 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m02:07:44.096155 [debug] [MainThread]: Partial parsing: updated file: plaid_de://models/analytics/valid_and_bookable_routes.sql
[0m02:07:44.116547 [debug] [MainThread]: 1603: static parser failed on analytics/valid_and_bookable_routes.sql
[0m02:07:44.119127 [error] [MainThread]: Encountered an error:
Compilation Error in model valid_and_bookable_routes (models/analytics/valid_and_bookable_routes.sql)
  invalid syntax for function call expression
    line 2
      config(
[0m02:07:44.120239 [debug] [MainThread]: Command `dbt run` failed at 02:07:44.119522 after 0.20 seconds
[0m02:07:44.120534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c1e3850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ddbe250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ddbe280>]}
[0m02:07:44.120802 [debug] [MainThread]: Flushing usage events
[0m02:12:54.057854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fc377c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111164880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111164a60>]}


============================== 02:12:54.067944 | 7007de48-b3fa-4dd0-a4ab-20105c071f82 ==============================
[0m02:12:54.067944 [info ] [MainThread]: Running with dbt=1.5.4
[0m02:12:54.068417 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'profiles_dir': '.', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m02:12:54.123022 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7007de48-b3fa-4dd0-a4ab-20105c071f82', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c9bf9d0>]}
[0m02:12:54.136587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7007de48-b3fa-4dd0-a4ab-20105c071f82', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11151e700>]}
[0m02:12:54.137215 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m02:12:54.153968 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m02:12:54.206719 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 3 files changed.
[0m02:12:54.207177 [debug] [MainThread]: Partial parsing: updated file: plaid_de://models/analytics/valid_and_bookable_routes.sql
[0m02:12:54.207466 [debug] [MainThread]: Partial parsing: updated file: plaid_de://models/analytics/redemption_bookings_number_by_day.sql
[0m02:12:54.207736 [debug] [MainThread]: Partial parsing: updated file: plaid_de://models/analytics/ticket_sales_counts.sql
[0m02:12:54.228660 [debug] [MainThread]: 1603: static parser failed on analytics/valid_and_bookable_routes.sql
[0m02:12:54.231444 [error] [MainThread]: Encountered an error:
Compilation Error in model valid_and_bookable_routes (models/analytics/valid_and_bookable_routes.sql)
  invalid syntax for function call expression
    line 2
      config(
[0m02:12:54.232564 [debug] [MainThread]: Command `dbt run` failed at 02:12:54.231884 after 0.21 seconds
[0m02:12:54.232849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fc377c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1117a7fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1118100a0>]}
[0m02:12:54.233130 [debug] [MainThread]: Flushing usage events
[0m14:35:38.090570 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110610a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111b3f340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d3bf6d0>]}


============================== 14:35:38.099413 | a949f5f4-8451-4a37-bbbe-9bba95532e6d ==============================
[0m14:35:38.099413 [info ] [MainThread]: Running with dbt=1.5.4
[0m14:35:38.099851 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'debug': 'False', 'profiles_dir': '.', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:35:38.187455 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a949f5f4-8451-4a37-bbbe-9bba95532e6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d3bf640>]}
[0m14:35:38.199204 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a949f5f4-8451-4a37-bbbe-9bba95532e6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111ef76d0>]}
[0m14:35:38.199831 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m14:35:38.223420 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m14:35:38.274317 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 3 files changed.
[0m14:35:38.274823 [debug] [MainThread]: Partial parsing: updated file: plaid_de://models/analytics/valid_and_bookable_routes.sql
[0m14:35:38.275115 [debug] [MainThread]: Partial parsing: updated file: plaid_de://models/analytics/ticket_sales_counts.sql
[0m14:35:38.275372 [debug] [MainThread]: Partial parsing: updated file: plaid_de://models/analytics/redemption_bookings_number_by_day.sql
[0m14:35:38.296640 [debug] [MainThread]: 1603: static parser failed on analytics/valid_and_bookable_routes.sql
[0m14:35:38.299503 [error] [MainThread]: Encountered an error:
Compilation Error in model valid_and_bookable_routes (models/analytics/valid_and_bookable_routes.sql)
  invalid syntax for function call expression
    line 2
      config(
[0m14:35:38.300551 [debug] [MainThread]: Command `dbt run` failed at 14:35:38.299917 after 0.24 seconds
[0m14:35:38.300812 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110610a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1121e3fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1121ea040>]}
[0m14:35:38.301075 [debug] [MainThread]: Flushing usage events
[0m14:41:50.320840 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e610f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fb3f340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b3bf6d0>]}


============================== 14:41:50.331412 | ec33e750-7981-4245-ae80-14746ca4823f ==============================
[0m14:41:50.331412 [info ] [MainThread]: Running with dbt=1.5.4
[0m14:41:50.331908 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '.', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:41:50.385877 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ec33e750-7981-4245-ae80-14746ca4823f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b3bfc10>]}
[0m14:41:50.397507 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ec33e750-7981-4245-ae80-14746ca4823f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fef8640>]}
[0m14:41:50.397986 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m14:41:50.415264 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m14:41:50.462774 [debug] [MainThread]: Partial parsing enabled: 3 files deleted, 3 files added, 0 files changed.
[0m14:41:50.463178 [debug] [MainThread]: Partial parsing: added file: plaid_de://models/marts/analytics/redemption_bookings_counts_by_day.sql
[0m14:41:50.463429 [debug] [MainThread]: Partial parsing: added file: plaid_de://models/marts/analytics/valid_and_bookable_routes.sql
[0m14:41:50.463635 [debug] [MainThread]: Partial parsing: added file: plaid_de://models/marts/analytics/ticket_sales_counts.sql
[0m14:41:50.463805 [debug] [MainThread]: Partial parsing: deleted file: plaid_de://models/analytics/ticket_sales_counts.sql
[0m14:41:50.463974 [debug] [MainThread]: Partial parsing: deleted file: plaid_de://models/analytics/redemption_bookings_number_by_day.sql
[0m14:41:50.464131 [debug] [MainThread]: Partial parsing: deleted file: plaid_de://models/analytics/valid_and_bookable_routes.sql
[0m14:41:50.484138 [debug] [MainThread]: 1699: static parser successfully parsed marts/analytics/redemption_bookings_counts_by_day.sql
[0m14:41:50.492978 [debug] [MainThread]: 1699: static parser successfully parsed marts/analytics/valid_and_bookable_routes.sql
[0m14:41:50.495387 [debug] [MainThread]: 1699: static parser successfully parsed marts/analytics/ticket_sales_counts.sql
[0m14:41:50.502872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ec33e750-7981-4245-ae80-14746ca4823f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1102200d0>]}
[0m14:41:50.507983 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ec33e750-7981-4245-ae80-14746ca4823f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1101485e0>]}
[0m14:41:50.508268 [info ] [MainThread]: Found 3 models, 0 tests, 0 snapshots, 0 analyses, 307 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m14:41:50.508519 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ec33e750-7981-4245-ae80-14746ca4823f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110148550>]}
[0m14:41:50.509482 [info ] [MainThread]: 
[0m14:41:50.509939 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:41:50.510636 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bookings'
[0m14:41:50.517496 [debug] [ThreadPool]: Using postgres connection "list_bookings"
[0m14:41:50.517729 [debug] [ThreadPool]: On list_bookings: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings"} */

    select distinct nspname from pg_namespace
  
[0m14:41:50.517912 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:41:50.984161 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.0 seconds
[0m14:41:50.987411 [debug] [ThreadPool]: On list_bookings: Close
[0m14:41:50.989022 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bookings, now list_bookings_dbt)
[0m14:41:50.994119 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m14:41:50.994383 [debug] [ThreadPool]: On list_bookings_dbt: BEGIN
[0m14:41:50.994570 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:41:51.026766 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m14:41:51.027152 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m14:41:51.027435 [debug] [ThreadPool]: On list_bookings_dbt: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings_dbt"} */
select
      'bookings' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'bookings' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
[0m14:41:51.072979 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m14:41:51.077505 [debug] [ThreadPool]: On list_bookings_dbt: ROLLBACK
[0m14:41:51.078433 [debug] [ThreadPool]: On list_bookings_dbt: Close
[0m14:41:51.107198 [debug] [MainThread]: Using postgres connection "master"
[0m14:41:51.107680 [debug] [MainThread]: On master: BEGIN
[0m14:41:51.107909 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:41:51.160125 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:41:51.160909 [debug] [MainThread]: Using postgres connection "master"
[0m14:41:51.161666 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:41:51.264306 [debug] [MainThread]: SQL status: SELECT 6 in 0.0 seconds
[0m14:41:51.269272 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ec33e750-7981-4245-ae80-14746ca4823f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11025ebe0>]}
[0m14:41:51.271077 [debug] [MainThread]: On master: ROLLBACK
[0m14:41:51.273073 [debug] [MainThread]: Using postgres connection "master"
[0m14:41:51.273628 [debug] [MainThread]: On master: BEGIN
[0m14:41:51.275267 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:41:51.275754 [debug] [MainThread]: On master: COMMIT
[0m14:41:51.276729 [debug] [MainThread]: Using postgres connection "master"
[0m14:41:51.277883 [debug] [MainThread]: On master: COMMIT
[0m14:41:51.280394 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m14:41:51.281686 [debug] [MainThread]: On master: Close
[0m14:41:51.284625 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:41:51.286407 [info ] [MainThread]: 
[0m14:41:51.299793 [debug] [Thread-1  ]: Began running node model.plaid_de.redemption_bookings_counts_by_day
[0m14:41:51.300509 [debug] [Thread-2  ]: Began running node model.plaid_de.ticket_sales_counts
[0m14:41:51.301147 [debug] [Thread-3  ]: Began running node model.plaid_de.valid_and_bookable_routes
[0m14:41:51.302188 [info ] [Thread-1  ]: 1 of 3 START sql table model dbt.redemption_bookings_counts_by_day ............. [RUN]
[0m14:41:51.303281 [info ] [Thread-2  ]: 2 of 3 START sql table model dbt.ticket_sales_counts ........................... [RUN]
[0m14:41:51.303898 [info ] [Thread-3  ]: 3 of 3 START sql table model dbt.valid_and_bookable_routes ..................... [RUN]
[0m14:41:51.304491 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bookings_dbt, now model.plaid_de.redemption_bookings_counts_by_day)
[0m14:41:51.305018 [debug] [Thread-2  ]: Acquiring new postgres connection 'model.plaid_de.ticket_sales_counts'
[0m14:41:51.305496 [debug] [Thread-3  ]: Acquiring new postgres connection 'model.plaid_de.valid_and_bookable_routes'
[0m14:41:51.305881 [debug] [Thread-1  ]: Began compiling node model.plaid_de.redemption_bookings_counts_by_day
[0m14:41:51.306136 [debug] [Thread-2  ]: Began compiling node model.plaid_de.ticket_sales_counts
[0m14:41:51.306378 [debug] [Thread-3  ]: Began compiling node model.plaid_de.valid_and_bookable_routes
[0m14:41:51.312528 [debug] [Thread-1  ]: Writing injected SQL for node "model.plaid_de.redemption_bookings_counts_by_day"
[0m14:41:51.314474 [debug] [Thread-2  ]: Writing injected SQL for node "model.plaid_de.ticket_sales_counts"
[0m14:41:51.316804 [debug] [Thread-3  ]: Writing injected SQL for node "model.plaid_de.valid_and_bookable_routes"
[0m14:41:51.317679 [debug] [Thread-3  ]: Timing info for model.plaid_de.valid_and_bookable_routes (compile): 14:41:51.314664 => 14:41:51.317512
[0m14:41:51.318070 [debug] [Thread-1  ]: Timing info for model.plaid_de.redemption_bookings_counts_by_day (compile): 14:41:51.306551 => 14:41:51.317887
[0m14:41:51.318339 [debug] [Thread-3  ]: Began executing node model.plaid_de.valid_and_bookable_routes
[0m14:41:51.318597 [debug] [Thread-2  ]: Timing info for model.plaid_de.ticket_sales_counts (compile): 14:41:51.312764 => 14:41:51.318472
[0m14:41:51.318903 [debug] [Thread-1  ]: Began executing node model.plaid_de.redemption_bookings_counts_by_day
[0m14:41:51.344836 [debug] [Thread-2  ]: Began executing node model.plaid_de.ticket_sales_counts
[0m14:41:51.354709 [debug] [Thread-3  ]: Writing runtime sql for node "model.plaid_de.valid_and_bookable_routes"
[0m14:41:51.357962 [debug] [Thread-1  ]: Writing runtime sql for node "model.plaid_de.redemption_bookings_counts_by_day"
[0m14:41:51.361127 [debug] [Thread-2  ]: Writing runtime sql for node "model.plaid_de.ticket_sales_counts"
[0m14:41:51.361844 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m14:41:51.362099 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m14:41:51.362339 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_counts_by_day"
[0m14:41:51.362581 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: BEGIN
[0m14:41:51.362817 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: BEGIN
[0m14:41:51.363058 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_counts_by_day: BEGIN
[0m14:41:51.363284 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m14:41:51.363505 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m14:41:51.363719 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:41:51.379443 [debug] [Thread-2  ]: SQL status: BEGIN in 0.0 seconds
[0m14:41:51.379776 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m14:41:51.380076 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */

  
    

  create  table "bookings"."dbt"."ticket_sales_counts__dbt_tmp"
  
  
    as
  
  (
    

WITH daily_ticket_sales AS (
    SELECT
        DATE_TRUNC('day', b.book_date) AS sale_date,
        COUNT(t.ticket_no) AS total_tickets
    FROM bookings b
    JOIN tickets t ON b.book_ref = t.book_ref
    GROUP BY sale_date
),

rolling_7d_ticket_sales AS (
    SELECT
        sale_date,
        SUM(total_tickets) OVER (ORDER BY sale_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS rolling_7_days_total
    FROM daily_ticket_sales
),

rolling_28d_ticket_sales AS (
    SELECT
        sale_date,
        SUM(total_tickets) OVER (ORDER BY sale_date ROWS BETWEEN 27 PRECEDING AND CURRENT ROW) AS rolling_28_days_total
    FROM daily_ticket_sales
)
SELECT
    dts.sale_date AS date,
    dts.total_tickets AS daily_total_tickets,
    rolling_7d.rolling_7_days_total,
    rolling_28d.rolling_28_days_total
FROM daily_ticket_sales dts
LEFT JOIN rolling_7d_ticket_sales AS rolling_7d
    ON dts.sale_date = rolling_7d.sale_date
LEFT JOIN rolling_28d_ticket_sales AS rolling_28d
    ON dts.sale_date = rolling_28d.sale_date
  );
  
[0m14:41:51.382876 [debug] [Thread-3  ]: SQL status: BEGIN in 0.0 seconds
[0m14:41:51.383131 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m14:41:51.383575 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */

  
    

  create  table "bookings"."dbt"."valid_and_bookable_routes__dbt_tmp"
  
  
    as
  
  (
    

WITH no_transfer_flights AS (
    SELECT
        route1.flight_no AS first_flight,
        NULL AS second_flight,
        route1.departure_airport AS first_departure_airport,
        route1.arrival_airport AS first_arrival_airport,
        NULL AS second_departure_airport,
        NULL AS second_arrival_airport,
        route1.scheduled_departure as first_scheduled_departure_time,
        NULL::time without time zone as second_scheduled_departure_time,
        route1.scheduled_arrival as first_scheduled_arrival_time,
        NULL::time without time zone as second_scheduled_arrival_time
    FROM routes AS route1
),
one_transfer_flights AS (
    SELECT
        route1.flight_no AS first_flight,
        route2.flight_no AS second_flight,
        route1.departure_airport AS first_departure_airport,
        route1.arrival_airport AS first_arrival_airport,
        route2.departure_airport AS second_departure_airport,
        route2.arrival_airport AS second_arrival_airport,
        route1.scheduled_departure as first_scheduled_departure_time,
        route2.scheduled_departure as second_scheduled_departure_time,
        route1.scheduled_arrival as first_scheduled_arrival_time,
        route2.scheduled_arrival as second_scheduled_arrival_time
    FROM routes AS route1
    LEFT OUTER JOIN routes AS route2
    ON route1.arrival_airport = route2.departure_airport
),
max_1_transfer_and_non_circular_flights AS (
  SELECT
    first_flight,
    second_flight,
    first_departure_airport,
    first_arrival_airport,
    second_departure_airport,
    second_arrival_airport,
    first_scheduled_departure_time,
    second_scheduled_departure_time,
    first_scheduled_arrival_time,
    second_scheduled_arrival_time
  FROM one_transfer_flights
  WHERE first_departure_airport <> second_arrival_airport -- non-circular
  UNION ALL
  SELECT
    first_flight,
    second_flight,
    first_departure_airport,
    first_arrival_airport,
    second_departure_airport,
    second_arrival_airport,
    first_scheduled_departure_time,
    second_scheduled_departure_time,
    first_scheduled_arrival_time,
    second_scheduled_arrival_time
  FROM no_transfer_flights
),
max_1_transfer_and_non_circular_flights_with_travel_times AS (
    SELECT
        first_flight,
        second_flight,
        first_departure_airport,
        first_arrival_airport,
        second_departure_airport,
        second_arrival_airport,
        first_scheduled_departure_time,
        first_scheduled_arrival_time,
        second_scheduled_departure_time,
        second_scheduled_arrival_time,
        CASE WHEN first_scheduled_arrival_time - first_scheduled_departure_time < '00:00:00'::INTERVAL
            THEN first_scheduled_arrival_time - first_scheduled_departure_time + INTERVAL '24 HOURS'
            ELSE first_scheduled_arrival_time - first_scheduled_departure_time
        END as normalized_first_leg,
        CASE WHEN second_scheduled_departure_time - first_scheduled_arrival_time < '00:00:00'::INTERVAL
            THEN second_scheduled_departure_time - first_scheduled_arrival_time + INTERVAL '24 HOURS'
            ELSE second_scheduled_departure_time - first_scheduled_arrival_time
        END as normalized_second_leg,
        CASE WHEN second_scheduled_arrival_time - second_scheduled_departure_time < '00:00:00'::INTERVAL
            THEN second_scheduled_arrival_time - second_scheduled_departure_time + INTERVAL '24 HOURS'
            ELSE second_scheduled_arrival_time - second_scheduled_departure_time
        END as normalized_third_leg
    FROM max_1_transfer_and_non_circular_flights
), max_1_transfer_and_non_circular_flights_within_24hours AS (
    SELECT
        first_flight,
        second_flight,
        first_departure_airport,
        first_arrival_airport,
        second_departure_airport,
        second_arrival_airport,
        first_scheduled_departure_time,
        first_scheduled_arrival_time,
        second_scheduled_departure_time,
        second_scheduled_arrival_time
    FROM max_1_transfer_and_non_circular_flights_with_travel_times
    WHERE normalized_first_leg + normalized_second_leg + normalized_third_leg <= INTERVAL '24 HOURS'
) SELECT
    first_flight as first_flight_no,
    second_flight as second_flight_no,
    first_departure_airport as origin_airport,
    COALESCE(second_arrival_airport, first_arrival_airport) as destination_airport_code,
    CASE WHEN second_flight IS NOT NULL THEN first_arrival_airport END as transfer_airport_code,
    first_scheduled_departure_time as first_scheduled_departure_time,
    CASE WHEN second_flight IS NOT NULL THEN first_scheduled_arrival_time END as transfer_airport_arrival_time,
    CASE WHEN second_flight IS NOT NULL THEN second_scheduled_departure_time END as transfer_airport_departure_time,
    COALESCE(second_scheduled_arrival_time, first_scheduled_arrival_time) as destination_arrival_time
FROM max_1_transfer_and_non_circular_flights_within_24hours AS valid_routes
  );
  
[0m14:41:51.389784 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m14:41:51.390161 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_counts_by_day"
[0m14:41:51.390516 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_counts_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_counts_by_day"} */

  
    

  create  table "bookings"."dbt"."redemption_bookings_counts_by_day__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    DATE_TRUNC('day', b.book_date) AS date,
    COUNT(*) AS redemption_count
FROM bookings b
WHERE total_amount = -1
    OR total_amount = 0
    OR total_amount = -12345678.00
GROUP BY date
ORDER BY redemption_count desc
  );
  
[0m14:41:51.826860 [debug] [Thread-1  ]: SQL status: SELECT 111 in 0.0 seconds
[0m14:41:51.841794 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_counts_by_day"
[0m14:41:51.842678 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_counts_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_counts_by_day"} */
alter table "bookings"."dbt"."redemption_bookings_counts_by_day__dbt_tmp" rename to "redemption_bookings_counts_by_day"
[0m14:41:51.846083 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m14:41:51.870318 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_counts_by_day: COMMIT
[0m14:41:51.870761 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_counts_by_day"
[0m14:41:51.871081 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_counts_by_day: COMMIT
[0m14:41:51.873810 [debug] [Thread-1  ]: SQL status: COMMIT in 0.0 seconds
[0m14:41:51.877796 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_counts_by_day"
[0m14:41:51.878093 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_counts_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_counts_by_day"} */
drop table if exists "bookings"."dbt"."redemption_bookings_counts_by_day__dbt_backup" cascade
[0m14:41:51.881169 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.0 seconds
[0m14:41:51.882391 [debug] [Thread-1  ]: Timing info for model.plaid_de.redemption_bookings_counts_by_day (execute): 14:41:51.354973 => 14:41:51.882226
[0m14:41:51.882657 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_counts_by_day: Close
[0m14:41:51.883243 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ec33e750-7981-4245-ae80-14746ca4823f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110449e80>]}
[0m14:41:51.884972 [info ] [Thread-1  ]: 1 of 3 OK created sql table model dbt.redemption_bookings_counts_by_day ........ [[32mSELECT 111[0m in 0.58s]
[0m14:41:51.885540 [debug] [Thread-1  ]: Finished running node model.plaid_de.redemption_bookings_counts_by_day
[0m14:41:51.949803 [debug] [Thread-3  ]: SQL status: SELECT 8112 in 1.0 seconds
[0m14:41:51.960697 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m14:41:51.968265 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */
alter table "bookings"."dbt"."valid_and_bookable_routes" rename to "valid_and_bookable_routes__dbt_backup"
[0m14:41:51.972158 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m14:41:51.978228 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m14:41:51.979157 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */
alter table "bookings"."dbt"."valid_and_bookable_routes__dbt_tmp" rename to "valid_and_bookable_routes"
[0m14:41:51.980249 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m14:41:51.988891 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: COMMIT
[0m14:41:51.989502 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m14:41:51.989786 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: COMMIT
[0m14:41:52.014192 [debug] [Thread-3  ]: SQL status: COMMIT in 0.0 seconds
[0m14:41:52.020362 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m14:41:52.021170 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */
drop table if exists "bookings"."dbt"."valid_and_bookable_routes__dbt_backup" cascade
[0m14:41:52.035860 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.0 seconds
[0m14:41:52.039526 [debug] [Thread-3  ]: Timing info for model.plaid_de.valid_and_bookable_routes (execute): 14:41:51.319061 => 14:41:52.039163
[0m14:41:52.040199 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: Close
[0m14:41:52.041524 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ec33e750-7981-4245-ae80-14746ca4823f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1102f7be0>]}
[0m14:41:52.042914 [info ] [Thread-3  ]: 3 of 3 OK created sql table model dbt.valid_and_bookable_routes ................ [[32mSELECT 8112[0m in 0.74s]
[0m14:41:52.044442 [debug] [Thread-3  ]: Finished running node model.plaid_de.valid_and_bookable_routes
[0m14:41:53.132878 [debug] [Thread-2  ]: SQL status: SELECT 117 in 2.0 seconds
[0m14:41:53.142854 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m14:41:53.143772 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */
alter table "bookings"."dbt"."ticket_sales_counts" rename to "ticket_sales_counts__dbt_backup"
[0m14:41:53.146338 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m14:41:53.153805 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m14:41:53.154852 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */
alter table "bookings"."dbt"."ticket_sales_counts__dbt_tmp" rename to "ticket_sales_counts"
[0m14:41:53.156337 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m14:41:53.162050 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: COMMIT
[0m14:41:53.162935 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m14:41:53.163729 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: COMMIT
[0m14:41:53.167257 [debug] [Thread-2  ]: SQL status: COMMIT in 0.0 seconds
[0m14:41:53.174927 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m14:41:53.175948 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */
drop table if exists "bookings"."dbt"."ticket_sales_counts__dbt_backup" cascade
[0m14:41:53.180797 [debug] [Thread-2  ]: SQL status: DROP TABLE in 0.0 seconds
[0m14:41:53.183591 [debug] [Thread-2  ]: Timing info for model.plaid_de.ticket_sales_counts (execute): 14:41:51.358194 => 14:41:53.183260
[0m14:41:53.184268 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: Close
[0m14:41:53.185702 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ec33e750-7981-4245-ae80-14746ca4823f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110270970>]}
[0m14:41:53.187065 [info ] [Thread-2  ]: 2 of 3 OK created sql table model dbt.ticket_sales_counts ...................... [[32mSELECT 117[0m in 1.88s]
[0m14:41:53.188415 [debug] [Thread-2  ]: Finished running node model.plaid_de.ticket_sales_counts
[0m14:41:53.190470 [debug] [MainThread]: Using postgres connection "master"
[0m14:41:53.190775 [debug] [MainThread]: On master: BEGIN
[0m14:41:53.190988 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:41:53.207409 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:41:53.207965 [debug] [MainThread]: On master: COMMIT
[0m14:41:53.208188 [debug] [MainThread]: Using postgres connection "master"
[0m14:41:53.208385 [debug] [MainThread]: On master: COMMIT
[0m14:41:53.209348 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m14:41:53.209638 [debug] [MainThread]: On master: Close
[0m14:41:53.214277 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:41:53.214589 [debug] [MainThread]: Connection 'model.plaid_de.redemption_bookings_counts_by_day' was properly closed.
[0m14:41:53.214883 [debug] [MainThread]: Connection 'model.plaid_de.ticket_sales_counts' was properly closed.
[0m14:41:53.215121 [debug] [MainThread]: Connection 'model.plaid_de.valid_and_bookable_routes' was properly closed.
[0m14:41:53.215883 [info ] [MainThread]: 
[0m14:41:53.216207 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 2.71 seconds (2.71s).
[0m14:41:53.217057 [debug] [MainThread]: Command end result
[0m14:41:53.222691 [info ] [MainThread]: 
[0m14:41:53.223116 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:41:53.223459 [info ] [MainThread]: 
[0m14:41:53.223909 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m14:41:53.224793 [debug] [MainThread]: Command `dbt run` succeeded at 14:41:53.224711 after 2.94 seconds
[0m14:41:53.225139 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e610f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fef8640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11045d940>]}
[0m14:41:53.225472 [debug] [MainThread]: Flushing usage events
[0m14:53:55.992921 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c1e3850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d712280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108fbf6d0>]}


============================== 14:53:56.003157 | 5f9d3b32-7c01-4d8e-8abd-21653c7b3bc1 ==============================
[0m14:53:56.003157 [info ] [MainThread]: Running with dbt=1.5.4
[0m14:53:56.003636 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/jwan/Desktop/de-technical-assessment', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:53:56.056796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5f9d3b32-7c01-4d8e-8abd-21653c7b3bc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108fbfa60>]}
[0m14:53:56.070817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5f9d3b32-7c01-4d8e-8abd-21653c7b3bc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10daca6a0>]}
[0m14:53:56.071316 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m14:53:56.091721 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m14:53:56.142647 [debug] [MainThread]: Partial parsing enabled: 3 files deleted, 5 files added, 0 files changed.
[0m14:53:56.143079 [debug] [MainThread]: Partial parsing: added file: plaid_de://models/marts/analytics/routes/valid_and_bookable_routes.sql
[0m14:53:56.143360 [debug] [MainThread]: Partial parsing: added file: plaid_de://models/marts/analytics/ticket_sales/ticket_sales_counts.yml
[0m14:53:56.143579 [debug] [MainThread]: Partial parsing: added file: plaid_de://models/marts/analytics/ticket_sales/ticket_sales_counts.sql
[0m14:53:56.143792 [debug] [MainThread]: Partial parsing: added file: plaid_de://models/marts/analytics/redemption_bookings/redemption_bookings_counts_by_day.sql
[0m14:53:56.144002 [debug] [MainThread]: Partial parsing: added file: plaid_de://tests/ticket_sales/test_ticket_sales_counts_are_valid.sql
[0m14:53:56.144195 [debug] [MainThread]: Partial parsing: deleted file: plaid_de://models/marts/analytics/redemption_bookings_counts_by_day.sql
[0m14:53:56.144368 [debug] [MainThread]: Partial parsing: deleted file: plaid_de://models/marts/analytics/ticket_sales_counts.sql
[0m14:53:56.144531 [debug] [MainThread]: Partial parsing: deleted file: plaid_de://models/marts/analytics/valid_and_bookable_routes.sql
[0m14:53:56.165522 [debug] [MainThread]: 1699: static parser successfully parsed marts/analytics/routes/valid_and_bookable_routes.sql
[0m14:53:56.175072 [debug] [MainThread]: 1699: static parser successfully parsed marts/analytics/ticket_sales/ticket_sales_counts.sql
[0m14:53:56.177169 [debug] [MainThread]: 1699: static parser successfully parsed marts/analytics/redemption_bookings/redemption_bookings_counts_by_day.sql
[0m14:53:56.193810 [error] [MainThread]: Encountered an error:
Parsing Error
  at path []: A test must have a materialized value of 'test'
[0m14:53:56.194917 [debug] [MainThread]: Command `dbt test` failed at 14:53:56.194222 after 0.24 seconds
[0m14:53:56.195193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c1e3850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10de217c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10de21790>]}
[0m14:53:56.195463 [debug] [MainThread]: Flushing usage events
[0m14:54:47.320463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e6c4850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fbcd280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b4bc6d0>]}


============================== 14:54:47.329669 | 53480aa7-1045-4e42-834e-a2b17edfff7b ==============================
[0m14:54:47.329669 [info ] [MainThread]: Running with dbt=1.5.4
[0m14:54:47.330113 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'version_check': 'True', 'profiles_dir': '/Users/jwan/Desktop/de-technical-assessment', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:54:47.386565 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '53480aa7-1045-4e42-834e-a2b17edfff7b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b4bca60>]}
[0m14:54:47.398826 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '53480aa7-1045-4e42-834e-a2b17edfff7b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ff856a0>]}
[0m14:54:47.399388 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m14:54:47.416967 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m14:54:47.472685 [debug] [MainThread]: Partial parsing enabled: 3 files deleted, 5 files added, 0 files changed.
[0m14:54:47.473129 [debug] [MainThread]: Partial parsing: added file: plaid_de://models/marts/analytics/routes/valid_and_bookable_routes.sql
[0m14:54:47.473373 [debug] [MainThread]: Partial parsing: added file: plaid_de://models/marts/analytics/ticket_sales/ticket_sales_counts.sql
[0m14:54:47.473586 [debug] [MainThread]: Partial parsing: added file: plaid_de://tests/ticket_sales/test_ticket_sales_counts_are_valid.sql
[0m14:54:47.473804 [debug] [MainThread]: Partial parsing: added file: plaid_de://models/marts/analytics/redemption_bookings/redemption_bookings_counts_by_day.sql
[0m14:54:47.474037 [debug] [MainThread]: Partial parsing: added file: plaid_de://models/marts/analytics/ticket_sales/ticket_sales_counts.yml
[0m14:54:47.474211 [debug] [MainThread]: Partial parsing: deleted file: plaid_de://models/marts/analytics/redemption_bookings_counts_by_day.sql
[0m14:54:47.474375 [debug] [MainThread]: Partial parsing: deleted file: plaid_de://models/marts/analytics/ticket_sales_counts.sql
[0m14:54:47.474533 [debug] [MainThread]: Partial parsing: deleted file: plaid_de://models/marts/analytics/valid_and_bookable_routes.sql
[0m14:54:47.495781 [debug] [MainThread]: 1699: static parser successfully parsed marts/analytics/routes/valid_and_bookable_routes.sql
[0m14:54:47.506230 [debug] [MainThread]: 1699: static parser successfully parsed marts/analytics/ticket_sales/ticket_sales_counts.sql
[0m14:54:47.508522 [debug] [MainThread]: 1699: static parser successfully parsed marts/analytics/redemption_bookings/redemption_bookings_counts_by_day.sql
[0m14:54:47.558203 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '53480aa7-1045-4e42-834e-a2b17edfff7b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1102a20d0>]}
[0m14:54:47.563340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '53480aa7-1045-4e42-834e-a2b17edfff7b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1101de820>]}
[0m14:54:47.563646 [info ] [MainThread]: Found 3 models, 2 tests, 0 snapshots, 0 analyses, 307 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m14:54:47.563931 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '53480aa7-1045-4e42-834e-a2b17edfff7b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1101de790>]}
[0m14:54:47.564879 [info ] [MainThread]: 
[0m14:54:47.565360 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:54:47.566066 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bookings_dbt'
[0m14:54:47.572977 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m14:54:47.573186 [debug] [ThreadPool]: On list_bookings_dbt: BEGIN
[0m14:54:47.573362 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:54:47.802892 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m14:54:47.803390 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m14:54:47.803639 [debug] [ThreadPool]: On list_bookings_dbt: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings_dbt"} */
select
      'bookings' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'bookings' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
[0m14:54:47.868835 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m14:54:47.870477 [debug] [ThreadPool]: On list_bookings_dbt: ROLLBACK
[0m14:54:47.871913 [debug] [ThreadPool]: On list_bookings_dbt: Close
[0m14:54:47.876093 [debug] [MainThread]: Using postgres connection "master"
[0m14:54:47.876351 [debug] [MainThread]: On master: BEGIN
[0m14:54:47.876963 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:54:47.905174 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:54:47.905576 [debug] [MainThread]: Using postgres connection "master"
[0m14:54:47.905986 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:54:47.957523 [debug] [MainThread]: SQL status: SELECT 6 in 0.0 seconds
[0m14:54:47.959175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '53480aa7-1045-4e42-834e-a2b17edfff7b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ff9eca0>]}
[0m14:54:47.960149 [debug] [MainThread]: On master: ROLLBACK
[0m14:54:47.961277 [debug] [MainThread]: Using postgres connection "master"
[0m14:54:47.961458 [debug] [MainThread]: On master: BEGIN
[0m14:54:47.962935 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:54:47.963246 [debug] [MainThread]: On master: COMMIT
[0m14:54:47.963447 [debug] [MainThread]: Using postgres connection "master"
[0m14:54:47.963614 [debug] [MainThread]: On master: COMMIT
[0m14:54:47.964761 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m14:54:47.964964 [debug] [MainThread]: On master: Close
[0m14:54:47.965503 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:54:47.965782 [info ] [MainThread]: 
[0m14:54:47.971214 [debug] [Thread-1  ]: Began running node test.plaid_de.is_even_ticket_sales_counts_favorite_number.8fa45a29e0
[0m14:54:47.971481 [debug] [Thread-2  ]: Began running node test.plaid_de.test_ticket_sales_counts_are_valid
[0m14:54:47.971771 [info ] [Thread-1  ]: 1 of 2 START test is_even_ticket_sales_counts_favorite_number .................. [RUN]
[0m14:54:47.972093 [info ] [Thread-2  ]: 2 of 2 START test test_ticket_sales_counts_are_valid ........................... [RUN]
[0m14:54:47.972585 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bookings_dbt, now test.plaid_de.is_even_ticket_sales_counts_favorite_number.8fa45a29e0)
[0m14:54:47.973021 [debug] [Thread-2  ]: Acquiring new postgres connection 'test.plaid_de.test_ticket_sales_counts_are_valid'
[0m14:54:47.973264 [debug] [Thread-1  ]: Began compiling node test.plaid_de.is_even_ticket_sales_counts_favorite_number.8fa45a29e0
[0m14:54:47.973480 [debug] [Thread-2  ]: Began compiling node test.plaid_de.test_ticket_sales_counts_are_valid
[0m14:54:47.985708 [debug] [Thread-2  ]: Writing injected SQL for node "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m14:54:47.986420 [debug] [Thread-1  ]: Timing info for test.plaid_de.is_even_ticket_sales_counts_favorite_number.8fa45a29e0 (compile): 14:54:47.973738 => 14:54:47.986251
[0m14:54:47.987398 [debug] [Thread-2  ]: Timing info for test.plaid_de.test_ticket_sales_counts_are_valid (compile): 14:54:47.983217 => 14:54:47.987243
[0m14:54:47.987699 [debug] [Thread-2  ]: Began executing node test.plaid_de.test_ticket_sales_counts_are_valid
[0m14:54:48.001960 [debug] [Thread-2  ]: Writing runtime sql for node "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m14:54:48.002604 [debug] [Thread-2  ]: Using postgres connection "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m14:54:48.002910 [debug] [Thread-2  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: BEGIN
[0m14:54:48.003182 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m14:54:48.005506 [debug] [Thread-1  ]: Compilation Error in test is_even_ticket_sales_counts_favorite_number (models/marts/analytics/ticket_sales/ticket_sales_counts.yml)
  'test_is_even' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m14:54:48.006387 [error] [Thread-1  ]: 1 of 2 ERROR is_even_ticket_sales_counts_favorite_number ....................... [[31mERROR[0m in 0.03s]
[0m14:54:48.006818 [debug] [Thread-1  ]: Finished running node test.plaid_de.is_even_ticket_sales_counts_favorite_number.8fa45a29e0
[0m14:54:48.016756 [debug] [Thread-2  ]: SQL status: BEGIN in 0.0 seconds
[0m14:54:48.017071 [debug] [Thread-2  ]: Using postgres connection "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m14:54:48.017419 [debug] [Thread-2  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "test.plaid_de.test_ticket_sales_counts_are_valid"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      

SELECT
    '7-day rolling total matches daily_total_tickets sum for last 7 days' AS test,
    CASE
        WHEN rolling_7d.rolling_7_days_total = SUM(dts.daily_total_tickets) OVER (ORDER BY dts.sale_date DESC ROWS BETWEEN 0 FOLLOWING AND 6 FOLLOWING)
        THEN NULL
        ELSE 'Mismatch: 7-day rolling total does not match expected value.'
    END AS result
FROM daily_ticket_sales dts
LEFT JOIN rolling_7d_ticket_sales AS rolling_7d
    ON dts.sale_date = rolling_7d.sale_date
      
    ) dbt_internal_test
[0m14:54:48.018554 [debug] [Thread-2  ]: Postgres adapter: Postgres error: relation "daily_ticket_sales" does not exist
LINE 16: FROM daily_ticket_sales dts
              ^

[0m14:54:48.018888 [debug] [Thread-2  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: ROLLBACK
[0m14:54:48.019635 [debug] [Thread-2  ]: Timing info for test.plaid_de.test_ticket_sales_counts_are_valid (execute): 14:54:47.988033 => 14:54:48.019491
[0m14:54:48.019884 [debug] [Thread-2  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: Close
[0m14:54:48.023207 [debug] [Thread-2  ]: Database Error in test test_ticket_sales_counts_are_valid (tests/ticket_sales/test_ticket_sales_counts_are_valid.sql)
  relation "daily_ticket_sales" does not exist
  LINE 16: FROM daily_ticket_sales dts
                ^
  compiled Code at target/run/plaid_de/tests/ticket_sales/test_ticket_sales_counts_are_valid.sql
[0m14:54:48.023580 [error] [Thread-2  ]: 2 of 2 ERROR test_ticket_sales_counts_are_valid ................................ [[31mERROR[0m in 0.05s]
[0m14:54:48.024517 [debug] [Thread-2  ]: Finished running node test.plaid_de.test_ticket_sales_counts_are_valid
[0m14:54:48.025756 [debug] [MainThread]: Using postgres connection "master"
[0m14:54:48.025983 [debug] [MainThread]: On master: BEGIN
[0m14:54:48.026209 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:54:48.038698 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:54:48.038970 [debug] [MainThread]: On master: COMMIT
[0m14:54:48.039197 [debug] [MainThread]: Using postgres connection "master"
[0m14:54:48.039378 [debug] [MainThread]: On master: COMMIT
[0m14:54:48.039712 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m14:54:48.039929 [debug] [MainThread]: On master: Close
[0m14:54:48.040338 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:54:48.040524 [debug] [MainThread]: Connection 'test.plaid_de.is_even_ticket_sales_counts_favorite_number.8fa45a29e0' was properly closed.
[0m14:54:48.040692 [debug] [MainThread]: Connection 'test.plaid_de.test_ticket_sales_counts_are_valid' was properly closed.
[0m14:54:48.041061 [info ] [MainThread]: 
[0m14:54:48.041329 [info ] [MainThread]: Finished running 2 tests in 0 hours 0 minutes and 0.48 seconds (0.48s).
[0m14:54:48.041883 [debug] [MainThread]: Command end result
[0m14:54:48.047221 [info ] [MainThread]: 
[0m14:54:48.047544 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m14:54:48.047828 [info ] [MainThread]: 
[0m14:54:48.048103 [error] [MainThread]: [33mCompilation Error in test is_even_ticket_sales_counts_favorite_number (models/marts/analytics/ticket_sales/ticket_sales_counts.yml)[0m
[0m14:54:48.048342 [error] [MainThread]:   'test_is_even' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m14:54:48.048583 [info ] [MainThread]: 
[0m14:54:48.048854 [error] [MainThread]: [33mDatabase Error in test test_ticket_sales_counts_are_valid (tests/ticket_sales/test_ticket_sales_counts_are_valid.sql)[0m
[0m14:54:48.049120 [error] [MainThread]:   relation "daily_ticket_sales" does not exist
[0m14:54:48.049378 [error] [MainThread]:   LINE 16: FROM daily_ticket_sales dts
[0m14:54:48.049636 [error] [MainThread]:                 ^
[0m14:54:48.049902 [error] [MainThread]:   compiled Code at target/run/plaid_de/tests/ticket_sales/test_ticket_sales_counts_are_valid.sql
[0m14:54:48.050140 [info ] [MainThread]: 
[0m14:54:48.050397 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=0 TOTAL=2
[0m14:54:48.050880 [debug] [MainThread]: Command `dbt test` failed at 14:54:48.050815 after 0.76 seconds
[0m14:54:48.051135 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e6c4850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1102e8f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1102a0a30>]}
[0m14:54:48.051383 [debug] [MainThread]: Flushing usage events
[0m14:55:42.134799 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1108ff550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e2e280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d6bf6d0>]}


============================== 14:55:42.147022 | 983477e8-2900-41e6-87b7-2c22dbe9a11e ==============================
[0m14:55:42.147022 [info ] [MainThread]: Running with dbt=1.5.4
[0m14:55:42.147538 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/jwan/Desktop/de-technical-assessment', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:55:42.200654 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '983477e8-2900-41e6-87b7-2c22dbe9a11e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d6bfa60>]}
[0m14:55:42.212563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '983477e8-2900-41e6-87b7-2c22dbe9a11e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1121e6610>]}
[0m14:55:42.213056 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m14:55:42.233535 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m14:55:42.288677 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:55:42.289163 [debug] [MainThread]: Partial parsing: updated file: plaid_de://models/marts/analytics/ticket_sales/ticket_sales_counts.yml
[0m14:55:42.309719 [debug] [MainThread]: 1699: static parser successfully parsed marts/analytics/ticket_sales/ticket_sales_counts.sql
[0m14:55:42.327690 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '983477e8-2900-41e6-87b7-2c22dbe9a11e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1125470d0>]}
[0m14:55:42.333553 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '983477e8-2900-41e6-87b7-2c22dbe9a11e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11248ff70>]}
[0m14:55:42.333853 [info ] [MainThread]: Found 3 models, 1 test, 0 snapshots, 0 analyses, 307 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m14:55:42.334125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '983477e8-2900-41e6-87b7-2c22dbe9a11e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112522190>]}
[0m14:55:42.335021 [info ] [MainThread]: 
[0m14:55:42.335518 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:55:42.336277 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bookings_dbt'
[0m14:55:42.343707 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m14:55:42.343928 [debug] [ThreadPool]: On list_bookings_dbt: BEGIN
[0m14:55:42.344115 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:55:42.390167 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m14:55:42.390479 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m14:55:42.390695 [debug] [ThreadPool]: On list_bookings_dbt: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings_dbt"} */
select
      'bookings' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'bookings' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
[0m14:55:42.403849 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m14:55:42.405136 [debug] [ThreadPool]: On list_bookings_dbt: ROLLBACK
[0m14:55:42.406265 [debug] [ThreadPool]: On list_bookings_dbt: Close
[0m14:55:42.411306 [debug] [MainThread]: Using postgres connection "master"
[0m14:55:42.411560 [debug] [MainThread]: On master: BEGIN
[0m14:55:42.411746 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:55:42.427679 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:55:42.427914 [debug] [MainThread]: Using postgres connection "master"
[0m14:55:42.428205 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:55:42.468354 [debug] [MainThread]: SQL status: SELECT 6 in 0.0 seconds
[0m14:55:42.469352 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '983477e8-2900-41e6-87b7-2c22dbe9a11e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1121fe8e0>]}
[0m14:55:42.469674 [debug] [MainThread]: On master: ROLLBACK
[0m14:55:42.470631 [debug] [MainThread]: Using postgres connection "master"
[0m14:55:42.470821 [debug] [MainThread]: On master: BEGIN
[0m14:55:42.472043 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:55:42.472239 [debug] [MainThread]: On master: COMMIT
[0m14:55:42.472419 [debug] [MainThread]: Using postgres connection "master"
[0m14:55:42.472591 [debug] [MainThread]: On master: COMMIT
[0m14:55:42.473239 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m14:55:42.473425 [debug] [MainThread]: On master: Close
[0m14:55:42.473861 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:55:42.474116 [info ] [MainThread]: 
[0m14:55:42.477683 [debug] [Thread-1  ]: Began running node test.plaid_de.test_ticket_sales_counts_are_valid
[0m14:55:42.478016 [info ] [Thread-1  ]: 1 of 1 START test test_ticket_sales_counts_are_valid ........................... [RUN]
[0m14:55:42.478568 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bookings_dbt, now test.plaid_de.test_ticket_sales_counts_are_valid)
[0m14:55:42.478808 [debug] [Thread-1  ]: Began compiling node test.plaid_de.test_ticket_sales_counts_are_valid
[0m14:55:42.485019 [debug] [Thread-1  ]: Writing injected SQL for node "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m14:55:42.486397 [debug] [Thread-1  ]: Timing info for test.plaid_de.test_ticket_sales_counts_are_valid (compile): 14:55:42.478959 => 14:55:42.486215
[0m14:55:42.486667 [debug] [Thread-1  ]: Began executing node test.plaid_de.test_ticket_sales_counts_are_valid
[0m14:55:42.498530 [debug] [Thread-1  ]: Writing runtime sql for node "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m14:55:42.499656 [debug] [Thread-1  ]: Using postgres connection "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m14:55:42.499944 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: BEGIN
[0m14:55:42.500168 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:55:42.511043 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m14:55:42.511340 [debug] [Thread-1  ]: Using postgres connection "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m14:55:42.511596 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "test.plaid_de.test_ticket_sales_counts_are_valid"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      

SELECT
    '7-day rolling total matches daily_total_tickets sum for last 7 days' AS test,
    CASE
        WHEN rolling_7d.rolling_7_days_total = SUM(dts.daily_total_tickets) OVER (ORDER BY dts.sale_date DESC ROWS BETWEEN 0 FOLLOWING AND 6 FOLLOWING)
        THEN NULL
        ELSE 'Mismatch: 7-day rolling total does not match expected value.'
    END AS result
FROM daily_ticket_sales dts
LEFT JOIN rolling_7d_ticket_sales AS rolling_7d
    ON dts.sale_date = rolling_7d.sale_date
      
    ) dbt_internal_test
[0m14:55:42.512285 [debug] [Thread-1  ]: Postgres adapter: Postgres error: relation "daily_ticket_sales" does not exist
LINE 16: FROM daily_ticket_sales dts
              ^

[0m14:55:42.512537 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: ROLLBACK
[0m14:55:42.513250 [debug] [Thread-1  ]: Timing info for test.plaid_de.test_ticket_sales_counts_are_valid (execute): 14:55:42.486847 => 14:55:42.513079
[0m14:55:42.513519 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: Close
[0m14:55:42.517822 [debug] [Thread-1  ]: Database Error in test test_ticket_sales_counts_are_valid (tests/ticket_sales/test_ticket_sales_counts_are_valid.sql)
  relation "daily_ticket_sales" does not exist
  LINE 16: FROM daily_ticket_sales dts
                ^
  compiled Code at target/run/plaid_de/tests/ticket_sales/test_ticket_sales_counts_are_valid.sql
[0m14:55:42.518748 [error] [Thread-1  ]: 1 of 1 ERROR test_ticket_sales_counts_are_valid ................................ [[31mERROR[0m in 0.04s]
[0m14:55:42.519163 [debug] [Thread-1  ]: Finished running node test.plaid_de.test_ticket_sales_counts_are_valid
[0m14:55:42.520052 [debug] [MainThread]: Using postgres connection "master"
[0m14:55:42.520273 [debug] [MainThread]: On master: BEGIN
[0m14:55:42.520447 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:55:42.533254 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:55:42.533630 [debug] [MainThread]: On master: COMMIT
[0m14:55:42.533836 [debug] [MainThread]: Using postgres connection "master"
[0m14:55:42.534027 [debug] [MainThread]: On master: COMMIT
[0m14:55:42.534639 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m14:55:42.534901 [debug] [MainThread]: On master: Close
[0m14:55:42.535369 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:55:42.535557 [debug] [MainThread]: Connection 'test.plaid_de.test_ticket_sales_counts_are_valid' was properly closed.
[0m14:55:42.535878 [info ] [MainThread]: 
[0m14:55:42.536171 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 0.20 seconds (0.20s).
[0m14:55:42.536619 [debug] [MainThread]: Command end result
[0m14:55:42.541259 [info ] [MainThread]: 
[0m14:55:42.541683 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:55:42.541939 [info ] [MainThread]: 
[0m14:55:42.542185 [error] [MainThread]: [33mDatabase Error in test test_ticket_sales_counts_are_valid (tests/ticket_sales/test_ticket_sales_counts_are_valid.sql)[0m
[0m14:55:42.542424 [error] [MainThread]:   relation "daily_ticket_sales" does not exist
[0m14:55:42.542661 [error] [MainThread]:   LINE 16: FROM daily_ticket_sales dts
[0m14:55:42.542880 [error] [MainThread]:                 ^
[0m14:55:42.543097 [error] [MainThread]:   compiled Code at target/run/plaid_de/tests/ticket_sales/test_ticket_sales_counts_are_valid.sql
[0m14:55:42.543320 [info ] [MainThread]: 
[0m14:55:42.543593 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:55:42.544084 [debug] [MainThread]: Command `dbt test` failed at 14:55:42.544016 after 0.44 seconds
[0m14:55:42.544346 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1108ff550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112522250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112443820>]}
[0m14:55:42.544612 [debug] [MainThread]: Flushing usage events
[0m14:56:33.649025 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e4c4550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f9ce280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b2bf6d0>]}


============================== 14:56:33.660227 | b7fb9161-c960-4d2d-9991-496173a35e5d ==============================
[0m14:56:33.660227 [info ] [MainThread]: Running with dbt=1.5.4
[0m14:56:33.660709 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'profiles_dir': '/Users/jwan/Desktop/de-technical-assessment', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:56:33.712271 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b7fb9161-c960-4d2d-9991-496173a35e5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b2bfa60>]}
[0m14:56:33.724039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b7fb9161-c960-4d2d-9991-496173a35e5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fd85610>]}
[0m14:56:33.724504 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m14:56:33.740901 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m14:56:33.793301 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:56:33.793726 [debug] [MainThread]: Partial parsing: updated file: plaid_de://tests/ticket_sales/test_ticket_sales_counts_are_valid.sql
[0m14:56:33.824210 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b7fb9161-c960-4d2d-9991-496173a35e5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1100b10d0>]}
[0m14:56:33.829481 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b7fb9161-c960-4d2d-9991-496173a35e5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ffabb50>]}
[0m14:56:33.829792 [info ] [MainThread]: Found 3 models, 1 test, 0 snapshots, 0 analyses, 307 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m14:56:33.830084 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b7fb9161-c960-4d2d-9991-496173a35e5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ffabac0>]}
[0m14:56:33.831040 [info ] [MainThread]: 
[0m14:56:33.831561 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:56:33.832395 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bookings_dbt'
[0m14:56:33.839997 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m14:56:33.840229 [debug] [ThreadPool]: On list_bookings_dbt: BEGIN
[0m14:56:33.840417 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:56:33.918712 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m14:56:33.919090 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m14:56:33.919336 [debug] [ThreadPool]: On list_bookings_dbt: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings_dbt"} */
select
      'bookings' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'bookings' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
[0m14:56:33.934877 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m14:56:33.936464 [debug] [ThreadPool]: On list_bookings_dbt: ROLLBACK
[0m14:56:33.937092 [debug] [ThreadPool]: On list_bookings_dbt: Close
[0m14:56:33.941492 [debug] [MainThread]: Using postgres connection "master"
[0m14:56:33.941730 [debug] [MainThread]: On master: BEGIN
[0m14:56:33.941919 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:56:33.992386 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:56:33.992788 [debug] [MainThread]: Using postgres connection "master"
[0m14:56:33.993119 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:56:34.015042 [debug] [MainThread]: SQL status: SELECT 6 in 0.0 seconds
[0m14:56:34.016607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b7fb9161-c960-4d2d-9991-496173a35e5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fd9c6d0>]}
[0m14:56:34.016987 [debug] [MainThread]: On master: ROLLBACK
[0m14:56:34.017607 [debug] [MainThread]: Using postgres connection "master"
[0m14:56:34.017820 [debug] [MainThread]: On master: BEGIN
[0m14:56:34.018597 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:56:34.018953 [debug] [MainThread]: On master: COMMIT
[0m14:56:34.019237 [debug] [MainThread]: Using postgres connection "master"
[0m14:56:34.019468 [debug] [MainThread]: On master: COMMIT
[0m14:56:34.020033 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m14:56:34.020298 [debug] [MainThread]: On master: Close
[0m14:56:34.020925 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:56:34.021297 [info ] [MainThread]: 
[0m14:56:34.025957 [debug] [Thread-1  ]: Began running node test.plaid_de.test_ticket_sales_counts_are_valid
[0m14:56:34.026265 [info ] [Thread-1  ]: 1 of 1 START test test_ticket_sales_counts_are_valid ........................... [RUN]
[0m14:56:34.026843 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bookings_dbt, now test.plaid_de.test_ticket_sales_counts_are_valid)
[0m14:56:34.027110 [debug] [Thread-1  ]: Began compiling node test.plaid_de.test_ticket_sales_counts_are_valid
[0m14:56:34.034165 [debug] [Thread-1  ]: Writing injected SQL for node "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m14:56:34.035722 [debug] [Thread-1  ]: Timing info for test.plaid_de.test_ticket_sales_counts_are_valid (compile): 14:56:34.027294 => 14:56:34.035554
[0m14:56:34.035968 [debug] [Thread-1  ]: Began executing node test.plaid_de.test_ticket_sales_counts_are_valid
[0m14:56:34.047339 [debug] [Thread-1  ]: Writing runtime sql for node "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m14:56:34.047828 [debug] [Thread-1  ]: Using postgres connection "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m14:56:34.048042 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: BEGIN
[0m14:56:34.048246 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:56:34.070767 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m14:56:34.071085 [debug] [Thread-1  ]: Using postgres connection "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m14:56:34.071333 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "test.plaid_de.test_ticket_sales_counts_are_valid"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      

SELECT
    '7-day rolling total matches daily_total_tickets sum for last 7 days' AS test,
    CASE
        WHEN rolling_7d.rolling_7_days_total = SUM(dts.daily_total_tickets) OVER (ORDER BY dts.sale_date DESC ROWS BETWEEN 0 FOLLOWING AND 6 FOLLOWING)
        THEN NULL
        ELSE 'Mismatch: 7-day rolling total does not match expected value.'
    END AS result
FROM dbt.ticket_sales_counts tsc
LEFT JOIN rolling_7d_ticket_sales AS rolling_7d
    ON tsc.sale_date = rolling_7d.sale_date
      
    ) dbt_internal_test
[0m14:56:34.075393 [debug] [Thread-1  ]: Postgres adapter: Postgres error: relation "rolling_7d_ticket_sales" does not exist
LINE 17: LEFT JOIN rolling_7d_ticket_sales AS rolling_7d
                   ^

[0m14:56:34.075678 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: ROLLBACK
[0m14:56:34.076428 [debug] [Thread-1  ]: Timing info for test.plaid_de.test_ticket_sales_counts_are_valid (execute): 14:56:34.036127 => 14:56:34.076270
[0m14:56:34.076726 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: Close
[0m14:56:34.086309 [debug] [Thread-1  ]: Database Error in test test_ticket_sales_counts_are_valid (tests/ticket_sales/test_ticket_sales_counts_are_valid.sql)
  relation "rolling_7d_ticket_sales" does not exist
  LINE 17: LEFT JOIN rolling_7d_ticket_sales AS rolling_7d
                     ^
  compiled Code at target/run/plaid_de/tests/ticket_sales/test_ticket_sales_counts_are_valid.sql
[0m14:56:34.087337 [error] [Thread-1  ]: 1 of 1 ERROR test_ticket_sales_counts_are_valid ................................ [[31mERROR[0m in 0.06s]
[0m14:56:34.087715 [debug] [Thread-1  ]: Finished running node test.plaid_de.test_ticket_sales_counts_are_valid
[0m14:56:34.088672 [debug] [MainThread]: Using postgres connection "master"
[0m14:56:34.088879 [debug] [MainThread]: On master: BEGIN
[0m14:56:34.089054 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:56:34.104527 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:56:34.104879 [debug] [MainThread]: On master: COMMIT
[0m14:56:34.105095 [debug] [MainThread]: Using postgres connection "master"
[0m14:56:34.105276 [debug] [MainThread]: On master: COMMIT
[0m14:56:34.105662 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m14:56:34.105877 [debug] [MainThread]: On master: Close
[0m14:56:34.106286 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:56:34.106458 [debug] [MainThread]: Connection 'test.plaid_de.test_ticket_sales_counts_are_valid' was properly closed.
[0m14:56:34.106776 [info ] [MainThread]: 
[0m14:56:34.107069 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 0.28 seconds (0.28s).
[0m14:56:34.107509 [debug] [MainThread]: Command end result
[0m14:56:34.112816 [info ] [MainThread]: 
[0m14:56:34.113101 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:56:34.113328 [info ] [MainThread]: 
[0m14:56:34.113556 [error] [MainThread]: [33mDatabase Error in test test_ticket_sales_counts_are_valid (tests/ticket_sales/test_ticket_sales_counts_are_valid.sql)[0m
[0m14:56:34.113779 [error] [MainThread]:   relation "rolling_7d_ticket_sales" does not exist
[0m14:56:34.113999 [error] [MainThread]:   LINE 17: LEFT JOIN rolling_7d_ticket_sales AS rolling_7d
[0m14:56:34.114264 [error] [MainThread]:                      ^
[0m14:56:34.114589 [error] [MainThread]:   compiled Code at target/run/plaid_de/tests/ticket_sales/test_ticket_sales_counts_are_valid.sql
[0m14:56:34.114889 [info ] [MainThread]: 
[0m14:56:34.115366 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:56:34.116005 [debug] [MainThread]: Command `dbt test` failed at 14:56:34.115919 after 0.50 seconds
[0m14:56:34.116434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e4c4550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110029a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110029b20>]}
[0m14:56:34.116723 [debug] [MainThread]: Flushing usage events
[0m15:01:57.600501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c7374f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dc66280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094bf6d0>]}


============================== 15:01:57.614053 | 6f4f3e4b-d21f-4b7f-a488-3e3f74bfc56c ==============================
[0m15:01:57.614053 [info ] [MainThread]: Running with dbt=1.5.4
[0m15:01:57.614537 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'profiles_dir': '/Users/jwan/Desktop/de-technical-assessment', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m15:01:57.667882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6f4f3e4b-d21f-4b7f-a488-3e3f74bfc56c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094bfa60>]}
[0m15:01:57.679928 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6f4f3e4b-d21f-4b7f-a488-3e3f74bfc56c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e01e640>]}
[0m15:01:57.680483 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m15:01:57.699184 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m15:01:57.748740 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:01:57.749168 [debug] [MainThread]: Partial parsing: updated file: plaid_de://tests/ticket_sales/test_ticket_sales_counts_are_valid.sql
[0m15:01:57.779204 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6f4f3e4b-d21f-4b7f-a488-3e3f74bfc56c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e3470d0>]}
[0m15:01:57.784157 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6f4f3e4b-d21f-4b7f-a488-3e3f74bfc56c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e27db80>]}
[0m15:01:57.784452 [info ] [MainThread]: Found 3 models, 1 test, 0 snapshots, 0 analyses, 307 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m15:01:57.784713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6f4f3e4b-d21f-4b7f-a488-3e3f74bfc56c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e27daf0>]}
[0m15:01:57.785632 [info ] [MainThread]: 
[0m15:01:57.786116 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:01:57.786870 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bookings_dbt'
[0m15:01:57.793994 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m15:01:57.794221 [debug] [ThreadPool]: On list_bookings_dbt: BEGIN
[0m15:01:57.794402 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:01:58.020153 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m15:01:58.020531 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m15:01:58.020765 [debug] [ThreadPool]: On list_bookings_dbt: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings_dbt"} */
select
      'bookings' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'bookings' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
[0m15:01:58.048493 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m15:01:58.050025 [debug] [ThreadPool]: On list_bookings_dbt: ROLLBACK
[0m15:01:58.051602 [debug] [ThreadPool]: On list_bookings_dbt: Close
[0m15:01:58.056758 [debug] [MainThread]: Using postgres connection "master"
[0m15:01:58.057057 [debug] [MainThread]: On master: BEGIN
[0m15:01:58.057294 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:01:58.082210 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:01:58.082469 [debug] [MainThread]: Using postgres connection "master"
[0m15:01:58.082785 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:01:58.116675 [debug] [MainThread]: SQL status: SELECT 6 in 0.0 seconds
[0m15:01:58.117640 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6f4f3e4b-d21f-4b7f-a488-3e3f74bfc56c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e041640>]}
[0m15:01:58.118121 [debug] [MainThread]: On master: ROLLBACK
[0m15:01:58.118585 [debug] [MainThread]: Using postgres connection "master"
[0m15:01:58.118769 [debug] [MainThread]: On master: BEGIN
[0m15:01:58.119861 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:01:58.120057 [debug] [MainThread]: On master: COMMIT
[0m15:01:58.120233 [debug] [MainThread]: Using postgres connection "master"
[0m15:01:58.120399 [debug] [MainThread]: On master: COMMIT
[0m15:01:58.121088 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:01:58.121267 [debug] [MainThread]: On master: Close
[0m15:01:58.121748 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:01:58.122007 [info ] [MainThread]: 
[0m15:01:58.126702 [debug] [Thread-1  ]: Began running node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:01:58.127271 [info ] [Thread-1  ]: 1 of 1 START test test_ticket_sales_counts_are_valid ........................... [RUN]
[0m15:01:58.127758 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bookings_dbt, now test.plaid_de.test_ticket_sales_counts_are_valid)
[0m15:01:58.128032 [debug] [Thread-1  ]: Began compiling node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:01:58.134170 [debug] [Thread-1  ]: Writing injected SQL for node "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:01:58.135666 [debug] [Thread-1  ]: Timing info for test.plaid_de.test_ticket_sales_counts_are_valid (compile): 15:01:58.128188 => 15:01:58.135511
[0m15:01:58.135896 [debug] [Thread-1  ]: Began executing node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:01:58.146900 [debug] [Thread-1  ]: Writing runtime sql for node "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:01:58.148348 [debug] [Thread-1  ]: Using postgres connection "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:01:58.148625 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: BEGIN
[0m15:01:58.148863 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:01:58.170399 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m15:01:58.170689 [debug] [Thread-1  ]: Using postgres connection "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:01:58.170954 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "test.plaid_de.test_ticket_sales_counts_are_valid"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      

SELECT
    '7-day rolling total matches daily_total_tickets sum for last 7 days' AS test,
    CASE
        WHEN tsc.rolling_7_days_total = SUM(tsc.daily_total_tickets) OVER (ORDER BY tsc.date DESC ROWS BETWEEN 0 FOLLOWING AND 6 FOLLOWING)
        THEN NULL
        ELSE 'Mismatch: 7-day rolling total does not match expected value.'
    END AS 7d_test_result
FROM dbt.ticket_sales_counts tsc
      
    ) dbt_internal_test
[0m15:01:58.171742 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near "7"
LINE 15:     END AS 7d_test_result
                    ^

[0m15:01:58.172008 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: ROLLBACK
[0m15:01:58.172954 [debug] [Thread-1  ]: Timing info for test.plaid_de.test_ticket_sales_counts_are_valid (execute): 15:01:58.136038 => 15:01:58.172783
[0m15:01:58.173226 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: Close
[0m15:01:58.177463 [debug] [Thread-1  ]: Database Error in test test_ticket_sales_counts_are_valid (tests/ticket_sales/test_ticket_sales_counts_are_valid.sql)
  syntax error at or near "7"
  LINE 15:     END AS 7d_test_result
                      ^
  compiled Code at target/run/plaid_de/tests/ticket_sales/test_ticket_sales_counts_are_valid.sql
[0m15:01:58.178420 [error] [Thread-1  ]: 1 of 1 ERROR test_ticket_sales_counts_are_valid ................................ [[31mERROR[0m in 0.05s]
[0m15:01:58.178842 [debug] [Thread-1  ]: Finished running node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:01:58.179835 [debug] [MainThread]: Using postgres connection "master"
[0m15:01:58.180050 [debug] [MainThread]: On master: BEGIN
[0m15:01:58.180227 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:01:58.194777 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:01:58.195024 [debug] [MainThread]: On master: COMMIT
[0m15:01:58.195202 [debug] [MainThread]: Using postgres connection "master"
[0m15:01:58.195366 [debug] [MainThread]: On master: COMMIT
[0m15:01:58.195693 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:01:58.195869 [debug] [MainThread]: On master: Close
[0m15:01:58.196283 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:01:58.196466 [debug] [MainThread]: Connection 'test.plaid_de.test_ticket_sales_counts_are_valid' was properly closed.
[0m15:01:58.196829 [info ] [MainThread]: 
[0m15:01:58.197102 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 0.41 seconds (0.41s).
[0m15:01:58.197533 [debug] [MainThread]: Command end result
[0m15:01:58.201540 [info ] [MainThread]: 
[0m15:01:58.201829 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:01:58.202062 [info ] [MainThread]: 
[0m15:01:58.202299 [error] [MainThread]: [33mDatabase Error in test test_ticket_sales_counts_are_valid (tests/ticket_sales/test_ticket_sales_counts_are_valid.sql)[0m
[0m15:01:58.202525 [error] [MainThread]:   syntax error at or near "7"
[0m15:01:58.202743 [error] [MainThread]:   LINE 15:     END AS 7d_test_result
[0m15:01:58.202964 [error] [MainThread]:                       ^
[0m15:01:58.203184 [error] [MainThread]:   compiled Code at target/run/plaid_de/tests/ticket_sales/test_ticket_sales_counts_are_valid.sql
[0m15:01:58.203397 [info ] [MainThread]: 
[0m15:01:58.203657 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m15:01:58.204119 [debug] [MainThread]: Command `dbt test` failed at 15:01:58.204057 after 0.64 seconds
[0m15:01:58.204374 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c7374f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e2c3dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e2c3b20>]}
[0m15:01:58.204620 [debug] [MainThread]: Flushing usage events
[0m15:02:16.207640 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fcaf4f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1111dd280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cabe6d0>]}


============================== 15:02:16.212437 | 522ee09f-5ce2-42db-91f9-8007feef32ff ==============================
[0m15:02:16.212437 [info ] [MainThread]: Running with dbt=1.5.4
[0m15:02:16.212937 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/jwan/Desktop/de-technical-assessment', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m15:02:16.264993 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '522ee09f-5ce2-42db-91f9-8007feef32ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cabea60>]}
[0m15:02:16.276961 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '522ee09f-5ce2-42db-91f9-8007feef32ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111596610>]}
[0m15:02:16.277419 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m15:02:16.293320 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m15:02:16.340081 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:02:16.340520 [debug] [MainThread]: Partial parsing: updated file: plaid_de://tests/ticket_sales/test_ticket_sales_counts_are_valid.sql
[0m15:02:16.370388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '522ee09f-5ce2-42db-91f9-8007feef32ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1118c00d0>]}
[0m15:02:16.374595 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '522ee09f-5ce2-42db-91f9-8007feef32ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1117efb50>]}
[0m15:02:16.374897 [info ] [MainThread]: Found 3 models, 1 test, 0 snapshots, 0 analyses, 307 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m15:02:16.375158 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '522ee09f-5ce2-42db-91f9-8007feef32ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1117efac0>]}
[0m15:02:16.376040 [info ] [MainThread]: 
[0m15:02:16.376513 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:02:16.377265 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bookings_dbt'
[0m15:02:16.384314 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m15:02:16.384530 [debug] [ThreadPool]: On list_bookings_dbt: BEGIN
[0m15:02:16.384709 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:02:16.421136 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m15:02:16.421382 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m15:02:16.421600 [debug] [ThreadPool]: On list_bookings_dbt: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings_dbt"} */
select
      'bookings' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'bookings' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
[0m15:02:16.430671 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m15:02:16.431746 [debug] [ThreadPool]: On list_bookings_dbt: ROLLBACK
[0m15:02:16.432200 [debug] [ThreadPool]: On list_bookings_dbt: Close
[0m15:02:16.436219 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:16.436459 [debug] [MainThread]: On master: BEGIN
[0m15:02:16.436638 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:02:16.455704 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:02:16.455914 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:16.456193 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:02:16.476127 [debug] [MainThread]: SQL status: SELECT 6 in 0.0 seconds
[0m15:02:16.477150 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '522ee09f-5ce2-42db-91f9-8007feef32ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1115b9640>]}
[0m15:02:16.477473 [debug] [MainThread]: On master: ROLLBACK
[0m15:02:16.477924 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:16.478140 [debug] [MainThread]: On master: BEGIN
[0m15:02:16.478872 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:02:16.479115 [debug] [MainThread]: On master: COMMIT
[0m15:02:16.479307 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:16.479488 [debug] [MainThread]: On master: COMMIT
[0m15:02:16.480047 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:02:16.480238 [debug] [MainThread]: On master: Close
[0m15:02:16.480672 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:02:16.480946 [info ] [MainThread]: 
[0m15:02:16.484586 [debug] [Thread-1  ]: Began running node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:02:16.484855 [info ] [Thread-1  ]: 1 of 1 START test test_ticket_sales_counts_are_valid ........................... [RUN]
[0m15:02:16.485325 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bookings_dbt, now test.plaid_de.test_ticket_sales_counts_are_valid)
[0m15:02:16.485564 [debug] [Thread-1  ]: Began compiling node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:02:16.491737 [debug] [Thread-1  ]: Writing injected SQL for node "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:02:16.492397 [debug] [Thread-1  ]: Timing info for test.plaid_de.test_ticket_sales_counts_are_valid (compile): 15:02:16.485715 => 15:02:16.492261
[0m15:02:16.492620 [debug] [Thread-1  ]: Began executing node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:02:16.503126 [debug] [Thread-1  ]: Writing runtime sql for node "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:02:16.503575 [debug] [Thread-1  ]: Using postgres connection "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:02:16.503796 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: BEGIN
[0m15:02:16.504002 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:02:16.517424 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m15:02:16.517717 [debug] [Thread-1  ]: Using postgres connection "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:02:16.517986 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "test.plaid_de.test_ticket_sales_counts_are_valid"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      

SELECT
    '7-day rolling total matches daily_total_tickets sum for last 7 days' AS test,
    CASE
        WHEN tsc.rolling_7_days_total = SUM(tsc.daily_total_tickets) OVER (ORDER BY tsc.date DESC ROWS BETWEEN 0 FOLLOWING AND 6 FOLLOWING)
        THEN NULL
        ELSE 'Mismatch: 7-day rolling total does not match expected value.'
    END AS test_result
FROM dbt.ticket_sales_counts tsc
      
    ) dbt_internal_test
[0m15:02:16.526245 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.0 seconds
[0m15:02:16.527795 [debug] [Thread-1  ]: Timing info for test.plaid_de.test_ticket_sales_counts_are_valid (execute): 15:02:16.492758 => 15:02:16.527649
[0m15:02:16.528040 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: ROLLBACK
[0m15:02:16.528464 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: Close
[0m15:02:16.529692 [error] [Thread-1  ]: 1 of 1 FAIL 117 test_ticket_sales_counts_are_valid ............................. [[31mFAIL 117[0m in 0.04s]
[0m15:02:16.530228 [debug] [Thread-1  ]: Finished running node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:02:16.531240 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:16.531430 [debug] [MainThread]: On master: BEGIN
[0m15:02:16.531590 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:02:16.546878 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:02:16.547113 [debug] [MainThread]: On master: COMMIT
[0m15:02:16.547302 [debug] [MainThread]: Using postgres connection "master"
[0m15:02:16.547470 [debug] [MainThread]: On master: COMMIT
[0m15:02:16.548047 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:02:16.548279 [debug] [MainThread]: On master: Close
[0m15:02:16.548711 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:02:16.548890 [debug] [MainThread]: Connection 'test.plaid_de.test_ticket_sales_counts_are_valid' was properly closed.
[0m15:02:16.549161 [info ] [MainThread]: 
[0m15:02:16.549433 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 0.17 seconds (0.17s).
[0m15:02:16.549942 [debug] [MainThread]: Command end result
[0m15:02:16.553592 [info ] [MainThread]: 
[0m15:02:16.553878 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:02:16.554100 [info ] [MainThread]: 
[0m15:02:16.554346 [error] [MainThread]: [31mFailure in test test_ticket_sales_counts_are_valid (tests/ticket_sales/test_ticket_sales_counts_are_valid.sql)[0m
[0m15:02:16.554560 [error] [MainThread]:   Got 117 results, configured to fail if != 0
[0m15:02:16.554784 [info ] [MainThread]: 
[0m15:02:16.554999 [info ] [MainThread]:   compiled Code at target/compiled/plaid_de/tests/ticket_sales/test_ticket_sales_counts_are_valid.sql
[0m15:02:16.555206 [info ] [MainThread]: 
[0m15:02:16.555443 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m15:02:16.555865 [debug] [MainThread]: Command `dbt test` failed at 15:02:16.555810 after 0.38 seconds
[0m15:02:16.556094 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fcaf4f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11183aa00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11183ab20>]}
[0m15:02:16.556315 [debug] [MainThread]: Flushing usage events
[0m15:09:38.422532 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dd10f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f23f280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aabf6d0>]}


============================== 15:09:38.436109 | 365654a0-3e72-41ae-969a-8d22ec799f27 ==============================
[0m15:09:38.436109 [info ] [MainThread]: Running with dbt=1.5.4
[0m15:09:38.436564 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/jwan/Desktop/de-technical-assessment', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m15:09:38.488151 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '365654a0-3e72-41ae-969a-8d22ec799f27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aabfa60>]}
[0m15:09:38.500216 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '365654a0-3e72-41ae-969a-8d22ec799f27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f5f7670>]}
[0m15:09:38.500663 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m15:09:38.516803 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m15:09:38.567850 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:09:38.568284 [debug] [MainThread]: Partial parsing: updated file: plaid_de://tests/ticket_sales/test_ticket_sales_counts_are_valid.sql
[0m15:09:38.598797 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '365654a0-3e72-41ae-969a-8d22ec799f27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f9200d0>]}
[0m15:09:38.604195 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '365654a0-3e72-41ae-969a-8d22ec799f27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f856bb0>]}
[0m15:09:38.604482 [info ] [MainThread]: Found 3 models, 1 test, 0 snapshots, 0 analyses, 307 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m15:09:38.604737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '365654a0-3e72-41ae-969a-8d22ec799f27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f856b20>]}
[0m15:09:38.605621 [info ] [MainThread]: 
[0m15:09:38.606090 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:09:38.606814 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bookings_dbt'
[0m15:09:38.613876 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m15:09:38.614106 [debug] [ThreadPool]: On list_bookings_dbt: BEGIN
[0m15:09:38.614288 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:09:38.841477 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m15:09:38.841828 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m15:09:38.842060 [debug] [ThreadPool]: On list_bookings_dbt: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings_dbt"} */
select
      'bookings' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'bookings' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
[0m15:09:38.871742 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m15:09:38.873226 [debug] [ThreadPool]: On list_bookings_dbt: ROLLBACK
[0m15:09:38.874065 [debug] [ThreadPool]: On list_bookings_dbt: Close
[0m15:09:38.879140 [debug] [MainThread]: Using postgres connection "master"
[0m15:09:38.879437 [debug] [MainThread]: On master: BEGIN
[0m15:09:38.879664 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:09:38.898709 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:09:38.898980 [debug] [MainThread]: Using postgres connection "master"
[0m15:09:38.899313 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:09:38.947500 [debug] [MainThread]: SQL status: SELECT 6 in 0.0 seconds
[0m15:09:38.948448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '365654a0-3e72-41ae-969a-8d22ec799f27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f5f7a30>]}
[0m15:09:38.948738 [debug] [MainThread]: On master: ROLLBACK
[0m15:09:38.949321 [debug] [MainThread]: Using postgres connection "master"
[0m15:09:38.949501 [debug] [MainThread]: On master: BEGIN
[0m15:09:38.950214 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:09:38.950426 [debug] [MainThread]: On master: COMMIT
[0m15:09:38.950609 [debug] [MainThread]: Using postgres connection "master"
[0m15:09:38.950784 [debug] [MainThread]: On master: COMMIT
[0m15:09:38.951139 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:09:38.951323 [debug] [MainThread]: On master: Close
[0m15:09:38.951791 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:09:38.952038 [info ] [MainThread]: 
[0m15:09:38.955827 [debug] [Thread-1  ]: Began running node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:09:38.956121 [info ] [Thread-1  ]: 1 of 1 START test test_ticket_sales_counts_are_valid ........................... [RUN]
[0m15:09:38.956649 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bookings_dbt, now test.plaid_de.test_ticket_sales_counts_are_valid)
[0m15:09:38.956896 [debug] [Thread-1  ]: Began compiling node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:09:38.964068 [debug] [Thread-1  ]: Writing injected SQL for node "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:09:38.965478 [debug] [Thread-1  ]: Timing info for test.plaid_de.test_ticket_sales_counts_are_valid (compile): 15:09:38.957057 => 15:09:38.965325
[0m15:09:38.968274 [debug] [Thread-1  ]: Began executing node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:09:38.980476 [debug] [Thread-1  ]: Writing runtime sql for node "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:09:38.981124 [debug] [Thread-1  ]: Using postgres connection "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:09:38.981371 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: BEGIN
[0m15:09:38.981601 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:09:38.995519 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m15:09:38.995788 [debug] [Thread-1  ]: Using postgres connection "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:09:38.996044 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "test.plaid_de.test_ticket_sales_counts_are_valid"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      

WITH cte AS (
    SELECT
    tsc.date,
    tsc.rolling_7_days_total AS actual_7d_total,
    SUM(tsc.daily_total_tickets) OVER (
        ORDER BY tsc.date ASC ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS expected_7d_total -- 6 not 7! god dammit.
    FROM dbt.ticket_sales_counts tsc
)
SELECT
    '7-day rolling total matches daily_total_tickets sum for last 7 days' AS test,
    date,
    calculated_7d_total,
    expected_7d_total
FROM cte
WHERE calculated_7d_total <> expected_7d_total;
      
    ) dbt_internal_test
[0m15:09:38.996688 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near ";"
LINE 23: WHERE calculated_7d_total <> expected_7d_total;
                                                       ^

[0m15:09:38.996926 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: ROLLBACK
[0m15:09:38.997799 [debug] [Thread-1  ]: Timing info for test.plaid_de.test_ticket_sales_counts_are_valid (execute): 15:09:38.968423 => 15:09:38.997626
[0m15:09:38.998058 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: Close
[0m15:09:39.002255 [debug] [Thread-1  ]: Database Error in test test_ticket_sales_counts_are_valid (tests/ticket_sales/test_ticket_sales_counts_are_valid.sql)
  syntax error at or near ";"
  LINE 23: WHERE calculated_7d_total <> expected_7d_total;
                                                         ^
  compiled Code at target/run/plaid_de/tests/ticket_sales/test_ticket_sales_counts_are_valid.sql
[0m15:09:39.003222 [error] [Thread-1  ]: 1 of 1 ERROR test_ticket_sales_counts_are_valid ................................ [[31mERROR[0m in 0.05s]
[0m15:09:39.003621 [debug] [Thread-1  ]: Finished running node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:09:39.004558 [debug] [MainThread]: Using postgres connection "master"
[0m15:09:39.004785 [debug] [MainThread]: On master: BEGIN
[0m15:09:39.004953 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:09:39.016200 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:09:39.016444 [debug] [MainThread]: On master: COMMIT
[0m15:09:39.016634 [debug] [MainThread]: Using postgres connection "master"
[0m15:09:39.016812 [debug] [MainThread]: On master: COMMIT
[0m15:09:39.017338 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:09:39.017532 [debug] [MainThread]: On master: Close
[0m15:09:39.017906 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:09:39.018078 [debug] [MainThread]: Connection 'test.plaid_de.test_ticket_sales_counts_are_valid' was properly closed.
[0m15:09:39.018409 [info ] [MainThread]: 
[0m15:09:39.018664 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 0.41 seconds (0.41s).
[0m15:09:39.019081 [debug] [MainThread]: Command end result
[0m15:09:39.023322 [info ] [MainThread]: 
[0m15:09:39.023612 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:09:39.023841 [info ] [MainThread]: 
[0m15:09:39.024073 [error] [MainThread]: [33mDatabase Error in test test_ticket_sales_counts_are_valid (tests/ticket_sales/test_ticket_sales_counts_are_valid.sql)[0m
[0m15:09:39.024305 [error] [MainThread]:   syntax error at or near ";"
[0m15:09:39.024526 [error] [MainThread]:   LINE 23: WHERE calculated_7d_total <> expected_7d_total;
[0m15:09:39.024741 [error] [MainThread]:                                                          ^
[0m15:09:39.024946 [error] [MainThread]:   compiled Code at target/run/plaid_de/tests/ticket_sales/test_ticket_sales_counts_are_valid.sql
[0m15:09:39.025148 [info ] [MainThread]: 
[0m15:09:39.025390 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m15:09:39.025818 [debug] [MainThread]: Command `dbt test` failed at 15:09:39.025758 after 0.64 seconds
[0m15:09:39.026043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dd10f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f919af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f89b9d0>]}
[0m15:09:39.026270 [debug] [MainThread]: Flushing usage events
[0m15:09:45.987534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fac44f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110fcd280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c8bb6d0>]}


============================== 15:09:45.992032 | c754b535-e1e2-45ac-8f35-05f777bcda87 ==============================
[0m15:09:45.992032 [info ] [MainThread]: Running with dbt=1.5.4
[0m15:09:45.992458 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'profiles_dir': '/Users/jwan/Desktop/de-technical-assessment', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m15:09:46.039947 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c754b535-e1e2-45ac-8f35-05f777bcda87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c8bba60>]}
[0m15:09:46.052100 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c754b535-e1e2-45ac-8f35-05f777bcda87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111385640>]}
[0m15:09:46.052591 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m15:09:46.067624 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m15:09:46.115072 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:09:46.115555 [debug] [MainThread]: Partial parsing: updated file: plaid_de://tests/ticket_sales/test_ticket_sales_counts_are_valid.sql
[0m15:09:46.144558 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c754b535-e1e2-45ac-8f35-05f777bcda87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1116ae0d0>]}
[0m15:09:46.148610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c754b535-e1e2-45ac-8f35-05f777bcda87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1115e3b80>]}
[0m15:09:46.148897 [info ] [MainThread]: Found 3 models, 1 test, 0 snapshots, 0 analyses, 307 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m15:09:46.149172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c754b535-e1e2-45ac-8f35-05f777bcda87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1115e3af0>]}
[0m15:09:46.150041 [info ] [MainThread]: 
[0m15:09:46.150515 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:09:46.151259 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bookings_dbt'
[0m15:09:46.158175 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m15:09:46.158386 [debug] [ThreadPool]: On list_bookings_dbt: BEGIN
[0m15:09:46.158562 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:09:46.219733 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m15:09:46.220086 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m15:09:46.220338 [debug] [ThreadPool]: On list_bookings_dbt: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings_dbt"} */
select
      'bookings' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'bookings' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
[0m15:09:46.237583 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m15:09:46.239096 [debug] [ThreadPool]: On list_bookings_dbt: ROLLBACK
[0m15:09:46.239597 [debug] [ThreadPool]: On list_bookings_dbt: Close
[0m15:09:46.244164 [debug] [MainThread]: Using postgres connection "master"
[0m15:09:46.244423 [debug] [MainThread]: On master: BEGIN
[0m15:09:46.244632 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:09:46.271191 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:09:46.271502 [debug] [MainThread]: Using postgres connection "master"
[0m15:09:46.271841 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:09:46.302394 [debug] [MainThread]: SQL status: SELECT 6 in 0.0 seconds
[0m15:09:46.303754 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c754b535-e1e2-45ac-8f35-05f777bcda87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11139d730>]}
[0m15:09:46.304280 [debug] [MainThread]: On master: ROLLBACK
[0m15:09:46.304880 [debug] [MainThread]: Using postgres connection "master"
[0m15:09:46.305114 [debug] [MainThread]: On master: BEGIN
[0m15:09:46.306230 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:09:46.306433 [debug] [MainThread]: On master: COMMIT
[0m15:09:46.306614 [debug] [MainThread]: Using postgres connection "master"
[0m15:09:46.306820 [debug] [MainThread]: On master: COMMIT
[0m15:09:46.307294 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:09:46.307476 [debug] [MainThread]: On master: Close
[0m15:09:46.307900 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:09:46.308152 [info ] [MainThread]: 
[0m15:09:46.311578 [debug] [Thread-1  ]: Began running node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:09:46.311882 [info ] [Thread-1  ]: 1 of 1 START test test_ticket_sales_counts_are_valid ........................... [RUN]
[0m15:09:46.312540 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bookings_dbt, now test.plaid_de.test_ticket_sales_counts_are_valid)
[0m15:09:46.312864 [debug] [Thread-1  ]: Began compiling node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:09:46.320000 [debug] [Thread-1  ]: Writing injected SQL for node "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:09:46.320972 [debug] [Thread-1  ]: Timing info for test.plaid_de.test_ticket_sales_counts_are_valid (compile): 15:09:46.313009 => 15:09:46.320802
[0m15:09:46.321239 [debug] [Thread-1  ]: Began executing node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:09:46.334014 [debug] [Thread-1  ]: Writing runtime sql for node "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:09:46.334787 [debug] [Thread-1  ]: Using postgres connection "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:09:46.335029 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: BEGIN
[0m15:09:46.335246 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:09:46.350921 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m15:09:46.351194 [debug] [Thread-1  ]: Using postgres connection "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:09:46.351447 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "test.plaid_de.test_ticket_sales_counts_are_valid"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      

WITH cte AS (
    SELECT
    tsc.date,
    tsc.rolling_7_days_total AS actual_7d_total,
    SUM(tsc.daily_total_tickets) OVER (
        ORDER BY tsc.date ASC ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS expected_7d_total -- 6 not 7! god dammit.
    FROM dbt.ticket_sales_counts tsc
)
SELECT
    '7-day rolling total matches daily_total_tickets sum for last 7 days' AS test,
    date,
    calculated_7d_total,
    expected_7d_total
FROM cte
WHERE calculated_7d_total <> expected_7d_total
      
    ) dbt_internal_test
[0m15:09:46.354881 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column "calculated_7d_total" does not exist
LINE 20:     calculated_7d_total,
             ^

[0m15:09:46.355131 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: ROLLBACK
[0m15:09:46.356052 [debug] [Thread-1  ]: Timing info for test.plaid_de.test_ticket_sales_counts_are_valid (execute): 15:09:46.321445 => 15:09:46.355896
[0m15:09:46.356303 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: Close
[0m15:09:46.360057 [debug] [Thread-1  ]: Database Error in test test_ticket_sales_counts_are_valid (tests/ticket_sales/test_ticket_sales_counts_are_valid.sql)
  column "calculated_7d_total" does not exist
  LINE 20:     calculated_7d_total,
               ^
  compiled Code at target/run/plaid_de/tests/ticket_sales/test_ticket_sales_counts_are_valid.sql
[0m15:09:46.360748 [error] [Thread-1  ]: 1 of 1 ERROR test_ticket_sales_counts_are_valid ................................ [[31mERROR[0m in 0.05s]
[0m15:09:46.361154 [debug] [Thread-1  ]: Finished running node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:09:46.362039 [debug] [MainThread]: Using postgres connection "master"
[0m15:09:46.362247 [debug] [MainThread]: On master: BEGIN
[0m15:09:46.362425 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:09:46.384811 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:09:46.385071 [debug] [MainThread]: On master: COMMIT
[0m15:09:46.385258 [debug] [MainThread]: Using postgres connection "master"
[0m15:09:46.385417 [debug] [MainThread]: On master: COMMIT
[0m15:09:46.385767 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:09:46.385978 [debug] [MainThread]: On master: Close
[0m15:09:46.386375 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:09:46.386556 [debug] [MainThread]: Connection 'test.plaid_de.test_ticket_sales_counts_are_valid' was properly closed.
[0m15:09:46.386827 [info ] [MainThread]: 
[0m15:09:46.387077 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 0.24 seconds (0.24s).
[0m15:09:46.387494 [debug] [MainThread]: Command end result
[0m15:09:46.391558 [info ] [MainThread]: 
[0m15:09:46.391831 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:09:46.392047 [info ] [MainThread]: 
[0m15:09:46.392256 [error] [MainThread]: [33mDatabase Error in test test_ticket_sales_counts_are_valid (tests/ticket_sales/test_ticket_sales_counts_are_valid.sql)[0m
[0m15:09:46.392492 [error] [MainThread]:   column "calculated_7d_total" does not exist
[0m15:09:46.392716 [error] [MainThread]:   LINE 20:     calculated_7d_total,
[0m15:09:46.392937 [error] [MainThread]:                ^
[0m15:09:46.393155 [error] [MainThread]:   compiled Code at target/run/plaid_de/tests/ticket_sales/test_ticket_sales_counts_are_valid.sql
[0m15:09:46.393354 [info ] [MainThread]: 
[0m15:09:46.393584 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m15:09:46.394046 [debug] [MainThread]: Command `dbt test` failed at 15:09:46.393984 after 0.43 seconds
[0m15:09:46.394272 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fac44f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111629dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111629b20>]}
[0m15:09:46.394499 [debug] [MainThread]: Flushing usage events
[0m15:09:58.751474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110448850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111951280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d1bf6d0>]}


============================== 15:09:58.756163 | 7db6debc-a134-4720-8a35-d174ac640286 ==============================
[0m15:09:58.756163 [info ] [MainThread]: Running with dbt=1.5.4
[0m15:09:58.756607 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/jwan/Desktop/de-technical-assessment', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m15:09:58.814151 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7db6debc-a134-4720-8a35-d174ac640286', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d1bfa60>]}
[0m15:09:58.827788 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7db6debc-a134-4720-8a35-d174ac640286', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111d096a0>]}
[0m15:09:58.828436 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m15:09:58.860686 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m15:09:58.942811 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:09:58.943224 [debug] [MainThread]: Partial parsing: updated file: plaid_de://tests/ticket_sales/test_ticket_sales_counts_are_valid.sql
[0m15:09:58.976013 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7db6debc-a134-4720-8a35-d174ac640286', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1120340d0>]}
[0m15:09:58.980569 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7db6debc-a134-4720-8a35-d174ac640286', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111f62be0>]}
[0m15:09:58.980870 [info ] [MainThread]: Found 3 models, 1 test, 0 snapshots, 0 analyses, 307 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m15:09:58.981129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7db6debc-a134-4720-8a35-d174ac640286', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111f62b50>]}
[0m15:09:58.982013 [info ] [MainThread]: 
[0m15:09:58.982476 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:09:58.983203 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bookings_dbt'
[0m15:09:58.990112 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m15:09:58.990333 [debug] [ThreadPool]: On list_bookings_dbt: BEGIN
[0m15:09:58.990511 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:09:59.025613 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m15:09:59.025884 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m15:09:59.026096 [debug] [ThreadPool]: On list_bookings_dbt: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings_dbt"} */
select
      'bookings' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'bookings' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
[0m15:09:59.033251 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m15:09:59.034340 [debug] [ThreadPool]: On list_bookings_dbt: ROLLBACK
[0m15:09:59.035106 [debug] [ThreadPool]: On list_bookings_dbt: Close
[0m15:09:59.039234 [debug] [MainThread]: Using postgres connection "master"
[0m15:09:59.039452 [debug] [MainThread]: On master: BEGIN
[0m15:09:59.039629 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:09:59.056513 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:09:59.056761 [debug] [MainThread]: Using postgres connection "master"
[0m15:09:59.057038 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:09:59.080686 [debug] [MainThread]: SQL status: SELECT 6 in 0.0 seconds
[0m15:09:59.081654 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7db6debc-a134-4720-8a35-d174ac640286', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111d09e50>]}
[0m15:09:59.081983 [debug] [MainThread]: On master: ROLLBACK
[0m15:09:59.082448 [debug] [MainThread]: Using postgres connection "master"
[0m15:09:59.082697 [debug] [MainThread]: On master: BEGIN
[0m15:09:59.083620 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:09:59.083845 [debug] [MainThread]: On master: COMMIT
[0m15:09:59.084048 [debug] [MainThread]: Using postgres connection "master"
[0m15:09:59.084232 [debug] [MainThread]: On master: COMMIT
[0m15:09:59.084602 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:09:59.084818 [debug] [MainThread]: On master: Close
[0m15:09:59.085285 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:09:59.085564 [info ] [MainThread]: 
[0m15:09:59.089452 [debug] [Thread-1  ]: Began running node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:09:59.089752 [info ] [Thread-1  ]: 1 of 1 START test test_ticket_sales_counts_are_valid ........................... [RUN]
[0m15:09:59.090258 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bookings_dbt, now test.plaid_de.test_ticket_sales_counts_are_valid)
[0m15:09:59.090509 [debug] [Thread-1  ]: Began compiling node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:09:59.096948 [debug] [Thread-1  ]: Writing injected SQL for node "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:09:59.097475 [debug] [Thread-1  ]: Timing info for test.plaid_de.test_ticket_sales_counts_are_valid (compile): 15:09:59.090674 => 15:09:59.097335
[0m15:09:59.097698 [debug] [Thread-1  ]: Began executing node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:09:59.108198 [debug] [Thread-1  ]: Writing runtime sql for node "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:09:59.108662 [debug] [Thread-1  ]: Using postgres connection "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:09:59.108886 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: BEGIN
[0m15:09:59.109083 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:09:59.119325 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m15:09:59.119576 [debug] [Thread-1  ]: Using postgres connection "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:09:59.119837 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "test.plaid_de.test_ticket_sales_counts_are_valid"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      

WITH cte AS (
    SELECT
    tsc.date,
    tsc.rolling_7_days_total AS actual_7d_total,
    SUM(tsc.daily_total_tickets) OVER (
        ORDER BY tsc.date ASC ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS expected_7d_total -- 6 not 7! god dammit.
    FROM dbt.ticket_sales_counts tsc
)
SELECT
    '7-day rolling total matches daily_total_tickets sum for last 7 days' AS test,
    date,
    calculated_7d_total,
    expected_7d_total
FROM cte
WHERE actual_7d_total <> expected_7d_total
      
    ) dbt_internal_test
[0m15:09:59.120859 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column "calculated_7d_total" does not exist
LINE 20:     calculated_7d_total,
             ^

[0m15:09:59.121089 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: ROLLBACK
[0m15:09:59.121786 [debug] [Thread-1  ]: Timing info for test.plaid_de.test_ticket_sales_counts_are_valid (execute): 15:09:59.097841 => 15:09:59.121619
[0m15:09:59.122033 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: Close
[0m15:09:59.126184 [debug] [Thread-1  ]: Database Error in test test_ticket_sales_counts_are_valid (tests/ticket_sales/test_ticket_sales_counts_are_valid.sql)
  column "calculated_7d_total" does not exist
  LINE 20:     calculated_7d_total,
               ^
  compiled Code at target/run/plaid_de/tests/ticket_sales/test_ticket_sales_counts_are_valid.sql
[0m15:09:59.127106 [error] [Thread-1  ]: 1 of 1 ERROR test_ticket_sales_counts_are_valid ................................ [[31mERROR[0m in 0.04s]
[0m15:09:59.127469 [debug] [Thread-1  ]: Finished running node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:09:59.128289 [debug] [MainThread]: Using postgres connection "master"
[0m15:09:59.128487 [debug] [MainThread]: On master: BEGIN
[0m15:09:59.128638 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:09:59.138398 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:09:59.138601 [debug] [MainThread]: On master: COMMIT
[0m15:09:59.138782 [debug] [MainThread]: Using postgres connection "master"
[0m15:09:59.138944 [debug] [MainThread]: On master: COMMIT
[0m15:09:59.139301 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:09:59.139523 [debug] [MainThread]: On master: Close
[0m15:09:59.139934 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:09:59.140124 [debug] [MainThread]: Connection 'test.plaid_de.test_ticket_sales_counts_are_valid' was properly closed.
[0m15:09:59.140389 [info ] [MainThread]: 
[0m15:09:59.140651 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 0.16 seconds (0.16s).
[0m15:09:59.141080 [debug] [MainThread]: Command end result
[0m15:09:59.144760 [info ] [MainThread]: 
[0m15:09:59.145032 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:09:59.145246 [info ] [MainThread]: 
[0m15:09:59.145460 [error] [MainThread]: [33mDatabase Error in test test_ticket_sales_counts_are_valid (tests/ticket_sales/test_ticket_sales_counts_are_valid.sql)[0m
[0m15:09:59.145664 [error] [MainThread]:   column "calculated_7d_total" does not exist
[0m15:09:59.145861 [error] [MainThread]:   LINE 20:     calculated_7d_total,
[0m15:09:59.146049 [error] [MainThread]:                ^
[0m15:09:59.146236 [error] [MainThread]:   compiled Code at target/run/plaid_de/tests/ticket_sales/test_ticket_sales_counts_are_valid.sql
[0m15:09:59.146427 [info ] [MainThread]: 
[0m15:09:59.146647 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m15:09:59.147040 [debug] [MainThread]: Command `dbt test` failed at 15:09:59.146984 after 0.42 seconds
[0m15:09:59.147252 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110448850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11202db20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111faebe0>]}
[0m15:09:59.147484 [debug] [MainThread]: Flushing usage events
[0m15:10:06.499577 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10de904f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f399280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10acbd6d0>]}


============================== 15:10:06.507027 | 51d93688-9045-4e6a-a604-fa4f03411387 ==============================
[0m15:10:06.507027 [info ] [MainThread]: Running with dbt=1.5.4
[0m15:10:06.507790 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/jwan/Desktop/de-technical-assessment', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m15:10:06.566981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '51d93688-9045-4e6a-a604-fa4f03411387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10acbda60>]}
[0m15:10:06.578812 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '51d93688-9045-4e6a-a604-fa4f03411387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f751640>]}
[0m15:10:06.579247 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m15:10:06.594285 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m15:10:06.642712 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:10:06.643253 [debug] [MainThread]: Partial parsing: updated file: plaid_de://tests/ticket_sales/test_ticket_sales_counts_are_valid.sql
[0m15:10:06.671749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '51d93688-9045-4e6a-a604-fa4f03411387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fa7c0d0>]}
[0m15:10:06.676161 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '51d93688-9045-4e6a-a604-fa4f03411387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f9b0b80>]}
[0m15:10:06.676475 [info ] [MainThread]: Found 3 models, 1 test, 0 snapshots, 0 analyses, 307 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m15:10:06.676738 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '51d93688-9045-4e6a-a604-fa4f03411387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f9b0af0>]}
[0m15:10:06.677622 [info ] [MainThread]: 
[0m15:10:06.678120 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:10:06.678859 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bookings_dbt'
[0m15:10:06.685848 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m15:10:06.686070 [debug] [ThreadPool]: On list_bookings_dbt: BEGIN
[0m15:10:06.686255 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:10:06.731829 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m15:10:06.732111 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m15:10:06.732329 [debug] [ThreadPool]: On list_bookings_dbt: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings_dbt"} */
select
      'bookings' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'bookings' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
[0m15:10:06.742458 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m15:10:06.743758 [debug] [ThreadPool]: On list_bookings_dbt: ROLLBACK
[0m15:10:06.744392 [debug] [ThreadPool]: On list_bookings_dbt: Close
[0m15:10:06.748706 [debug] [MainThread]: Using postgres connection "master"
[0m15:10:06.748938 [debug] [MainThread]: On master: BEGIN
[0m15:10:06.749121 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:10:06.766051 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:10:06.766287 [debug] [MainThread]: Using postgres connection "master"
[0m15:10:06.766566 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:10:06.785600 [debug] [MainThread]: SQL status: SELECT 6 in 0.0 seconds
[0m15:10:06.786682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '51d93688-9045-4e6a-a604-fa4f03411387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f774640>]}
[0m15:10:06.787068 [debug] [MainThread]: On master: ROLLBACK
[0m15:10:06.787540 [debug] [MainThread]: Using postgres connection "master"
[0m15:10:06.788454 [debug] [MainThread]: On master: BEGIN
[0m15:10:06.791233 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:10:06.791453 [debug] [MainThread]: On master: COMMIT
[0m15:10:06.791648 [debug] [MainThread]: Using postgres connection "master"
[0m15:10:06.791837 [debug] [MainThread]: On master: COMMIT
[0m15:10:06.792943 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:10:06.793156 [debug] [MainThread]: On master: Close
[0m15:10:06.793627 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:10:06.793900 [info ] [MainThread]: 
[0m15:10:06.799331 [debug] [Thread-1  ]: Began running node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:10:06.800360 [info ] [Thread-1  ]: 1 of 1 START test test_ticket_sales_counts_are_valid ........................... [RUN]
[0m15:10:06.800921 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bookings_dbt, now test.plaid_de.test_ticket_sales_counts_are_valid)
[0m15:10:06.801176 [debug] [Thread-1  ]: Began compiling node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:10:06.807929 [debug] [Thread-1  ]: Writing injected SQL for node "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:10:06.810239 [debug] [Thread-1  ]: Timing info for test.plaid_de.test_ticket_sales_counts_are_valid (compile): 15:10:06.801490 => 15:10:06.810081
[0m15:10:06.810490 [debug] [Thread-1  ]: Began executing node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:10:06.821072 [debug] [Thread-1  ]: Writing runtime sql for node "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:10:06.821528 [debug] [Thread-1  ]: Using postgres connection "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:10:06.821746 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: BEGIN
[0m15:10:06.821956 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:10:06.836460 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m15:10:06.836760 [debug] [Thread-1  ]: Using postgres connection "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:10:06.837027 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "test.plaid_de.test_ticket_sales_counts_are_valid"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      

WITH cte AS (
    SELECT
    tsc.date,
    tsc.rolling_7_days_total AS actual_7d_total,
    SUM(tsc.daily_total_tickets) OVER (
        ORDER BY tsc.date ASC ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS expected_7d_total -- 6 not 7! god dammit.
    FROM dbt.ticket_sales_counts tsc
)
SELECT
    '7-day rolling total matches daily_total_tickets sum for last 7 days' AS test,
    date,
    actual_7d_total,
    expected_7d_total
FROM cte
WHERE actual_7d_total <> expected_7d_total
      
    ) dbt_internal_test
[0m15:10:06.841151 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.0 seconds
[0m15:10:06.842649 [debug] [Thread-1  ]: Timing info for test.plaid_de.test_ticket_sales_counts_are_valid (execute): 15:10:06.810649 => 15:10:06.842503
[0m15:10:06.842929 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: ROLLBACK
[0m15:10:06.843302 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: Close
[0m15:10:06.844460 [info ] [Thread-1  ]: 1 of 1 PASS test_ticket_sales_counts_are_valid ................................. [[32mPASS[0m in 0.04s]
[0m15:10:06.844952 [debug] [Thread-1  ]: Finished running node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:10:06.845873 [debug] [MainThread]: Using postgres connection "master"
[0m15:10:06.846050 [debug] [MainThread]: On master: BEGIN
[0m15:10:06.846203 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:10:06.857885 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:10:06.858085 [debug] [MainThread]: On master: COMMIT
[0m15:10:06.858243 [debug] [MainThread]: Using postgres connection "master"
[0m15:10:06.858396 [debug] [MainThread]: On master: COMMIT
[0m15:10:06.858938 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:10:06.859114 [debug] [MainThread]: On master: Close
[0m15:10:06.859481 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:10:06.859665 [debug] [MainThread]: Connection 'test.plaid_de.test_ticket_sales_counts_are_valid' was properly closed.
[0m15:10:06.859914 [info ] [MainThread]: 
[0m15:10:06.860173 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 0.18 seconds (0.18s).
[0m15:10:06.860636 [debug] [MainThread]: Command end result
[0m15:10:06.864309 [info ] [MainThread]: 
[0m15:10:06.864590 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:10:06.864836 [info ] [MainThread]: 
[0m15:10:06.865086 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m15:10:06.865527 [debug] [MainThread]: Command `dbt test` succeeded at 15:10:06.865468 after 0.39 seconds
[0m15:10:06.865757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10de904f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f751640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f9f5fa0>]}
[0m15:10:06.865985 [debug] [MainThread]: Flushing usage events
[0m15:13:38.988238 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dc48a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f151280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9bf6d0>]}


============================== 15:13:39.005738 | e61b18aa-406e-40a5-97d8-694a86e6382b ==============================
[0m15:13:39.005738 [info ] [MainThread]: Running with dbt=1.5.4
[0m15:13:39.006209 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/jwan/Desktop/de-technical-assessment', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m15:13:39.057194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e61b18aa-406e-40a5-97d8-694a86e6382b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9bfa60>]}
[0m15:13:39.069047 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e61b18aa-406e-40a5-97d8-694a86e6382b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f5096d0>]}
[0m15:13:39.069530 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m15:13:39.085479 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m15:13:39.177565 [debug] [MainThread]: Partial parsing enabled: 3 files deleted, 5 files added, 0 files changed.
[0m15:13:39.177974 [debug] [MainThread]: Partial parsing: added file: plaid_de://models/marts/analytics/ticket_sales/ticket_sales_counts.yml
[0m15:13:39.178199 [debug] [MainThread]: Partial parsing: added file: plaid_de://models/marts/analytics/routes/valid_and_bookable_routes.sql
[0m15:13:39.178391 [debug] [MainThread]: Partial parsing: added file: plaid_de://models/marts/analytics/redemption_bookings/redemption_bookings_counts_by_day.sql
[0m15:13:39.178581 [debug] [MainThread]: Partial parsing: added file: plaid_de://tests/ticket_sales/test_ticket_sales_counts_are_valid.sql
[0m15:13:39.178759 [debug] [MainThread]: Partial parsing: added file: plaid_de://models/marts/analytics/ticket_sales/ticket_sales_counts.sql
[0m15:13:39.178915 [debug] [MainThread]: Partial parsing: deleted file: plaid_de://models/analytics/ticket_sales_counts.sql
[0m15:13:39.179070 [debug] [MainThread]: Partial parsing: deleted file: plaid_de://models/analytics/valid_and_bookable_routes.sql
[0m15:13:39.179219 [debug] [MainThread]: Partial parsing: deleted file: plaid_de://models/analytics/redemption_bookings_number_by_day.sql
[0m15:13:39.199645 [debug] [MainThread]: 1699: static parser successfully parsed marts/analytics/routes/valid_and_bookable_routes.sql
[0m15:13:39.208994 [debug] [MainThread]: 1699: static parser successfully parsed marts/analytics/redemption_bookings/redemption_bookings_counts_by_day.sql
[0m15:13:39.211113 [debug] [MainThread]: 1699: static parser successfully parsed marts/analytics/ticket_sales/ticket_sales_counts.sql
[0m15:13:39.237122 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e61b18aa-406e-40a5-97d8-694a86e6382b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f827100>]}
[0m15:13:39.241098 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e61b18aa-406e-40a5-97d8-694a86e6382b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f75b850>]}
[0m15:13:39.241365 [info ] [MainThread]: Found 3 models, 1 test, 0 snapshots, 0 analyses, 307 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m15:13:39.241616 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e61b18aa-406e-40a5-97d8-694a86e6382b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f75b7c0>]}
[0m15:13:39.242469 [info ] [MainThread]: 
[0m15:13:39.242932 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:13:39.243628 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bookings_dbt'
[0m15:13:39.250262 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m15:13:39.250476 [debug] [ThreadPool]: On list_bookings_dbt: BEGIN
[0m15:13:39.250648 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:13:39.500020 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m15:13:39.500380 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m15:13:39.500621 [debug] [ThreadPool]: On list_bookings_dbt: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings_dbt"} */
select
      'bookings' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'bookings' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
[0m15:13:39.551059 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m15:13:39.552700 [debug] [ThreadPool]: On list_bookings_dbt: ROLLBACK
[0m15:13:39.553467 [debug] [ThreadPool]: On list_bookings_dbt: Close
[0m15:13:39.558712 [debug] [MainThread]: Using postgres connection "master"
[0m15:13:39.559037 [debug] [MainThread]: On master: BEGIN
[0m15:13:39.559260 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:13:39.575983 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:13:39.576288 [debug] [MainThread]: Using postgres connection "master"
[0m15:13:39.576617 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:13:39.607409 [debug] [MainThread]: SQL status: SELECT 6 in 0.0 seconds
[0m15:13:39.608319 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e61b18aa-406e-40a5-97d8-694a86e6382b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f7a6f70>]}
[0m15:13:39.608802 [debug] [MainThread]: On master: ROLLBACK
[0m15:13:39.609363 [debug] [MainThread]: Using postgres connection "master"
[0m15:13:39.609613 [debug] [MainThread]: On master: BEGIN
[0m15:13:39.611019 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:13:39.614881 [debug] [MainThread]: On master: COMMIT
[0m15:13:39.615058 [debug] [MainThread]: Using postgres connection "master"
[0m15:13:39.615225 [debug] [MainThread]: On master: COMMIT
[0m15:13:39.615625 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:13:39.616257 [debug] [MainThread]: On master: Close
[0m15:13:39.616684 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:13:39.616930 [info ] [MainThread]: 
[0m15:13:39.620613 [debug] [Thread-1  ]: Began running node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:13:39.621085 [info ] [Thread-1  ]: 1 of 1 START test test_ticket_sales_counts_are_valid ........................... [RUN]
[0m15:13:39.621669 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bookings_dbt, now test.plaid_de.test_ticket_sales_counts_are_valid)
[0m15:13:39.622123 [debug] [Thread-1  ]: Began compiling node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:13:39.630451 [debug] [Thread-1  ]: Writing injected SQL for node "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:13:39.631184 [debug] [Thread-1  ]: Timing info for test.plaid_de.test_ticket_sales_counts_are_valid (compile): 15:13:39.622280 => 15:13:39.631037
[0m15:13:39.631425 [debug] [Thread-1  ]: Began executing node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:13:39.644293 [debug] [Thread-1  ]: Writing runtime sql for node "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:13:39.645062 [debug] [Thread-1  ]: Using postgres connection "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:13:39.645312 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: BEGIN
[0m15:13:39.645541 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:13:39.666767 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m15:13:39.667096 [debug] [Thread-1  ]: Using postgres connection "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:13:39.667355 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "test.plaid_de.test_ticket_sales_counts_are_valid"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      

WITH cte AS (
    SELECT
    tsc.date,
    tsc.rolling_7_days_total AS actual_7d_total,
    SUM(tsc.daily_total_tickets) OVER (
        ORDER BY tsc.date ASC ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS expected_7d_total -- 6 not 7! god dammit.
    FROM dbt.ticket_sales_counts tsc
)
SELECT
    '7-day rolling total matches daily_total_tickets sum for last 7 days' AS test,
    date,
    actual_7d_total,
    expected_7d_total
FROM cte
WHERE actual_7d_total <> expected_7d_total
      
    ) dbt_internal_test
[0m15:13:39.684317 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.0 seconds
[0m15:13:39.686167 [debug] [Thread-1  ]: Timing info for test.plaid_de.test_ticket_sales_counts_are_valid (execute): 15:13:39.631579 => 15:13:39.685943
[0m15:13:39.686467 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: ROLLBACK
[0m15:13:39.686901 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: Close
[0m15:13:39.691833 [info ] [Thread-1  ]: 1 of 1 PASS test_ticket_sales_counts_are_valid ................................. [[32mPASS[0m in 0.07s]
[0m15:13:39.692364 [debug] [Thread-1  ]: Finished running node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:13:39.693502 [debug] [MainThread]: Using postgres connection "master"
[0m15:13:39.693681 [debug] [MainThread]: On master: BEGIN
[0m15:13:39.693832 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:13:39.714157 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:13:39.714382 [debug] [MainThread]: On master: COMMIT
[0m15:13:39.714559 [debug] [MainThread]: Using postgres connection "master"
[0m15:13:39.714725 [debug] [MainThread]: On master: COMMIT
[0m15:13:39.715312 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:13:39.715501 [debug] [MainThread]: On master: Close
[0m15:13:39.715900 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:13:39.716075 [debug] [MainThread]: Connection 'test.plaid_de.test_ticket_sales_counts_are_valid' was properly closed.
[0m15:13:39.716375 [info ] [MainThread]: 
[0m15:13:39.716625 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 0.47 seconds (0.47s).
[0m15:13:39.717108 [debug] [MainThread]: Command end result
[0m15:13:39.721768 [info ] [MainThread]: 
[0m15:13:39.722061 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:13:39.722288 [info ] [MainThread]: 
[0m15:13:39.722564 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m15:13:39.723173 [debug] [MainThread]: Command `dbt test` succeeded at 15:13:39.723085 after 0.77 seconds
[0m15:13:39.723482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dc48a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f8d4280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f8d4160>]}
[0m15:13:39.723788 [debug] [MainThread]: Flushing usage events
[0m15:13:46.023067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fe10a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11133e340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cbbf6d0>]}


============================== 15:13:46.029945 | 9b983385-e821-4047-aafa-f329366cce66 ==============================
[0m15:13:46.029945 [info ] [MainThread]: Running with dbt=1.5.4
[0m15:13:46.030365 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '.', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m15:13:46.076457 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9b983385-e821-4047-aafa-f329366cce66', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cbbf640>]}
[0m15:13:46.088494 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9b983385-e821-4047-aafa-f329366cce66', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1116f76d0>]}
[0m15:13:46.088971 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m15:13:46.102961 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m15:13:46.155333 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:13:46.155641 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:13:46.160074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9b983385-e821-4047-aafa-f329366cce66', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1119d10d0>]}
[0m15:13:46.164466 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9b983385-e821-4047-aafa-f329366cce66', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11194dbb0>]}
[0m15:13:46.164760 [info ] [MainThread]: Found 3 models, 1 test, 0 snapshots, 0 analyses, 307 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m15:13:46.165035 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9b983385-e821-4047-aafa-f329366cce66', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11194db20>]}
[0m15:13:46.166122 [info ] [MainThread]: 
[0m15:13:46.166604 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:13:46.167331 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bookings'
[0m15:13:46.174745 [debug] [ThreadPool]: Using postgres connection "list_bookings"
[0m15:13:46.174974 [debug] [ThreadPool]: On list_bookings: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings"} */

    select distinct nspname from pg_namespace
  
[0m15:13:46.175162 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:13:46.215025 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.0 seconds
[0m15:13:46.216110 [debug] [ThreadPool]: On list_bookings: Close
[0m15:13:46.217163 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bookings, now list_bookings_dbt)
[0m15:13:46.221304 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m15:13:46.221509 [debug] [ThreadPool]: On list_bookings_dbt: BEGIN
[0m15:13:46.221674 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:13:46.240318 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m15:13:46.240607 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m15:13:46.240832 [debug] [ThreadPool]: On list_bookings_dbt: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings_dbt"} */
select
      'bookings' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'bookings' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
[0m15:13:46.245234 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m15:13:46.246103 [debug] [ThreadPool]: On list_bookings_dbt: ROLLBACK
[0m15:13:46.246469 [debug] [ThreadPool]: On list_bookings_dbt: Close
[0m15:13:46.250131 [debug] [MainThread]: Using postgres connection "master"
[0m15:13:46.250345 [debug] [MainThread]: On master: BEGIN
[0m15:13:46.250517 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:13:46.260946 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:13:46.261200 [debug] [MainThread]: Using postgres connection "master"
[0m15:13:46.261469 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:13:46.289584 [debug] [MainThread]: SQL status: SELECT 6 in 0.0 seconds
[0m15:13:46.290665 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9b983385-e821-4047-aafa-f329366cce66', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11199bdc0>]}
[0m15:13:46.291750 [debug] [MainThread]: On master: ROLLBACK
[0m15:13:46.292502 [debug] [MainThread]: Using postgres connection "master"
[0m15:13:46.292713 [debug] [MainThread]: On master: BEGIN
[0m15:13:46.293556 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:13:46.293788 [debug] [MainThread]: On master: COMMIT
[0m15:13:46.293992 [debug] [MainThread]: Using postgres connection "master"
[0m15:13:46.294866 [debug] [MainThread]: On master: COMMIT
[0m15:13:46.296813 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:13:46.297024 [debug] [MainThread]: On master: Close
[0m15:13:46.297497 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:13:46.297770 [info ] [MainThread]: 
[0m15:13:46.304296 [debug] [Thread-1  ]: Began running node model.plaid_de.redemption_bookings_counts_by_day
[0m15:13:46.304583 [debug] [Thread-2  ]: Began running node model.plaid_de.ticket_sales_counts
[0m15:13:46.304855 [debug] [Thread-3  ]: Began running node model.plaid_de.valid_and_bookable_routes
[0m15:13:46.305176 [info ] [Thread-1  ]: 1 of 3 START sql table model dbt.redemption_bookings_counts_by_day ............. [RUN]
[0m15:13:46.305548 [info ] [Thread-2  ]: 2 of 3 START sql table model dbt.ticket_sales_counts ........................... [RUN]
[0m15:13:46.305897 [info ] [Thread-3  ]: 3 of 3 START sql table model dbt.valid_and_bookable_routes ..................... [RUN]
[0m15:13:46.306384 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bookings_dbt, now model.plaid_de.redemption_bookings_counts_by_day)
[0m15:13:46.306831 [debug] [Thread-2  ]: Acquiring new postgres connection 'model.plaid_de.ticket_sales_counts'
[0m15:13:46.307360 [debug] [Thread-3  ]: Acquiring new postgres connection 'model.plaid_de.valid_and_bookable_routes'
[0m15:13:46.307602 [debug] [Thread-1  ]: Began compiling node model.plaid_de.redemption_bookings_counts_by_day
[0m15:13:46.307827 [debug] [Thread-2  ]: Began compiling node model.plaid_de.ticket_sales_counts
[0m15:13:46.308040 [debug] [Thread-3  ]: Began compiling node model.plaid_de.valid_and_bookable_routes
[0m15:13:46.313803 [debug] [Thread-1  ]: Writing injected SQL for node "model.plaid_de.redemption_bookings_counts_by_day"
[0m15:13:46.315683 [debug] [Thread-2  ]: Writing injected SQL for node "model.plaid_de.ticket_sales_counts"
[0m15:13:46.317713 [debug] [Thread-3  ]: Writing injected SQL for node "model.plaid_de.valid_and_bookable_routes"
[0m15:13:46.318584 [debug] [Thread-3  ]: Timing info for model.plaid_de.valid_and_bookable_routes (compile): 15:13:46.315871 => 15:13:46.318436
[0m15:13:46.318846 [debug] [Thread-2  ]: Timing info for model.plaid_de.ticket_sales_counts (compile): 15:13:46.313987 => 15:13:46.318717
[0m15:13:46.319106 [debug] [Thread-1  ]: Timing info for model.plaid_de.redemption_bookings_counts_by_day (compile): 15:13:46.308196 => 15:13:46.318987
[0m15:13:46.319309 [debug] [Thread-3  ]: Began executing node model.plaid_de.valid_and_bookable_routes
[0m15:13:46.319530 [debug] [Thread-2  ]: Began executing node model.plaid_de.ticket_sales_counts
[0m15:13:46.319748 [debug] [Thread-1  ]: Began executing node model.plaid_de.redemption_bookings_counts_by_day
[0m15:13:46.350032 [debug] [Thread-2  ]: Writing runtime sql for node "model.plaid_de.ticket_sales_counts"
[0m15:13:46.353140 [debug] [Thread-3  ]: Writing runtime sql for node "model.plaid_de.valid_and_bookable_routes"
[0m15:13:46.355902 [debug] [Thread-1  ]: Writing runtime sql for node "model.plaid_de.redemption_bookings_counts_by_day"
[0m15:13:46.356680 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_counts_by_day"
[0m15:13:46.356983 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m15:13:46.357196 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m15:13:46.357395 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_counts_by_day: BEGIN
[0m15:13:46.357617 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: BEGIN
[0m15:13:46.357815 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: BEGIN
[0m15:13:46.358013 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:13:46.358205 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m15:13:46.358406 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m15:13:46.370831 [debug] [Thread-2  ]: SQL status: BEGIN in 0.0 seconds
[0m15:13:46.371100 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m15:13:46.371383 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */

  
    

  create  table "bookings"."dbt"."ticket_sales_counts__dbt_tmp"
  
  
    as
  
  (
    

WITH daily_ticket_sales AS (
    SELECT
        DATE_TRUNC('day', b.book_date) AS sale_date,
        COUNT(t.ticket_no) AS total_tickets
    FROM bookings b
    JOIN tickets t ON b.book_ref = t.book_ref
    GROUP BY sale_date
),

rolling_7d_ticket_sales AS (
    SELECT
        sale_date,
        SUM(total_tickets) OVER (ORDER BY sale_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS rolling_7_days_total
    FROM daily_ticket_sales
),

rolling_28d_ticket_sales AS (
    SELECT
        sale_date,
        SUM(total_tickets) OVER (ORDER BY sale_date ROWS BETWEEN 27 PRECEDING AND CURRENT ROW) AS rolling_28_days_total
    FROM daily_ticket_sales
)
SELECT
    dts.sale_date AS date,
    dts.total_tickets AS daily_total_tickets,
    rolling_7d.rolling_7_days_total,
    rolling_28d.rolling_28_days_total
FROM daily_ticket_sales dts
LEFT JOIN rolling_7d_ticket_sales AS rolling_7d
    ON dts.sale_date = rolling_7d.sale_date
LEFT JOIN rolling_28d_ticket_sales AS rolling_28d
    ON dts.sale_date = rolling_28d.sale_date
  );
  
[0m15:13:46.375752 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m15:13:46.376018 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_counts_by_day"
[0m15:13:46.376270 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_counts_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_counts_by_day"} */

  
    

  create  table "bookings"."dbt"."redemption_bookings_counts_by_day__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    DATE_TRUNC('day', b.book_date) AS date,
    COUNT(*) AS redemption_count
FROM bookings b
WHERE total_amount = -1
    OR total_amount = 0
    OR total_amount = -12345678.00
GROUP BY date
ORDER BY redemption_count desc
  );
  
[0m15:13:46.380689 [debug] [Thread-3  ]: SQL status: BEGIN in 0.0 seconds
[0m15:13:46.380929 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m15:13:46.381356 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */

  
    

  create  table "bookings"."dbt"."valid_and_bookable_routes__dbt_tmp"
  
  
    as
  
  (
    

WITH no_transfer_flights AS (
    SELECT
        route1.flight_no AS first_flight,
        NULL AS second_flight,
        route1.departure_airport AS first_departure_airport,
        route1.arrival_airport AS first_arrival_airport,
        NULL AS second_departure_airport,
        NULL AS second_arrival_airport,
        route1.scheduled_departure as first_scheduled_departure_time,
        NULL::time without time zone as second_scheduled_departure_time,
        route1.scheduled_arrival as first_scheduled_arrival_time,
        NULL::time without time zone as second_scheduled_arrival_time
    FROM routes AS route1
),
one_transfer_flights AS (
    SELECT
        route1.flight_no AS first_flight,
        route2.flight_no AS second_flight,
        route1.departure_airport AS first_departure_airport,
        route1.arrival_airport AS first_arrival_airport,
        route2.departure_airport AS second_departure_airport,
        route2.arrival_airport AS second_arrival_airport,
        route1.scheduled_departure as first_scheduled_departure_time,
        route2.scheduled_departure as second_scheduled_departure_time,
        route1.scheduled_arrival as first_scheduled_arrival_time,
        route2.scheduled_arrival as second_scheduled_arrival_time
    FROM routes AS route1
    LEFT OUTER JOIN routes AS route2
    ON route1.arrival_airport = route2.departure_airport
),
max_1_transfer_and_non_circular_flights AS (
  SELECT
    first_flight,
    second_flight,
    first_departure_airport,
    first_arrival_airport,
    second_departure_airport,
    second_arrival_airport,
    first_scheduled_departure_time,
    second_scheduled_departure_time,
    first_scheduled_arrival_time,
    second_scheduled_arrival_time
  FROM one_transfer_flights
  WHERE first_departure_airport <> second_arrival_airport -- non-circular
  UNION ALL
  SELECT
    first_flight,
    second_flight,
    first_departure_airport,
    first_arrival_airport,
    second_departure_airport,
    second_arrival_airport,
    first_scheduled_departure_time,
    second_scheduled_departure_time,
    first_scheduled_arrival_time,
    second_scheduled_arrival_time
  FROM no_transfer_flights
),
max_1_transfer_and_non_circular_flights_with_travel_times AS (
    SELECT
        first_flight,
        second_flight,
        first_departure_airport,
        first_arrival_airport,
        second_departure_airport,
        second_arrival_airport,
        first_scheduled_departure_time,
        first_scheduled_arrival_time,
        second_scheduled_departure_time,
        second_scheduled_arrival_time,
        CASE WHEN first_scheduled_arrival_time - first_scheduled_departure_time < '00:00:00'::INTERVAL
            THEN first_scheduled_arrival_time - first_scheduled_departure_time + INTERVAL '24 HOURS'
            ELSE first_scheduled_arrival_time - first_scheduled_departure_time
        END as normalized_first_leg,
        CASE WHEN second_scheduled_departure_time - first_scheduled_arrival_time < '00:00:00'::INTERVAL
            THEN second_scheduled_departure_time - first_scheduled_arrival_time + INTERVAL '24 HOURS'
            ELSE second_scheduled_departure_time - first_scheduled_arrival_time
        END as normalized_second_leg,
        CASE WHEN second_scheduled_arrival_time - second_scheduled_departure_time < '00:00:00'::INTERVAL
            THEN second_scheduled_arrival_time - second_scheduled_departure_time + INTERVAL '24 HOURS'
            ELSE second_scheduled_arrival_time - second_scheduled_departure_time
        END as normalized_third_leg
    FROM max_1_transfer_and_non_circular_flights
), max_1_transfer_and_non_circular_flights_within_24hours AS (
    SELECT
        first_flight,
        second_flight,
        first_departure_airport,
        first_arrival_airport,
        second_departure_airport,
        second_arrival_airport,
        first_scheduled_departure_time,
        first_scheduled_arrival_time,
        second_scheduled_departure_time,
        second_scheduled_arrival_time
    FROM max_1_transfer_and_non_circular_flights_with_travel_times
    WHERE normalized_first_leg + normalized_second_leg + normalized_third_leg <= INTERVAL '24 HOURS'
) SELECT
    first_flight as first_flight_no,
    second_flight as second_flight_no,
    first_departure_airport as origin_airport,
    COALESCE(second_arrival_airport, first_arrival_airport) as destination_airport_code,
    CASE WHEN second_flight IS NOT NULL THEN first_arrival_airport END as transfer_airport_code,
    first_scheduled_departure_time as first_scheduled_departure_time,
    CASE WHEN second_flight IS NOT NULL THEN first_scheduled_arrival_time END as transfer_airport_arrival_time,
    CASE WHEN second_flight IS NOT NULL THEN second_scheduled_departure_time END as transfer_airport_departure_time,
    COALESCE(second_scheduled_arrival_time, first_scheduled_arrival_time) as destination_arrival_time
FROM max_1_transfer_and_non_circular_flights_within_24hours AS valid_routes
  );
  
[0m15:13:46.828280 [debug] [Thread-1  ]: SQL status: SELECT 111 in 0.0 seconds
[0m15:13:46.847822 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_counts_by_day"
[0m15:13:46.849303 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_counts_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_counts_by_day"} */
alter table "bookings"."dbt"."redemption_bookings_counts_by_day" rename to "redemption_bookings_counts_by_day__dbt_backup"
[0m15:13:46.851655 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m15:13:46.859925 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_counts_by_day"
[0m15:13:46.860798 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_counts_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_counts_by_day"} */
alter table "bookings"."dbt"."redemption_bookings_counts_by_day__dbt_tmp" rename to "redemption_bookings_counts_by_day"
[0m15:13:46.862133 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m15:13:46.880851 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_counts_by_day: COMMIT
[0m15:13:46.881221 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_counts_by_day"
[0m15:13:46.881471 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_counts_by_day: COMMIT
[0m15:13:46.883282 [debug] [Thread-1  ]: SQL status: COMMIT in 0.0 seconds
[0m15:13:46.887140 [debug] [Thread-1  ]: Using postgres connection "model.plaid_de.redemption_bookings_counts_by_day"
[0m15:13:46.887442 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_counts_by_day: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.redemption_bookings_counts_by_day"} */
drop table if exists "bookings"."dbt"."redemption_bookings_counts_by_day__dbt_backup" cascade
[0m15:13:46.893412 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.0 seconds
[0m15:13:46.894596 [debug] [Thread-1  ]: Timing info for model.plaid_de.redemption_bookings_counts_by_day (execute): 15:13:46.353293 => 15:13:46.894455
[0m15:13:46.894865 [debug] [Thread-1  ]: On model.plaid_de.redemption_bookings_counts_by_day: Close
[0m15:13:46.895365 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9b983385-e821-4047-aafa-f329366cce66', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111b8e850>]}
[0m15:13:46.897483 [info ] [Thread-1  ]: 1 of 3 OK created sql table model dbt.redemption_bookings_counts_by_day ........ [[32mSELECT 111[0m in 0.59s]
[0m15:13:46.898063 [debug] [Thread-1  ]: Finished running node model.plaid_de.redemption_bookings_counts_by_day
[0m15:13:47.008008 [debug] [Thread-3  ]: SQL status: SELECT 8112 in 1.0 seconds
[0m15:13:47.017690 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m15:13:47.018956 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */
alter table "bookings"."dbt"."valid_and_bookable_routes" rename to "valid_and_bookable_routes__dbt_backup"
[0m15:13:47.020677 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m15:13:47.029914 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m15:13:47.030818 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */
alter table "bookings"."dbt"."valid_and_bookable_routes__dbt_tmp" rename to "valid_and_bookable_routes"
[0m15:13:47.031994 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m15:13:47.038597 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: COMMIT
[0m15:13:47.040255 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m15:13:47.041819 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: COMMIT
[0m15:13:47.043381 [debug] [Thread-3  ]: SQL status: COMMIT in 0.0 seconds
[0m15:13:47.049096 [debug] [Thread-3  ]: Using postgres connection "model.plaid_de.valid_and_bookable_routes"
[0m15:13:47.049810 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.valid_and_bookable_routes"} */
drop table if exists "bookings"."dbt"."valid_and_bookable_routes__dbt_backup" cascade
[0m15:13:47.057835 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.0 seconds
[0m15:13:47.060766 [debug] [Thread-3  ]: Timing info for model.plaid_de.valid_and_bookable_routes (execute): 15:13:46.319903 => 15:13:47.060414
[0m15:13:47.061484 [debug] [Thread-3  ]: On model.plaid_de.valid_and_bookable_routes: Close
[0m15:13:47.062716 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9b983385-e821-4047-aafa-f329366cce66', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111baaf10>]}
[0m15:13:47.063736 [info ] [Thread-3  ]: 3 of 3 OK created sql table model dbt.valid_and_bookable_routes ................ [[32mSELECT 8112[0m in 0.76s]
[0m15:13:47.065073 [debug] [Thread-3  ]: Finished running node model.plaid_de.valid_and_bookable_routes
[0m15:13:48.281952 [debug] [Thread-2  ]: SQL status: SELECT 117 in 2.0 seconds
[0m15:13:48.300745 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m15:13:48.303754 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */
alter table "bookings"."dbt"."ticket_sales_counts" rename to "ticket_sales_counts__dbt_backup"
[0m15:13:48.311227 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m15:13:48.317068 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m15:13:48.317717 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */
alter table "bookings"."dbt"."ticket_sales_counts__dbt_tmp" rename to "ticket_sales_counts"
[0m15:13:48.318691 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m15:13:48.322605 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: COMMIT
[0m15:13:48.323203 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m15:13:48.323748 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: COMMIT
[0m15:13:48.325880 [debug] [Thread-2  ]: SQL status: COMMIT in 0.0 seconds
[0m15:13:48.331136 [debug] [Thread-2  ]: Using postgres connection "model.plaid_de.ticket_sales_counts"
[0m15:13:48.331760 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "model.plaid_de.ticket_sales_counts"} */
drop table if exists "bookings"."dbt"."ticket_sales_counts__dbt_backup" cascade
[0m15:13:48.334634 [debug] [Thread-2  ]: SQL status: DROP TABLE in 0.0 seconds
[0m15:13:48.337131 [debug] [Thread-2  ]: Timing info for model.plaid_de.ticket_sales_counts (execute): 15:13:46.338787 => 15:13:48.336752
[0m15:13:48.337757 [debug] [Thread-2  ]: On model.plaid_de.ticket_sales_counts: Close
[0m15:13:48.339015 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9b983385-e821-4047-aafa-f329366cce66', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111aa9760>]}
[0m15:13:48.339721 [info ] [Thread-2  ]: 2 of 3 OK created sql table model dbt.ticket_sales_counts ...................... [[32mSELECT 117[0m in 2.03s]
[0m15:13:48.340239 [debug] [Thread-2  ]: Finished running node model.plaid_de.ticket_sales_counts
[0m15:13:48.341398 [debug] [MainThread]: Using postgres connection "master"
[0m15:13:48.341605 [debug] [MainThread]: On master: BEGIN
[0m15:13:48.341783 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:13:48.357238 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:13:48.357474 [debug] [MainThread]: On master: COMMIT
[0m15:13:48.357659 [debug] [MainThread]: Using postgres connection "master"
[0m15:13:48.357842 [debug] [MainThread]: On master: COMMIT
[0m15:13:48.358208 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:13:48.358406 [debug] [MainThread]: On master: Close
[0m15:13:48.358822 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:13:48.359007 [debug] [MainThread]: Connection 'model.plaid_de.redemption_bookings_counts_by_day' was properly closed.
[0m15:13:48.359174 [debug] [MainThread]: Connection 'model.plaid_de.ticket_sales_counts' was properly closed.
[0m15:13:48.359338 [debug] [MainThread]: Connection 'model.plaid_de.valid_and_bookable_routes' was properly closed.
[0m15:13:48.359668 [info ] [MainThread]: 
[0m15:13:48.360098 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 2.19 seconds (2.19s).
[0m15:13:48.361458 [debug] [MainThread]: Command end result
[0m15:13:48.368753 [info ] [MainThread]: 
[0m15:13:48.369073 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:13:48.369407 [info ] [MainThread]: 
[0m15:13:48.369998 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m15:13:48.370953 [debug] [MainThread]: Command `dbt run` succeeded at 15:13:48.370837 after 2.38 seconds
[0m15:13:48.371408 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fe10a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1116f76d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111aaa1f0>]}
[0m15:13:48.371832 [debug] [MainThread]: Flushing usage events
[0m15:15:49.561224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10daff850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f02e280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a8bf6d0>]}


============================== 15:15:49.578888 | 2034b80a-c4e3-4c92-b44f-46f54e1cda9a ==============================
[0m15:15:49.578888 [info ] [MainThread]: Running with dbt=1.5.4
[0m15:15:49.579432 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/jwan/Desktop/de-technical-assessment', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m15:15:49.630646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2034b80a-c4e3-4c92-b44f-46f54e1cda9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a8bfa60>]}
[0m15:15:49.642645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2034b80a-c4e3-4c92-b44f-46f54e1cda9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f3e66a0>]}
[0m15:15:49.643115 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m15:15:49.660599 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m15:15:49.716525 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:15:49.716989 [debug] [MainThread]: Partial parsing: updated file: plaid_de://tests/ticket_sales/test_ticket_sales_counts_are_valid.sql
[0m15:15:49.747063 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2034b80a-c4e3-4c92-b44f-46f54e1cda9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f70e0d0>]}
[0m15:15:49.751756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2034b80a-c4e3-4c92-b44f-46f54e1cda9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f645b80>]}
[0m15:15:49.752054 [info ] [MainThread]: Found 3 models, 1 test, 0 snapshots, 0 analyses, 307 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m15:15:49.752305 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2034b80a-c4e3-4c92-b44f-46f54e1cda9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f645af0>]}
[0m15:15:49.753159 [info ] [MainThread]: 
[0m15:15:49.753629 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:15:49.754337 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bookings_dbt'
[0m15:15:49.761093 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m15:15:49.761302 [debug] [ThreadPool]: On list_bookings_dbt: BEGIN
[0m15:15:49.761485 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:15:49.813722 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m15:15:49.814106 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m15:15:49.814348 [debug] [ThreadPool]: On list_bookings_dbt: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings_dbt"} */
select
      'bookings' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'bookings' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
[0m15:15:49.822515 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m15:15:49.823978 [debug] [ThreadPool]: On list_bookings_dbt: ROLLBACK
[0m15:15:49.824536 [debug] [ThreadPool]: On list_bookings_dbt: Close
[0m15:15:49.829029 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:49.829281 [debug] [MainThread]: On master: BEGIN
[0m15:15:49.829469 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:15:49.845413 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:15:49.845688 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:49.846007 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:15:49.868629 [debug] [MainThread]: SQL status: SELECT 6 in 0.0 seconds
[0m15:15:49.869893 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2034b80a-c4e3-4c92-b44f-46f54e1cda9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f68bfa0>]}
[0m15:15:49.870311 [debug] [MainThread]: On master: ROLLBACK
[0m15:15:49.871093 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:49.871338 [debug] [MainThread]: On master: BEGIN
[0m15:15:49.872409 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:15:49.872723 [debug] [MainThread]: On master: COMMIT
[0m15:15:49.872976 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:49.873204 [debug] [MainThread]: On master: COMMIT
[0m15:15:49.873880 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:15:49.874153 [debug] [MainThread]: On master: Close
[0m15:15:49.874728 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:15:49.875060 [info ] [MainThread]: 
[0m15:15:49.879653 [debug] [Thread-1  ]: Began running node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:15:49.880124 [info ] [Thread-1  ]: 1 of 1 START test test_ticket_sales_counts_are_valid ........................... [RUN]
[0m15:15:49.880742 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bookings_dbt, now test.plaid_de.test_ticket_sales_counts_are_valid)
[0m15:15:49.881045 [debug] [Thread-1  ]: Began compiling node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:15:49.888992 [debug] [Thread-1  ]: Writing injected SQL for node "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:15:49.889604 [debug] [Thread-1  ]: Timing info for test.plaid_de.test_ticket_sales_counts_are_valid (compile): 15:15:49.881370 => 15:15:49.889441
[0m15:15:49.889863 [debug] [Thread-1  ]: Began executing node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:15:49.901382 [debug] [Thread-1  ]: Writing runtime sql for node "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:15:49.902009 [debug] [Thread-1  ]: Using postgres connection "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:15:49.902238 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: BEGIN
[0m15:15:49.902443 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:15:49.912856 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m15:15:49.913106 [debug] [Thread-1  ]: Using postgres connection "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:15:49.913353 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "test.plaid_de.test_ticket_sales_counts_are_valid"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      

WITH cte AS (
    SELECT
    tsc.date,
    tsc.rolling_7_days_total AS actual_7d_total,
    tsc.rolling_28_days_total AS actual_28d_total,
    SUM(tsc.daily_total_tickets) OVER (
        ORDER BY tsc.date ASC ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
    ) AS expected_7d_total, -- 6 not 7! god dammit.
    SUM(tsc.daily_total_tickets) OVER (
        ORDER BY tsc.date ASC ROWS BETWEEN 27 PRECEDING AND CURRENT ROW
    ) AS expected_28d_total
    FROM dbt.ticket_sales_counts tsc
)
SELECT
    '7-day rolling total matches daily_total_tickets sum for last 7 days' AS test,
    date,
    actual_7d_total,
    expected_7d_total,
    actual_28d_total
    expected_28d_total
FROM cte
WHERE actual_7d_total <> expected_7d_total
OR actual_28d_total <> expected_28d_total
      
    ) dbt_internal_test
[0m15:15:49.915638 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.0 seconds
[0m15:15:49.917106 [debug] [Thread-1  ]: Timing info for test.plaid_de.test_ticket_sales_counts_are_valid (execute): 15:15:49.890025 => 15:15:49.916970
[0m15:15:49.917343 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: ROLLBACK
[0m15:15:49.917741 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: Close
[0m15:15:49.918817 [info ] [Thread-1  ]: 1 of 1 PASS test_ticket_sales_counts_are_valid ................................. [[32mPASS[0m in 0.04s]
[0m15:15:49.919334 [debug] [Thread-1  ]: Finished running node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:15:49.920323 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:49.920533 [debug] [MainThread]: On master: BEGIN
[0m15:15:49.920707 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:15:49.931602 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:15:49.931830 [debug] [MainThread]: On master: COMMIT
[0m15:15:49.932002 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:49.932167 [debug] [MainThread]: On master: COMMIT
[0m15:15:49.932493 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:15:49.932678 [debug] [MainThread]: On master: Close
[0m15:15:49.933054 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:15:49.933222 [debug] [MainThread]: Connection 'test.plaid_de.test_ticket_sales_counts_are_valid' was properly closed.
[0m15:15:49.933479 [info ] [MainThread]: 
[0m15:15:49.933726 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 0.18 seconds (0.18s).
[0m15:15:49.934182 [debug] [MainThread]: Command end result
[0m15:15:49.937862 [info ] [MainThread]: 
[0m15:15:49.938142 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:15:49.938367 [info ] [MainThread]: 
[0m15:15:49.938604 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m15:15:49.939040 [debug] [MainThread]: Command `dbt test` succeeded at 15:15:49.938978 after 0.41 seconds
[0m15:15:49.939266 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10daff850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f702ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f3e66a0>]}
[0m15:15:49.939500 [debug] [MainThread]: Flushing usage events
[0m15:15:57.502120 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fa50f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f80280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c7bf6d0>]}


============================== 15:15:57.506778 | a922afda-9f62-4053-b9c9-c8101b63edd3 ==============================
[0m15:15:57.506778 [info ] [MainThread]: Running with dbt=1.5.4
[0m15:15:57.507251 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/jwan/Desktop/de-technical-assessment', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m15:15:57.558347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a922afda-9f62-4053-b9c9-c8101b63edd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c7bfa60>]}
[0m15:15:57.570193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a922afda-9f62-4053-b9c9-c8101b63edd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111337670>]}
[0m15:15:57.570664 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m15:15:57.585106 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m15:15:57.639705 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:15:57.640207 [debug] [MainThread]: Partial parsing: updated file: plaid_de://tests/ticket_sales/test_ticket_sales_counts_are_valid.sql
[0m15:15:57.669778 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a922afda-9f62-4053-b9c9-c8101b63edd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11165f0d0>]}
[0m15:15:57.674103 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a922afda-9f62-4053-b9c9-c8101b63edd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111596b50>]}
[0m15:15:57.674423 [info ] [MainThread]: Found 3 models, 1 test, 0 snapshots, 0 analyses, 307 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m15:15:57.674709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a922afda-9f62-4053-b9c9-c8101b63edd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111596ac0>]}
[0m15:15:57.675653 [info ] [MainThread]: 
[0m15:15:57.676191 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:15:57.677001 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bookings_dbt'
[0m15:15:57.684056 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m15:15:57.684274 [debug] [ThreadPool]: On list_bookings_dbt: BEGIN
[0m15:15:57.684461 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:15:57.736202 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m15:15:57.736934 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m15:15:57.737195 [debug] [ThreadPool]: On list_bookings_dbt: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings_dbt"} */
select
      'bookings' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'bookings' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
[0m15:15:57.747097 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m15:15:57.748711 [debug] [ThreadPool]: On list_bookings_dbt: ROLLBACK
[0m15:15:57.749196 [debug] [ThreadPool]: On list_bookings_dbt: Close
[0m15:15:57.753827 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:57.754045 [debug] [MainThread]: On master: BEGIN
[0m15:15:57.754235 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:15:57.782678 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:15:57.783032 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:57.783338 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:15:57.828695 [debug] [MainThread]: SQL status: SELECT 6 in 0.0 seconds
[0m15:15:57.829940 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a922afda-9f62-4053-b9c9-c8101b63edd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1115dcdf0>]}
[0m15:15:57.830312 [debug] [MainThread]: On master: ROLLBACK
[0m15:15:57.830707 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:57.830912 [debug] [MainThread]: On master: BEGIN
[0m15:15:57.831824 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:15:57.832019 [debug] [MainThread]: On master: COMMIT
[0m15:15:57.832225 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:57.832380 [debug] [MainThread]: On master: COMMIT
[0m15:15:57.832975 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:15:57.833205 [debug] [MainThread]: On master: Close
[0m15:15:57.833656 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:15:57.833913 [info ] [MainThread]: 
[0m15:15:57.837759 [debug] [Thread-1  ]: Began running node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:15:57.838130 [info ] [Thread-1  ]: 1 of 1 START test test_ticket_sales_counts_are_valid ........................... [RUN]
[0m15:15:57.838691 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bookings_dbt, now test.plaid_de.test_ticket_sales_counts_are_valid)
[0m15:15:57.838918 [debug] [Thread-1  ]: Began compiling node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:15:57.846336 [debug] [Thread-1  ]: Writing injected SQL for node "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:15:57.846987 [debug] [Thread-1  ]: Timing info for test.plaid_de.test_ticket_sales_counts_are_valid (compile): 15:15:57.839059 => 15:15:57.846826
[0m15:15:57.847249 [debug] [Thread-1  ]: Began executing node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:15:57.860069 [debug] [Thread-1  ]: Writing runtime sql for node "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:15:57.860730 [debug] [Thread-1  ]: Using postgres connection "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:15:57.861634 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: BEGIN
[0m15:15:57.861859 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:15:57.892367 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m15:15:57.892669 [debug] [Thread-1  ]: Using postgres connection "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:15:57.892947 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "test.plaid_de.test_ticket_sales_counts_are_valid"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      

WITH cte AS (
    SELECT
    tsc.date,
    tsc.rolling_7_days_total AS actual_7d_total,
    tsc.rolling_28_days_total AS actual_28d_total,
    SUM(tsc.daily_total_tickets) OVER (
        ORDER BY tsc.date ASC ROWS BETWEEN 5 PRECEDING AND CURRENT ROW
    ) AS expected_7d_total, -- 6 not 7! god dammit.
    SUM(tsc.daily_total_tickets) OVER (
        ORDER BY tsc.date ASC ROWS BETWEEN 27 PRECEDING AND CURRENT ROW
    ) AS expected_28d_total
    FROM dbt.ticket_sales_counts tsc
)
SELECT
    '7-day rolling total matches daily_total_tickets sum for last 7 days' AS test,
    date,
    actual_7d_total,
    expected_7d_total,
    actual_28d_total
    expected_28d_total
FROM cte
WHERE actual_7d_total <> expected_7d_total
OR actual_28d_total <> expected_28d_total
      
    ) dbt_internal_test
[0m15:15:57.906161 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.0 seconds
[0m15:15:57.907913 [debug] [Thread-1  ]: Timing info for test.plaid_de.test_ticket_sales_counts_are_valid (execute): 15:15:57.847561 => 15:15:57.907768
[0m15:15:57.908151 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: ROLLBACK
[0m15:15:57.908863 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: Close
[0m15:15:57.910051 [error] [Thread-1  ]: 1 of 1 FAIL 111 test_ticket_sales_counts_are_valid ............................. [[31mFAIL 111[0m in 0.07s]
[0m15:15:57.910595 [debug] [Thread-1  ]: Finished running node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:15:57.911570 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:57.911775 [debug] [MainThread]: On master: BEGIN
[0m15:15:57.911948 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:15:57.929384 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:15:57.929598 [debug] [MainThread]: On master: COMMIT
[0m15:15:57.929767 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:57.929961 [debug] [MainThread]: On master: COMMIT
[0m15:15:57.930637 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:15:57.930849 [debug] [MainThread]: On master: Close
[0m15:15:57.931372 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:15:57.931549 [debug] [MainThread]: Connection 'test.plaid_de.test_ticket_sales_counts_are_valid' was properly closed.
[0m15:15:57.931848 [info ] [MainThread]: 
[0m15:15:57.932102 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 0.26 seconds (0.26s).
[0m15:15:57.932612 [debug] [MainThread]: Command end result
[0m15:15:57.937033 [info ] [MainThread]: 
[0m15:15:57.937422 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:15:57.937715 [info ] [MainThread]: 
[0m15:15:57.938000 [error] [MainThread]: [31mFailure in test test_ticket_sales_counts_are_valid (tests/ticket_sales/test_ticket_sales_counts_are_valid.sql)[0m
[0m15:15:57.938241 [error] [MainThread]:   Got 111 results, configured to fail if != 0
[0m15:15:57.938465 [info ] [MainThread]: 
[0m15:15:57.938692 [info ] [MainThread]:   compiled Code at target/compiled/plaid_de/tests/ticket_sales/test_ticket_sales_counts_are_valid.sql
[0m15:15:57.938913 [info ] [MainThread]: 
[0m15:15:57.939228 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m15:15:57.939719 [debug] [MainThread]: Command `dbt test` failed at 15:15:57.939650 after 0.46 seconds
[0m15:15:57.939975 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fa50f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1113593a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1115964c0>]}
[0m15:15:57.940225 [debug] [MainThread]: Flushing usage events
[0m15:16:05.474678 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c136f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d666280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ebf6d0>]}


============================== 15:16:05.479750 | 5965ff87-a6b7-4e31-9498-c30b3dd6f29b ==============================
[0m15:16:05.479750 [info ] [MainThread]: Running with dbt=1.5.4
[0m15:16:05.480216 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/jwan/Desktop/de-technical-assessment', 'log_path': '/Users/jwan/Desktop/de-technical-assessment/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m15:16:05.532971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5965ff87-a6b7-4e31-9498-c30b3dd6f29b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ebfa60>]}
[0m15:16:05.545476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5965ff87-a6b7-4e31-9498-c30b3dd6f29b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10da1e670>]}
[0m15:16:05.545986 [info ] [MainThread]: Registered adapter: postgres=1.5.4
[0m15:16:05.565059 [debug] [MainThread]: checksum: 5d6b65bf0937b31c1cb174f5650843d5ea9953bdf3de7df3d9ed5979670d6d21, vars: {}, profile: , target: , version: 1.5.4
[0m15:16:05.613826 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:16:05.614325 [debug] [MainThread]: Partial parsing: updated file: plaid_de://tests/ticket_sales/test_ticket_sales_counts_are_valid.sql
[0m15:16:05.643036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5965ff87-a6b7-4e31-9498-c30b3dd6f29b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dd460d0>]}
[0m15:16:05.647229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5965ff87-a6b7-4e31-9498-c30b3dd6f29b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dc77b50>]}
[0m15:16:05.647513 [info ] [MainThread]: Found 3 models, 1 test, 0 snapshots, 0 analyses, 307 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m15:16:05.647771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5965ff87-a6b7-4e31-9498-c30b3dd6f29b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dc77ac0>]}
[0m15:16:05.648650 [info ] [MainThread]: 
[0m15:16:05.649126 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:16:05.649869 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bookings_dbt'
[0m15:16:05.656810 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m15:16:05.657027 [debug] [ThreadPool]: On list_bookings_dbt: BEGIN
[0m15:16:05.657203 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:16:05.707692 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m15:16:05.708088 [debug] [ThreadPool]: Using postgres connection "list_bookings_dbt"
[0m15:16:05.708310 [debug] [ThreadPool]: On list_bookings_dbt: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "list_bookings_dbt"} */
select
      'bookings' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'bookings' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
[0m15:16:05.715271 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m15:16:05.716463 [debug] [ThreadPool]: On list_bookings_dbt: ROLLBACK
[0m15:16:05.717107 [debug] [ThreadPool]: On list_bookings_dbt: Close
[0m15:16:05.721219 [debug] [MainThread]: Using postgres connection "master"
[0m15:16:05.721462 [debug] [MainThread]: On master: BEGIN
[0m15:16:05.721643 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:16:05.739219 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:16:05.739465 [debug] [MainThread]: Using postgres connection "master"
[0m15:16:05.739768 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:16:05.771570 [debug] [MainThread]: SQL status: SELECT 6 in 0.0 seconds
[0m15:16:05.772994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5965ff87-a6b7-4e31-9498-c30b3dd6f29b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dcc3d00>]}
[0m15:16:05.773442 [debug] [MainThread]: On master: ROLLBACK
[0m15:16:05.774372 [debug] [MainThread]: Using postgres connection "master"
[0m15:16:05.774672 [debug] [MainThread]: On master: BEGIN
[0m15:16:05.776238 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:16:05.776519 [debug] [MainThread]: On master: COMMIT
[0m15:16:05.776756 [debug] [MainThread]: Using postgres connection "master"
[0m15:16:05.776976 [debug] [MainThread]: On master: COMMIT
[0m15:16:05.777459 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:16:05.777722 [debug] [MainThread]: On master: Close
[0m15:16:05.778353 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:16:05.778695 [info ] [MainThread]: 
[0m15:16:05.783699 [debug] [Thread-1  ]: Began running node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:16:05.784080 [info ] [Thread-1  ]: 1 of 1 START test test_ticket_sales_counts_are_valid ........................... [RUN]
[0m15:16:05.784704 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bookings_dbt, now test.plaid_de.test_ticket_sales_counts_are_valid)
[0m15:16:05.785098 [debug] [Thread-1  ]: Began compiling node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:16:05.792340 [debug] [Thread-1  ]: Writing injected SQL for node "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:16:05.793030 [debug] [Thread-1  ]: Timing info for test.plaid_de.test_ticket_sales_counts_are_valid (compile): 15:16:05.785299 => 15:16:05.792866
[0m15:16:05.793287 [debug] [Thread-1  ]: Began executing node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:16:05.804360 [debug] [Thread-1  ]: Writing runtime sql for node "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:16:05.804783 [debug] [Thread-1  ]: Using postgres connection "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:16:05.805008 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: BEGIN
[0m15:16:05.805209 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:16:05.817738 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m15:16:05.817994 [debug] [Thread-1  ]: Using postgres connection "test.plaid_de.test_ticket_sales_counts_are_valid"
[0m15:16:05.818271 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: /* {"app": "dbt", "dbt_version": "1.5.4", "profile_name": "plaid-de", "target_name": "dev", "node_id": "test.plaid_de.test_ticket_sales_counts_are_valid"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      

WITH cte AS (
    SELECT
    tsc.date,
    tsc.rolling_7_days_total AS actual_7d_total,
    tsc.rolling_28_days_total AS actual_28d_total,
    SUM(tsc.daily_total_tickets) OVER (
        ORDER BY tsc.date ASC ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
    ) AS expected_7d_total, -- 6 not 7! god dammit.
    SUM(tsc.daily_total_tickets) OVER (
        ORDER BY tsc.date ASC ROWS BETWEEN 28 PRECEDING AND CURRENT ROW
    ) AS expected_28d_total
    FROM dbt.ticket_sales_counts tsc
)
SELECT
    '7-day rolling total matches daily_total_tickets sum for last 7 days' AS test,
    date,
    actual_7d_total,
    expected_7d_total,
    actual_28d_total
    expected_28d_total
FROM cte
WHERE actual_7d_total <> expected_7d_total
OR actual_28d_total <> expected_28d_total
      
    ) dbt_internal_test
[0m15:16:05.820276 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.0 seconds
[0m15:16:05.821847 [debug] [Thread-1  ]: Timing info for test.plaid_de.test_ticket_sales_counts_are_valid (execute): 15:16:05.793443 => 15:16:05.821689
[0m15:16:05.822095 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: ROLLBACK
[0m15:16:05.822517 [debug] [Thread-1  ]: On test.plaid_de.test_ticket_sales_counts_are_valid: Close
[0m15:16:05.823640 [error] [Thread-1  ]: 1 of 1 FAIL 89 test_ticket_sales_counts_are_valid .............................. [[31mFAIL 89[0m in 0.04s]
[0m15:16:05.824143 [debug] [Thread-1  ]: Finished running node test.plaid_de.test_ticket_sales_counts_are_valid
[0m15:16:05.825089 [debug] [MainThread]: Using postgres connection "master"
[0m15:16:05.825282 [debug] [MainThread]: On master: BEGIN
[0m15:16:05.825449 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:16:05.836071 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:16:05.836274 [debug] [MainThread]: On master: COMMIT
[0m15:16:05.836448 [debug] [MainThread]: Using postgres connection "master"
[0m15:16:05.836605 [debug] [MainThread]: On master: COMMIT
[0m15:16:05.836921 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:16:05.837132 [debug] [MainThread]: On master: Close
[0m15:16:05.837520 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:16:05.837696 [debug] [MainThread]: Connection 'test.plaid_de.test_ticket_sales_counts_are_valid' was properly closed.
[0m15:16:05.837952 [info ] [MainThread]: 
[0m15:16:05.838209 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 0.19 seconds (0.19s).
[0m15:16:05.838692 [debug] [MainThread]: Command end result
[0m15:16:05.842489 [info ] [MainThread]: 
[0m15:16:05.842766 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:16:05.842989 [info ] [MainThread]: 
[0m15:16:05.843223 [error] [MainThread]: [31mFailure in test test_ticket_sales_counts_are_valid (tests/ticket_sales/test_ticket_sales_counts_are_valid.sql)[0m
[0m15:16:05.843448 [error] [MainThread]:   Got 89 results, configured to fail if != 0
[0m15:16:05.843646 [info ] [MainThread]: 
[0m15:16:05.843845 [info ] [MainThread]:   compiled Code at target/compiled/plaid_de/tests/ticket_sales/test_ticket_sales_counts_are_valid.sql
[0m15:16:05.844051 [info ] [MainThread]: 
[0m15:16:05.844278 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m15:16:05.844693 [debug] [MainThread]: Command `dbt test` failed at 15:16:05.844636 after 0.40 seconds
[0m15:16:05.844918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c136f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10da41a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dc774c0>]}
[0m15:16:05.845142 [debug] [MainThread]: Flushing usage events
